define("modules/clean/account_page/tabs/billing",["require","exports","tslib","modules/clean/event_handler","modules/core/browser","modules/clean/payments/billing_info_modal","modules/clean/dbmodal_stack","modules/clean/deprecated/dbmodal_loading","external/react","external/react-redux","modules/clean/react/css","modules/core/i18n","modules/clean/web_timing_logger","modules/clean/account_page/util","modules/clean/teams/admin/lib/billing_history","modules/clean/account_page/widgets/billing/payment_methods_util","modules/clean/account_page/widgets/billing/action_creators","modules/clean/account_page/widgets/plan/action_creators","modules/clean/account_page/widgets/plan/add_ons/action_creators","modules/clean/react/payments/error/browser_update_required_modal","modules/clean/account_page/widgets/plan/views/cancel_subs_warning_modal","modules/clean/account_page/widgets/plan/views/change_schedule_modal","modules/clean/account_page/widgets/plan/views/change_plan_modal","modules/clean/react/payments/edit_invoice_address_modal/edit_invoice_address_modal_loader","modules/clean/react/payments/update_billing_individual/individual_update_billing_modal_loader","modules/clean/growth/rebill_upsell/rebill_upsell_top_notification","modules/clean/account_page/components/key_value_block","modules/clean/account_page/widgets/billing/views/license_keys","modules/clean/account_page/components/loading","modules/clean/payments/skus/constants","modules/constants/trademark","modules/clean/analytics","modules/clean/payments/skus/subscription_status","modules/clean/account_page/widgets/billing/views/invoice_details","modules/clean/account_page/widgets/billing/views/billing_history"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m,_,h,g,f,b,y,S,v,P,E,C,w,T,N,x,L,I,D,k,A,M){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var B=function(e,t){return{browserUpdateRequired:t.browserUpdateRequired,billingInfo:e.billingInfo.billingInfo,loadingState:e.billingInfo.loadingState,dataLoadedForTTI:"ready"===e.billingInfo.loadingState}},O=function(e){return{loadBillingInfo:function(t){return void 0===t&&(t=!1),e(g.loadDataIfNecessary(t))},loadPlanDataIfNecessary:function(t){return void 0===t&&(t=!1),e(f.loadDataIfNecessary(t))},loadEvhInfoIfNecessary:function(t){return void 0===t&&(t=!1),e(b.loadEvhInfoIfNecessary(t))}}},R=(function(e){function t(t){var n=e.call(this,t)||this;return n.browserUpdateRequired=function(){return!!n.props.browserUpdateRequired&&(y.BrowserUpdateModalLoader.showInstance(),!0)},n.handlePaymentUpdate=function(){n.browserUpdateRequired()||(D.ProEventsLogger.log("de_billing_tab_update_payment_method_click"),n.props.billingInfo.scheduled_for_downgrade?S.CancelChangesModalConfirmation.showInstance({transitionPerformed:n.reloadData,subStatus:n.subStatus}):C.IndividualUpdateBillingModalLoader.showInstance())},n.handlePaymentAdd=function(){n.browserUpdateRequired()||(D.ProEventsLogger.log("de_billing_tab_add_payment_method_click"),l.DBModalStack.push(new o({element_id:"add_billing_info",endpoint_url:"/add_billing_info_modal",html_in_error_msg:!0})))},n.handlePaymentAddToResubscribe=function(){n.browserUpdateRequired()||(D.ProEventsLogger.log("de_billing_tab_add_payment_method_resubscribe_click"),l.DBModalStack.push(new o({element_id:"update_billing_info",endpoint_url:"/billing_info_modal",html_in_error_msg:!0,parameters:{resubscribe:!0}})))},n.reloadData=function(){var e=n.props,t=e.loadBillingInfo,a=e.loadPlanDataIfNecessary,i=e.loadEvhInfoIfNecessary;t(!0),i(!0),a(!0)},n.handleBillingChange=function(){D.ProEventsLogger.log("de_billing_tab_change_billing_modal_open");var e=n.props.billingInfo,t=e.payment_info;e.scheduled_for_downgrade?S.CancelChangesModalConfirmation.showInstance({transitionPerformed:n.reloadData,subStatus:n.subStatus}):v.ChangeScheduleModalView.showInstance({transitionPerformed:n.reloadData,paymentInfo:t,browserUpdateRequired:n.props.browserUpdateRequired})},n.handleRebillUpsell=function(e){e&&(e.showChangePlanConfirm&&P.ChangePlanModalView.showInstance({mode:P.ChangePlanMode.CONFIRM,transitionPerformed:n.reloadData}),e.showProUpsell&&w.showRebillUpsellTopNotification())},n.onEditInvoiceDetailsClick=function(){D.ProEventsLogger.log("de_billing_tab_edit_invoice_modal_open"),E.EditInvoiceAddressModalLoader.showUpdateTaxProfileModal(!1,n.onInvoiceDetailsUpdated)},n.onInvoiceDetailsUpdated=function(){n.props.loadBillingInfo(!0)},n.renderLicenseKeys=function(){return s.createElement("div",{className:"account-page-block"},s.createElement(N.LicenseKeys,{licenseKeys:n.props.billingInfo.license_keys}))},n.renderBillingHistory=function(){var e=n.props.billingInfo,t=e.transactions,a=e.show_edit_invoice_modal,i=e.edit_past_invoices,r=a&&i,l=!1;if(null!==t&&t.transactions.length>0){l=_.getHistoryData(t.transactions).length>3}return s.createElement(M.BillingHistory,{showEditInvoiceModal:r,transactions:t.transactions,filters:t.filters,hasMore:l})},n.renderPaymentMethod=function(){if(n.user.paid){var e=n.props.billingInfo.payment_info,t=e.gateway_id,a=e.expiration_date,i=e.description,r=e.is_reseller_billing,l=e.end_date,o=e.deactivated,c=e.is_on_trial,u=e.reseller_name,p=e.reseller_link;if(r){var m=d._("Go to %(reseller_name)s to view or make changes to your account details").format({reseller_name:u}),_=s.createElement("a",{href:p,target:"_blank",rel:"noopener noreferrer"},m);return s.createElement(T.KeyValueBlock,{keyText:_})}if(t!==-1){if(!h.shouldHidePaymentMethod(t)&&!n.props.billingInfo.payment_method)return s.createElement(T.KeyValueBlock,{className:"add-payment",keyText:d._("You can add your payment information now to have           your subscription automatically renew when it expires"),linkText:d._("Add"),onLinkClick:n.handlePaymentAddToResubscribe});if(h.isLicenseKey(t))return s.createElement("div",{className:"account-page-block"},s.createElement(T.KeyValueBlock,{keyText:d._("Payment method"),subtext:d._("Add your payment information now to have           your subscription automatically renew when it expires"),linkText:d._("Add payment method"),onLinkClick:n.handlePaymentAdd}));if(h.shouldHidePaymentMethod(t)){var g=h.getPaymentMethodDisabledMessage(t,r,I.TRADEMARK_PLUS,l,o,c);return s.createElement(T.KeyValueBlock,{keyText:g})}var f=i;return null!==a&&(f=d._("%(payment_description)s, exp: %(expiration_date)s").format({payment_description:i,expiration_date:a,comment:'Payment description is a card information, already translated           (ex> Visa ending in 2543). Date is in format MM / YYYY ( ex> 08 / 2017 ).           An example translated string is "Visa ending in 2543, exp: 08 / 2017 ).'})),s.createElement(T.KeyValueBlock,{keyText:d._("Payment method"),valueText:f,linkText:d._("Update"),onLinkClick:n.handlePaymentUpdate})}}},n.renderBillingPeriod=function(){if(n.user.paid){var e=n.props.billingInfo,t=e.payment_info,a=e.scheduled_for_downgrade;if(!h.shouldHideBillingChange(t.gateway_id,t.is_reseller_billing)&&t.period){if(!t.schedule_switchable&&!a&&!n.isProfessionalTrialPlan)return s.createElement(T.KeyValueBlock,{keyText:d._("Sorry, you cannot change your billing schedule at this time.")});var i=d._("Plan billed %(period)s").format({period:t.period});return s.createElement(T.KeyValueBlock,{keyText:d._("Billing period"),valueText:i,linkText:d._("Change"),onLinkClick:n.handleBillingChange,disabled:t&&t.is_in_grace_period})}}},n.renderInvoiceDetails=function(){var e=n.props.billingInfo,t=e.show_edit_invoice_modal,a=e.payment_info,i=e.payment_method,r=e.has_invoice_details;if(n.user.paid&&t&&!h.shouldHideBillingChange(a.gateway_id,a.is_reseller_billing)&&a.period)return s.createElement(A.InvoiceDetails,{onLinkClick:n.onEditInvoiceDetailsClick,has_invoice_details:r,country_code:i?i.country_code:void 0})},n.user=m.getCurrentUser(),l.DBModalStack.register(r.BILLING_INFO_UPDATED,function(e,t){D.ProEventsLogger.log("de_payment_modal_save_click"),n.props.loadBillingInfo(!0),n.props.loadPlanDataIfNecessary(!0),n.handleRebillUpsell(t)}),n}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;this.props.loadBillingInfo(),this.checkTTIstate(),D.ProEventsLogger.log("de_billing_tab_view"),this.events.on(window,"hashchange",function(){e.displayResubscribeBillingModal(),e.displayUpdateBillingModal()}),this.displayResubscribeBillingModal(),this.displayUpdateBillingModal();var t=i.get_hash(),n=i.get_uri().getQuery().exp_renewals_pro_mobile_payment_page;void 0!==t&&t.search("billing_info")!==-1&&t.search("resubscribe_billing_info")===-1&&["V1","V2"].includes(n)&&D.ProEventsLogger.log("exp_renewals_pro_mobile_payment_page_"+n,{isAndroid:i.is_android(),isMobile:i.is_supported_mobile_browser(),isIOS:i.iOS})},t.prototype.componentDidUpdate=function(){this.checkTTIstate()},t.prototype.displayUpdateBillingModal=function(){var e=i.get_hash();if(void 0!==e&&e.search("billing_info")!==-1&&e.search("resubscribe_billing_info")===-1){if(!this.user.paid)return;if(this.browserUpdateRequired())return;C.IndividualUpdateBillingModalLoader.showInstance()}},t.prototype.displayResubscribeBillingModal=function(){var e=i.get_hash();if(void 0!==e&&e.search("resubscribe_billing_info")!==-1){if(this.browserUpdateRequired())return;C.IndividualUpdateBillingModalLoader.showInstance()}},Object.defineProperty(t.prototype,"subStatus",{get:function(){var e=this.props.billingInfo.serialized_sub_status;if(e)return k.SubscriptionStatus.deserialize(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isProfessionalTrialPlan",{get:function(){return!(!this.subStatus||!this.subStatus.subState.plan)&&this.subStatus.subState.plan.productType===L.ProductPlanType.PROFESSIONAL_TRIAL},enumerable:!0,configurable:!0}),t.prototype.checkTTIstate=function(){this.props.dataLoadedForTTI&&(p.mark_time_to_view(),p.mark_time_to_interactive())},t.prototype.isLoading=function(){return"ready"!==this.props.loadingState},t.prototype.render=function(){return this.isLoading()?s.createElement(x.Loading,null):s.createElement("div",{className:"account-page-tab"},this.renderPaymentMethod(),this.renderBillingPeriod(),this.renderInvoiceDetails(),this.renderLicenseKeys(),this.renderBillingHistory())},t=n.__decorate([a.eventHandler],t)})(s.Component),U=c.connect(B,O)(R);t.BillingTab=u(U,["/static/css/account/pagelet/billing_tab-vflAaq25-.css","/static/css/plan_management-vflKGEz1N.css"])}),define("modules/clean/account_page/widgets/billing/action_creators",["require","exports","tslib","modules/clean/account_page/widgets/billing/api","modules/clean/account_page/util"],function(e,t,n,a,i){"use strict";function r(e){var t=this;return void 0===e&&(e=!1),function(r,l){return n.__awaiter(t,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return"never_loaded"===l().billingInfo.loadingState||e?(r({type:"billing_info_load"}),[4,a.getBillingInfo(i.getCurrentUser().id)]):[3,2];case 1:return t=n.sent(),r({type:"billing_info_loaded",billingInfo:t}),[2,!0];case 2:return[2,!1]}})})}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadDataIfNecessary=r}),define("modules/clean/account_page/widgets/billing/api",["require","exports","modules/clean/ajax_as_promised"],function(e,t,n){"use strict";function a(e){return n.WebRequest({url:"/account/ajax_billing_tab_model",subject_user:e,dataType:"json"})}Object.defineProperty(t,"__esModule",{value:!0}),t.getBillingInfo=a}),define("modules/clean/account_page/widgets/billing/billing_history/api",["require","exports","tslib","modules/clean/ajax_as_promised"],function(e,t,n,a){"use strict";function i(e,t,i,r){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){return[2,a.WebRequest({url:"/account/ajax_load_more_billing_history/",data:{block:t,filter_type:i,filter_change:r},subject_user:e,dataType:"json"})]})})}Object.defineProperty(t,"__esModule",{value:!0}),t.getBillingHistory=i}),define("modules/clean/account_page/widgets/billing/billing_history/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.ASCENDING="ASCENDING",e.DESCENDING="DESCENDING"})(t.BillingHistoryOrder||(t.BillingHistoryOrder={}))}),define("modules/clean/account_page/widgets/billing/views/billing_history",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/account_page/util","modules/clean/teams/admin/widgets/billing_history/billing_history_table","modules/clean/teams/admin/lib/billing_history","modules/clean/analytics","modules/clean/account_page/widgets/billing/billing_history/api","modules/clean/account_page/widgets/billing/billing_history/types","modules/clean/static_urls"],function(e,t,n,a,i,r,l,o,s,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(t){var a=e.call(this,t)||this;return a.loadMoreBillingHistory=function(e){return n.__awaiter(a,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return this.setState({isLoading:!0}),s.ProEventsLogger.log("de_billing_history_view_more_click"),e.preventDefault(),[4,c.getBillingHistory(r.getCurrentUser().id,this.state.numBlocksLoaded,this.state.filter,!1)];case 1:return t=n.sent(),this.setState(function(e){return{transactions:e.isInitialLoad?t.transactions:e.transactions.concat(t.transactions),hasMore:t.hasMore,isLoading:!1,numBlocksLoaded:e.numBlocksLoaded+1,isInitialLoad:!1}}),[2,!1]}})})},a.changeFilter=function(e){return n.__awaiter(a,void 0,void 0,function(){var t,a;return n.__generator(this,function(n){switch(n.label){case 0:return this.setState({isLoading:!0,filter:e}),s.ProEventsLogger.log("de_billing_history_change_filter_click"),[4,c.getBillingHistory(r.getCurrentUser().id,this.state.numBlocksLoaded,e,!0)];case 1:return t=n.sent(),this.state.isInitialLoad&&(a=o.getHistoryData(t.transactions),t.hasMore=a.length>3),this.setState(function(e){return{transactions:t.transactions,hasMore:t.hasMore,isLoading:!1,numBlocksLoaded:e.numBlocksLoaded,isInitialLoad:e.isInitialLoad}}),[2,!1]}})})},a.changeOrder=function(){a.setState(function(e){return{order:e.order===u.BillingHistoryOrder.ASCENDING?u.BillingHistoryOrder.DESCENDING:u.BillingHistoryOrder.ASCENDING}}),s.ProEventsLogger.log("de_billing_history_change_order_click")},a.handlePopoverSelection=function(e){a.state.filter!==e&&a.state.order!==e&&(e===u.BillingHistoryOrder.ASCENDING||e===u.BillingHistoryOrder.DESCENDING?a.changeOrder():a.changeFilter(e))},a.state={transactions:a.props.transactions?a.props.transactions.slice():[],hasMore:a.props.hasMore,isLoading:!1,numBlocksLoaded:0,isInitialLoad:!0,filter:"all_time",order:u.BillingHistoryOrder.ASCENDING},a}return n.__extends(t,e),t.prototype.render=function(){return a.createElement("div",{className:"account-page-block"},a.createElement("span",{className:"account-page-block__heading"},i._("Billing history")),a.createElement("p",{className:"account-page-block__subtext"},i._("View invoices and receipts for all payments made on your Dropbox account.")),a.createElement("div",{className:"billing-table-container"},a.createElement(l.BillingHistoryTable,{billingHistoryRecords:this.getHistory(),amountLabel:i._("Amount"),displayNoTransactionsOnEmptyRecords:!0,showEditInvoiceModal:this.props.showEditInvoiceModal,noTransactionLabel:i._("No transaction history"),footer:this.buildFooter(),logAccountBillingTabEvents:!0,isTeam:!1,filter:this.state.filter,order:this.state.order,onSelection:this.handlePopoverSelection,filters:this.props.filters})))},t.prototype.getHistory=function(){var e=[];return this.state.transactions.length>0&&(e=o.getHistoryData(this.state.transactions),this.state.isInitialLoad&&(e=e.slice(0,3))),this.state.order===u.BillingHistoryOrder.ASCENDING?e:e.reverse()},t.prototype.buildFooter=function(){if(this.state.isLoading)return a.createElement("tr",{className:"billing-history-row"},a.createElement("td",{colSpan:4,className:"billing-history-col"},a.createElement("img",{src:d.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:i._("Loading")})));if(this.state.hasMore)return a.createElement("tr",{className:"billing-history-row"},a.createElement("td",{colSpan:4,className:"billing-history-col"},a.createElement("a",{href:"#",rel:"noopener noreferrer",onClick:this.loadMoreBillingHistory},i._("View more billing history"))))},t})(a.Component);t.BillingHistory=p}),define("modules/clean/account_page/widgets/billing/views/invoice_details",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/account_page/components/key_value_block","modules/clean/payments/validation"],function(e,t,n,a,i,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.country_code,n=e.has_invoice_details,o=i._("Add details to your invoice, such as company name and address.");t&&l.hasVat(t)&&(o=i._("Add details to your invoice, such as company name, address, and VAT ID."));var s=n?i._("Update"):i._("Add invoice details");return a.createElement(r.KeyValueBlock,{keyText:i._("Invoice details"),linkText:s,subtext:o,onLinkClick:this.props.onLinkClick})},t})(a.Component);t.InvoiceDetails=o}),define("modules/clean/account_page/widgets/billing/views/license_keys",["require","exports","tslib","modules/core/i18n","modules/core/browser","external/react","modules/clean/react/css","modules/clean/account_page/components/account_table","modules/clean/account_page/components/key_value_block"],function(e,t,n,a,i,r,l,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(t){var n=e.call(this,t)||this;return n.licenseRowsIncrement=3,n.handleRedeemClick=function(){i.redirect("/pro/redeem_key")},n.buildLicenseFooter=function(){if(n.state.showViewMore)return r.createElement("tr",{className:"license-footer-row"},r.createElement("td",{colSpan:4},r.createElement("a",{onClick:n.showMoreLicense,href:"",rel:"noopener noreferrer"},a._("View more license keys"))))},n.showMoreLicense=function(e){e.preventDefault(),n.setState(function(e,t){var a=e.maxShow+n.licenseRowsIncrement;return{maxShow:a,showViewMore:a<t.licenseKeys.length}})},n.buildStatus=function(e){return e.activated?a._("Activated on %(activated_date)s").format({activated_date:e.activated_date}):a._("Scheduled for future use")},n.buildDuration=function(e){return e.duration?e.duration:a._("N/A")},n.buildLicenseKeyTable=function(){var e=n.props.licenseKeys;if(0!==e.length)return r.createElement("div",{className:"license-table-container"},r.createElement(o.Table,{className:"license-table"},r.createElement(o.TableHead,null,r.createElement(o.HeaderRow,{className:"license-header-row"},r.createElement(o.HeaderCell,{className:"license-key-header"},a._("Key")),r.createElement(o.HeaderCell,{className:"license-redeemed-header"},a._("Redeemed")),r.createElement(o.HeaderCell,{className:"license-duration-header"},a._("Duration")),r.createElement(o.HeaderCell,{className:"license-status-header"},a._("Status")))),r.createElement(o.TableFooter,{className:"license-footer"},n.buildLicenseFooter()),r.createElement(o.TableBody,null,e.map(function(e,t){if(!(t>=n.state.maxShow))return r.createElement(o.BodyRow,{className:"license-body-row "+(e.activated?"activated":"unused"),key:e.key},r.createElement(o.BodyCell,{className:"license-key"},e.key),r.createElement(o.BodyCell,{className:"license-redeemded"},e.redeemed_date),r.createElement(o.BodyCell,{className:"license-duration"},n.buildDuration(e)),r.createElement(o.BodyCell,{className:"license-status"},n.buildStatus(e)))}))))},n.state={maxShow:3,showViewMore:!1},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.setState(function(e,t){return{showViewMore:e.maxShow<t.licenseKeys.length}})},t.prototype.render=function(){return r.createElement("div",{className:"license-keys"},r.createElement(s.KeyValueBlock,{className:"redeem-license-key",keyText:a._("License keys"),linkText:a._("Redeem a license key"),onLinkClick:this.handleRedeemClick,subtext:a._("License keys will be applied before any other form of payment method")}),this.buildLicenseKeyTable())},t})(r.Component);t.LicenseKeys=l(c,["/static/css/account/pagelet/license_keys-vfltd2Jh8.css"])}),define("modules/clean/account_page/widgets/plan/action_creators",["require","exports","tslib","modules/clean/account_page/widgets/plan/api","modules/clean/account_page/util"],function(e,t,n,a,i){"use strict";function r(e){var t=this;return function(r,l){return n.__awaiter(t,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return"never_loaded"===l().planTab.loadingState||e?(r({type:"plan_tab_load_info"}),[4,a.getPlanInfo(i.getCurrentUser().id)]):[3,2];case 1:return t=n.sent(),r({type:"plan_tab_info_loaded",planInfo:t}),[2,!0];case 2:return[2,!1]}})})}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadDataIfNecessary=r}),define("modules/clean/account_page/widgets/plan/add_ons/action_creators",["require","exports","tslib","modules/clean/account_page/util","modules/clean/account_page/widgets/plan/add_ons/api"],function(e,t,n,a,i){"use strict";function r(e){var t=this;return function(r,l){return n.__awaiter(t,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return"never_loaded"===l().planTab.evhLoadingState||e?(r({type:"load_evh_info"}),[4,i.getEvhInfo(a.getCurrentUser().id)]):[3,2];case 1:return t=n.sent(),r({type:"evh_info_loaded",evhInfo:t}),[2,!0];case 2:return[2,!1]}})})}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadEvhInfoIfNecessary=r}),define("modules/clean/account_page/widgets/plan/add_ons/api",["require","exports","tslib","modules/clean/ajax_as_promised"],function(e,t,n,a){"use strict";function i(e){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(t){return[2,a.WebRequest({url:"/account/ajax_get_evh_info",subject_user:e,dataType:"json"})]})})}Object.defineProperty(t,"__esModule",{value:!0}),t.getEvhInfo=i}),define("modules/clean/account_page/widgets/plan/api",["require","exports","tslib","modules/clean/ajax_as_promised"],function(e,t,n,a){"use strict";function i(e){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(t){return[2,a.WebRequest({url:"/account/ajax_plan_tab_model",subject_user:e,dataType:"json"})]})})}Object.defineProperty(t,"__esModule",{value:!0}),t.getPlanInfo=i}),define("modules/clean/account_page/widgets/plan/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CHANGE_IND_PLAN_MODAL_UPDATED="change_inv_plan_modal:updated"}),define("modules/clean/account_page/widgets/plan/plan_spectrum/types",["require","exports","tslib","modules/clean/growth/user_action/tracker"],function(e,t,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.BasicView="uj_plan_spectrum_upsell_basic_user_view",e.BasicPlusClick="uj_plan_spectrum_upsell_basic_user_plus_click",e.BasicProClick="uj_plan_spectrum_upsell_basic_user_pro_click",e.BasicUpgradeClick="uj_plan_spectrum_upsell_basic_user_upgrade_click",e.PlusView="uj_plan_spectrum_upsell_plus_user_view",e.PlusProClick="uj_plan_spectrum_upsell_plus_user_pro_click",e.PlusChangePlanClick="uj_plan_spectrum_upsell_plus_user_change_plan_click"})(t.PlanSpectrumActions||(t.PlanSpectrumActions={}));(function(e){e.Basic="basic",e.Plus="plus",e.Professional="pro"})(t.PlanType||(t.PlanType={}));var i=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.project="uj_plan_spectrum_upsell",t}return n.__extends(t,e),t})(a.GrowthUserActionTracker);t.PlanSpectrumTracker=i}),define("modules/clean/account_page/widgets/plan/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.MONTHLY=1]="MONTHLY",e[e.YEARLY=2]="YEARLY",e[e.PLUS=3]="PLUS",e[e.PROFESSIONAL=4]="PROFESSIONAL",e[e.ADD_EVH=5]="ADD_EVH",e[e.REMOVE_EVH=6]="REMOVE_EVH"})(t.PerformPlanTransition||(t.PerformPlanTransition={}))}),define("modules/clean/account_page/widgets/plan/views/cancel_changes_modal",["require","exports","tslib","external/react","modules/clean/ajax","modules/clean/account_page/widgets/plan/constants","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/react/modal","modules/clean/analytics","modules/clean/payments/skus/subscription_service","modules/constants/trademark","modules/core/i18n","modules/clean/dbmodal_stack","modules/clean/account_page/util","modules/core/notify"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(t){var n=e.call(this,t)||this;return n.onAccept=function(){var e=n.props.cancellationType;n.cancelScheduledChange(e)},new c.SubscriptionService,n.state={submitting:!1},n}return n.__extends(t,e),t.showInstance=function(e){o.Modal.showInstance(a.createElement(t,n.__assign({},e)))},t.prototype.submittingRequest=function(){this.setState(function(e){return e.submitting=!0,e})},t.prototype.doneSubmittingRequest=function(){this.setState(function(e){return e.submitting=!1,e})},t.prototype.cancelScheduledChange=function(e){var t=this,n=this.props.transitionPerformed;this.submittingRequest(),i.WebRequest({url:"/account/ajax_cancel_scheduled_change",data:{scheduled_change_type:e},subject_user:m.getCurrentUser().id,success:function(a){_.Notify.success(d._("You’ve cancelled your change!")),e===l.CancellationType.SCHEDULE&&s.ProEventsLogger.log("de_change_billing_cancel_change"),e===l.CancellationType.EVH_ADDON&&s.ProEventsLogger.log("de_evh_modal_cancel_change"),n&&n(),t.doneSubmittingRequest(),o.Modal.close(),t.props.reOpenModalDialogAfterCancellation&&p.DBModalStack.trigger(r.CHANGE_IND_PLAN_MODAL_UPDATED,null)},error:function(){_.Notify.error(d._("Failed to cancel changes.")),t.doneSubmittingRequest(),o.Modal.close(),t.props.reOpenModalDialogAfterCancellation&&p.DBModalStack.trigger(r.CHANGE_IND_PLAN_MODAL_UPDATED,null)}})},t.prototype.render=function(){var e=this.props,t=e.cancellationType,n=e.subStatus;if(!n.subState.plan||!n.subState.billingSchedule)return a.createElement("noscript",null);var i,r=d._("Confirm cancelling change");switch(t){case l.CancellationType.PLAN:i=d._("You’re cancelling your scheduled plan change. Your Dropbox %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({trademark_plus:u.TRADEMARK_PLUS,plan:n.subState.plan.displayName(),date:n.subState.formattedNextBillingDate,schedule:n.finalSubState.billingSchedule.scheduleDescriptionAdjective});break;case l.CancellationType.SCHEDULE:i=d._("You’re cancelling your scheduled billing change. Your Dropbox %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({plan:n.finalSubState.plan.displayName(),date:n.subState.formattedNextBillingDate,schedule:n.subState.billingSchedule.scheduleDescriptionAdjective});break;case l.CancellationType.EVH_ADDON:i=d._("You’re cancelling your EVH changes. Your Dropbox %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({plan:n.finalSubState.plan.displayName(),date:n.subState.formattedNextBillingDate,schedule:n.finalSubState.billingSchedule.scheduleDescriptionAdjective});break;case l.CancellationType.IND_SUBSCRIPTION:r=d._("Confirmation"),i=d._("By confirming, your downgrade to Dropbox Basic scheduled change will be cancelled.");break;case l.CancellationType.ALL:r=d._("Confirmation"),i=d._("By confirming, all existing scheduled changes will be cancelled.");break;default:r=d._("Confirmation"),i=d._("By confirming, the scheduled change will be cancelled.")}return a.createElement(o.Modal,{acceptButtonDisabled:this.state.submitting,acceptButtonText:d._("Confirm"),autoClose:!1,dismissButtonText:d._("Don’t cancel"),onAccept:this.onAccept,title:r,submitting:this.state.submitting},a.createElement("p",null,i))},t})(a.Component);t.CancelChangesModalConfirmationView=h}),define("modules/clean/account_page/widgets/plan/views/cancel_subs_warning_modal",["require","exports","tslib","modules/clean/ajax","modules/clean/react/css","modules/core/notify","external/react","modules/core/i18n","modules/clean/account_page/util","modules/clean/static_urls","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/react/modal","spectrum/button"],function(e,t,n,a,i,r,l,o,s,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(t){var n=e.call(this,t)||this;return n.onDismiss=function(e){e.preventDefault(),d.Modal.close()},n.onAccept=function(){n.cancelScheduledChange()},n.state={submitting:!1},n}return n.__extends(t,e),t.showInstance=function(e){d.Modal.showInstance(l.createElement(t.cancelChangesModalConfirmationView,n.__assign({},e)))},t.prototype.submittingRequest=function(){this.setState(function(e){return e.submitting=!0,e})},t.prototype.doneSubmittingRequest=function(){this.setState(function(e){return e.submitting=!1,e})},t.prototype.cancelScheduledChange=function(){var e=this,t=this.props,n=t.transitionPerformed,i=t.userIdOverride,l=null;l=i?i:s.getCurrentUser().id,this.submittingRequest(),a.WebRequest({url:"/account/ajax_cancel_scheduled_change",data:{scheduled_change_type:u.CancellationType.IND_SUBSCRIPTION},subject_user:l,success:function(t){r.Notify.success(o._("You’ve cancelled your change!")),n&&n(),e.doneSubmittingRequest(),d.Modal.close()},error:function(){r.Notify.error(o._("Failed to cancel changes.")),e.doneSubmittingRequest(),d.Modal.close()}})},t.prototype.render=function(){var e=this.props.subStatus,t=this.state.submitting;if(!e)return l.createElement("noscript",null);var n=l.createElement("div",{className:"loading-indicator"},l.createElement("img",{src:c.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:o._("Loading")})),a=t?n:l.createElement("div",null,l.createElement("div",{className:"cancel-subscription-warning-modal__cancel-btn"},l.createElement(p.Button,{variant:"primary",onClick:this.onAccept,disabled:t},o._("Cancel downgrade"))),l.createElement("div",{className:"cancel-subscription-warning-modal__dismiss-btn"},l.createElement("a",{href:"#",onClick:this.onDismiss},o._("Dismiss"))));return l.createElement(d.Modal,{acceptButtonDisabled:this.state.submitting,autoClose:!1,className:"cancel-subscription-warning-modal",buttonComponent:l.createElement(d.ModalButtons,null),submitting:this.state.submitting},l.createElement("div",null,l.createElement("p",{className:"cancel-subscription-warning-modal__title"},o._("Plan downgrade scheduled")),l.createElement("p",{className:"cancel-subscription-warning-modal__desc"},o._("Your plan is scheduled to be downgraded to Dropbox Basic on %(date)s.               If you want to make any changes, first cancel your scheduled downgrade.").format({date:e.subState.formattedNextBillingDate})),a))},t.cancelChangesModalConfirmationView=i(t,["/static/css/account/pagelet/cancel_subs_warning-vfl-s2mqh.css"]),t})(l.Component);t.CancelChangesModalConfirmation=m}),define("modules/clean/account_page/widgets/plan/views/cancellable_notifications_view",["require","exports","tslib","external/react","external/react-dom-factories","modules/clean/react/css","modules/core/i18n","modules/clean/account_page/widgets/billing/payment_methods_util","modules/clean/teams/admin/widgets/billing_notifications/cancellable_item","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/payments/skus/constants","modules/clean/react_format","modules/constants/trademark","modules/clean/account_page/widgets/plan/views/cancel_changes_modal"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCancelSubscriptionAction=function(){t.handleCancelActions(c.CancellationType.IND_SUBSCRIPTION)},
t.handleCancelPlanAction=function(){t.handleCancelActions(c.CancellationType.PLAN)},t.handleCancelScheduleAction=function(){t.handleCancelActions(c.CancellationType.SCHEDULE)},t.handleCancelEvhAction=function(){t.handleCancelActions(c.CancellationType.EVH_ADDON)},t.handleCancelActions=function(e){var n=t.props,a=n.subStatus,i=n.transitionPerformed,r=n.reOpenModalDialogAfterCancellation;a&&m.CancelChangesModalConfirmationView.showInstance({subStatus:a,transitionPerformed:i,cancellationType:e,reOpenModalDialogAfterCancellation:r})},t}return n.__extends(t,e),t.prototype.renderCancelSubscriptionNotification=function(){var e=this.props,t=e.subStatus,n=e.scheduledForDowngrade;if(t)return n?a.createElement(s.CancellableItemView,{title:l._("Scheduled plan change"),description:l._("Dropbox Basic"),handleAction:this.handleCancelSubscriptionAction,useCTA:!0}):void 0},t.prototype.renderDowngradePlanNotification=function(){var e=this.props,t=e.subStatus,n=e.scheduledForDowngrade;if(t&&!n){var i=t.scheduledSubState;if(i){var r=t.subState.plan,o=i.plan;if(r&&o&&(r.productType!==o.productType||r.productType===o.productType&&r.productSpec!==o.productSpec)){var c=l._("Dropbox %(scheduled_plan)s").format({trademark_plus:p.TRADEMARK_PLUS,scheduled_plan:o.displayName()});return a.createElement(s.CancellableItemView,{title:l._("Scheduled plan change"),description:c,handleAction:this.handleCancelPlanAction,useCTA:!0,className:"cancel-plan-schedule"})}}}},t.prototype.renderScheduledChange=function(){var e=this.props,t=e.subStatus,n=e.scheduledForDowngrade;if(t&&!n){var i=t.scheduledSubState;if(i&&i.billingSchedule&&t.subState.billingSchedule&&t.subState.billingSchedule.id!==i.billingSchedule.id){var r=i.billingSchedule.scheduleDescriptionAdjective;return a.createElement(s.CancellableItemView,{title:l._("Scheduled billing period"),description:l._("%(billing)s billing").format({billing:r.charAt(0).toUpperCase()+r.slice(1)}),handleAction:this.handleCancelScheduleAction,useCTA:!0,className:"cancel-billing-schedule"})}}},t.prototype.renderEvhChange=function(){var e=this.props,t=e.subStatus,n=e.scheduledForDowngrade;if(t&&!n){var i=t.scheduledSubState;if(i)return t.subState.addons.skus.length>0&&1===t.subState.quantityForEvhAddOn()&&0===i.quantityForEvhAddOn()?a.createElement(s.CancellableItemView,{title:l._("Scheduled add-on change"),description:l._("Remove extended version history"),handleAction:this.handleCancelEvhAction,useCTA:!0,className:"cancel-evh-schedule"}):void 0}},t.prototype.appendAllCancellationTypes=function(e){e.push(this.renderCancelSubscriptionNotification()),e.push(this.renderDowngradePlanNotification()),e.push(this.renderScheduledChange()),e.push(this.renderEvhChange())},t.prototype.render=function(){var e=this.props,t=e.displaySingleChangeCancellationItem,n=e.scheduledForDowngrade,r=e.subStatus,s=e.paymentInfo,p=e.hasLicenseKey,m=e.displayNewTotal;if(!r)return a.createElement("noscript",null);if(!s||o.shouldHideBillingChange(s.gateway_id,s.is_reseller_billing))return a.createElement("noscript",null);var _=[];if(!r.finalSubState.plan)return a.createElement("noscript",null);if(t)switch(t){case c.CancellationType.IND_SUBSCRIPTION:_.push(this.renderCancelSubscriptionNotification());break;case c.CancellationType.PLAN:_.push(this.renderDowngradePlanNotification());break;case c.CancellationType.SCHEDULE:_.push(this.renderScheduledChange());break;case c.CancellationType.EVH_ADDON:_.push(this.renderEvhChange());break;case c.CancellationType.ALL:this.appendAllCancellationTypes(_)}if(_=_.filter(function(e){return void 0!==e}),!_.length)return a.createElement("noscript",null);var h="";!n&&m&&(h=l._("Your new %(schedule)s total will be %(total)s.").format({schedule:u.productScheduleToProductScheduleDescription(r.finalSubState.plan.schedule),total:r.nextBillingSummary.total}));var g=a.createElement("div",{className:"cancellable-scheduled-notifications cancellable-scheduled-notifications__header"},d.reactFormat(l._("Changes are scheduled for <strong>%(date)s</strong>.").format({date:r.subState.formattedNextBillingDate}),{strong:i.strong()})," ",h);return a.createElement("div",{className:"cancellable-scheduled-notifications personal-cancellable-scheduled-notifications"},g,!p&&a.createElement("div",{className:"cancellable-scheduled-notifications cancellable-scheduled-notifications__items"},_))},t})(a.Component);t.CancellableNotificationsViewControl=_,t.CancellableNotificationsView=r(_,["/static/css/teams/admin/widgets/billing_notifications/cancellable_scheduled_notifications-vflQdegLi.css"])}),define("modules/clean/account_page/widgets/plan/views/change_plan_modal",["require","exports","tslib","modules/core/browser","modules/clean/react/image","modules/core/notify","external/react","modules/clean/ajax","modules/clean/react/css","modules/clean/react/badge","modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list","modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list_item","modules/clean/account_page/widgets/plan/constants","modules/constants/individual_invoice_modal","modules/clean/account_page/widgets/plan/views/cancel_changes_modal","modules/clean/payments/validation","modules/clean/account_page/widgets/plan/views/cancellable_notifications_view","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/payments/cash","modules/clean/dbmodal_stack","modules/clean/account_page/widgets/plan/views/individual_inline_payment_method","modules/clean/react/modal","modules/clean/analytics","modules/clean/payments/skus/constants","modules/clean/payments/skus/subscription_change_plan","modules/clean/payments/skus/subscription_status","modules/constants/trademark","modules/core/i18n","modules/clean/account_page/util","modules/clean/react_format","modules/clean/static_urls","modules/clean/react/arbor/aspen/elements/arbor_inputs","modules/clean/account_page/widgets/plan/views/pro_upsell_modal_content","modules/clean/account_page/widgets/plan/views/exp_change_plans_modal_redesign","modules/clean/react/payments/error/browser_update_required_modal","modules/clean/react/payments/update_billing_individual/individual_update_billing_modal_loader","modules/clean/payments/billing_info_modal"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m,_,h,g,f,b,y,S,v,P,E,C,w,T,N,x,L,I,D,k,A,M,B,O){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var R;(function(e){e.DEFAULT="default",e.CONFIRM="confirm"})(R=t.ChangePlanMode||(t.ChangePlanMode={}));var U;(function(e){e[e.MONTHLY=1]="MONTHLY",e[e.YEARLY=2]="YEARLY",e[e.PLUS=3]="PLUS",e[e.PROFESSIONAL=4]="PROFESSIONAL"})(U=t.PerformPlanTransition||(t.PerformPlanTransition={}));var V=(function(e){function t(n){var i=e.call(this,n)||this;return i.onAccept=function(){var e,t,n=i.getSubChangePlan();if(n){n.finalSubState.planSku.productType!==E.ProductPlanType.PLUS&&n.finalSubState.planSku.productType!==E.ProductPlanType.STANDARD||(t=U.PROFESSIONAL,e=U.PLUS),n.finalSubState.planSku.productType===E.ProductPlanType.PROFESSIONAL&&(t=U.PLUS,e=U.PROFESSIONAL),i.setState(function(e){return{showErrors:!0}});var l=i.state,s=l.vat,c=l.paymentMethod;if(c&&c.country_code&&i.vatValidator(c.country_code,s))if(P.ProEventsLogger.log("de_change_plan_modal_confirm_change_click"),e&&t){i.setState(function(e){return{submitting:!0}});var u={transition_change_type:e};s&&(u.vat=s,P.ProEventsLogger.log("vat_provided_on_upgrade")),o.WebRequest({url:"/account/perform_personal_transition",data:u,subject_user:i.getUserId(),success:function(l){if(r.Notify.success(N._("You’ve changed your plan!")),i.removeShowModalParams(),i.logChangePlan(t,e),i.props.transitionPerformed&&i.props.transitionPerformed(),n.finalSubState.planSku.productType===E.ProductPlanType.PROFESSIONAL){if(i.state.expSubgrowthProConfirmationPage)return a.redirect("/professional_onboarding");i.setState({displayUpgradedToProfessionalContent:!0,loadingContent:!1,submitting:!1})}else i.closeModals()},error:function(){r.Notify.error(N._("There was an error changing the plan!")),i.setState(function(e){return{submitting:!1}})}})}else r.Notify.error(N._("There was an error changing the plan!"))}},i.onDismiss=function(){P.ProEventsLogger.log("de_change_plan_modal_cancel_click"),i.closeProPlansRedesignModal()},i.closeModals=function(){v.Modal.close(),i.closeProPlansRedesignModal()},i.renderVat=function(){var e=null;if(!i.vatDisplayEnabled)return e;var t=i.state,n=t.vat,a=t.paymentMethod,r=t.showErrors,o=a&&a.country_code?a.country_code:void 0;if(o){var s=h.getVatPrefix(o),c=N._("Please enter a valid VAT number, e.g. %(examples)s.").format({examples:h.getVatExamples(o).join(", ")});e=l.createElement(D.ArborTextInput,{name:"vat",placeholderText:s,labelText:N._("VAT number (optional)"),isValid:!r||i.vatValidator(o,n),errorText:c,value:n,onChange:i.onVatChange})}return e},i.onVatChange=function(e,t,n){var a=n;i.setState(function(e){return{vat:a,loadingChangeSummary:!0,showErrors:!1}});var r=i.state.paymentMethod;r&&r.country_code&&i.repriceTransitions(h.validateVat(r.country_code,a)?a:"")},i.renderPaymentMethod=function(){var e=i.state.paymentMethod;if(!i.isPlanScheduledToChange())return l.createElement("div",{className:"upgrade-payment-method-link"},l.createElement(S.IndividualInlinePaymentMethodView,{paymentMethod:e,paymentErrorMessage:N._("Please update your billing information to change your plan."),updateBillingCTA:i.updateBillingInfo}))},i.updateBillingInfo=function(e){v.Modal.close(),y.DBModalStack.register(O.BILLING_INFO_UPDATED,function(){t.showInstance(i.props)}),i.props.browserUpdateRequired?M.BrowserUpdateModalLoader.showInstance():B.IndividualUpdateBillingModalLoader.showInstance()},i.handleCancelScheduleAction=function(e){i.handleCancelActions(f.CancellationType.SCHEDULE),e.preventDefault()},i.handleCancelActions=function(e){var t=i.state.subStatus;return t&&_.CancelChangesModalConfirmationView.showInstance({subStatus:t,transitionPerformed:i.props.transitionPerformed,cancellationType:e,reOpenModalDialogAfterCancellation:!0}),!1},i.transitionPerformedClosure=function(e){if(i.props.transitionPerformed)return i.props.transitionPerformed()},i.getStartedClick=function(){a.redirect("/professional_onboarding")},i.closeProPlansRedesignModal=function(){var e=i.state.expProPlansModalV2;e&&"V1"===e&&i.setState({open:!1})},i.state={loadingContent:!0,schedule:E.ScheduleId.MONTHLY,subChangePlans:[],submitting:!1,type:E.ProductPlanType.STANDARD,displayUpgradedToProfessionalContent:!1,showErrors:!1,vat:"",loadingChangeSummary:!1,open:!0,expUjRebillUpsellVariant:"OFF"},i}return n.__extends(t,e),t.prototype.getUrlOption=function(e){var t=e,n=a.get_href().match(/option=([a-zA-Z_]*)/);if(n&&n.length>1){var i=n[1];"plus"===i&&(t=e===E.ProductPlanType.PROFESSIONAL?E.ProductPlanType.PLUS:e),"pro"===i&&(t=E.ProductPlanType.PROFESSIONAL)}return t},t.showInstance=function(e){v.Modal.showInstance(l.createElement(t.ChangePlanModal,n.__assign({},e)))},t.prototype.componentDidMount=function(){this.loadPlanTransitions()},t.prototype.onLoadPlanTransitions=function(e){var t=this;this.setState(function(n){var a=w.SubscriptionStatus.deserialize(e.serializedSubStatus),i=e.paymentMethod,r=a.finalSubState;if(!r.billingSchedule||!r.plan)throw"A base plan is required, in order to change it.";var l=a.subState.billingSchedule.id,o=e.serializedSubChangePlans.map(function(e){return C.SubscriptionChangePlan.deserialize(e)}),s=o.map(function(e){return e});s.push(a);var c=t.getUrlOption(a.subState.plan.productType),u=t.props.mode||R.DEFAULT,d=e.exp_subgrowth_pro_plans_modal_simplification||"OFF",p=e.exp_subgrowth_pro_change_plans_redesign_v2||"OFF";return(["V1","V2","V3"].includes(d)||["V1","V2"].includes(p))&&u===R.DEFAULT&&(c=E.ProductPlanType.PROFESSIONAL),{loadingContent:!1,subStatus:a,paymentMethod:i,schedule:l,subChangePlans:o,allSubStatuses:s,type:c,expProPlansModal:d,expProPlansModalV2:p,expSubgrowthProConfirmationPage:e.exp_subgrowth_pro_confirmation_page||!1,mode:u,expUjRebillUpsellVariant:e.exp_uj_rebill_upsell_variant||"OFF"}})},t.prototype.loadPlanTransitions=function(){var e=this;this.retrieveViewModel(function(t){e.onLoadPlanTransitions(t)},this.onLoadTransitionsError)},t.prototype.onLoadTransitionsError=function(){r.Notify.error(N._("Failed to load modal.")),this.closeModals()},t.prototype.onRepriceTransitions=function(e){this.setState(function(t){var n=w.SubscriptionStatus.deserialize(e.serializedSubStatus),a=e.serializedSubChangePlans.map(function(e){return C.SubscriptionChangePlan.deserialize(e)}),i=a.map(function(e){return e});i.push(n);return{subStatus:n,subChangePlans:a,allSubStatuses:i,loadingChangeSummary:!1}})},t.prototype.onRepriceError=function(){r.Notify.error(N._("Request failed")),this.closeModals()},t.prototype.repriceTransitions=function(e){var t=this;this.retrieveViewModel(function(e){t.onRepriceTransitions(e)},this.onRepriceError,e)},t.prototype.getUserId=function(){return this.props.userIdOverride?this.props.userIdOverride:x.getCurrentUser().id},t.prototype.retrieveViewModel=function(e,t,n){var a=this,i=this.state,r=i.withVat,l=i.withoutVat,s=n?{vat:n}:void 0,c=n?r:l;c?e(c):o.WebRequest({url:"/account/ajax_change_plan",data:s,subject_user:this.getUserId(),success:function(t){var i=JSON.parse(t);a.setState(function(e){return n?{withVat:i}:{withoutVat:i}}),e(i)},error:t})},t.prototype.getSubChangePlan=function(e){return void 0===e&&(e=this.state.type),this.state.subChangePlans.filter(function(t){var n=t.finalSubState;return!(!n.plan||!n.billingSchedule)&&n.plan.productType===e}).pop()},Object.defineProperty(t.prototype,"hasTypeChanged",{get:function(){var e=this.state.subStatus;return e&&e.finalSubState.plan&&e.finalSubState.plan.productType!==this.state.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasCurrentPlanChanged",{get:function(){return this.hasTypeChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subStatusScheduleId",{get:function(){var e=this.state.subStatus;return e&&e.finalSubState.billingSchedule?e.finalSubState.billingSchedule.id:E.ScheduleId.MONTHLY},enumerable:!0,configurable:!0}),t.prototype.logChangePlan=function(e,t){var n=this.state.subStatus;n&&n.subState.billingSchedule&&P.ProEventsLogger.log("de_change_plan_modal_change_plan",{from:e===U.PLUS?T.TRADEMARK_PLUS:"Professional",to:t===U.PROFESSIONAL?"Professional":T.TRADEMARK_PLUS})},t.prototype.removeShowModalParams=function(){var e=a.get_href().match(/modal=([a-zA-Z_]*)/);if(e&&e.length>1){"plan"===e[1]&&window.history.replaceState({},document.title,a.get_href().split("?")[0])}},t.prototype.changeProductPlanAndScheduleType=function(e,t){e===E.ProductPlanType.PROFESSIONAL?P.ProEventsLogger.log("de_change_plan_modal_professional_section_click"):P.ProEventsLogger.log("de_change_plan_modal_plus_section_click"),this.setState(function(n){return{type:e,schedule:t}})},t.prototype.getPlanDescription=function(e){var t=e.content&&e.content.spaceShortFormTb();switch(e.productType){case E.ProductPlanType.STANDARD:case E.ProductPlanType.PLUS:return t?N._("Stress-free sharing, offline folders on mobile, and %(plan_space)s storage.").format({plan_space:t}):N._("Stress-free sharing and offline folders on mobile.");case E.ProductPlanType.PROFESSIONAL:return t?N._("Smart Sync, Showcase, shared link controls, and %(plan_space)s storage.").format({plan_space:t}):N._("Smart Sync, Showcase, and shared link controls.")}return""},t.prototype.changeProductPlanAndScheduleTypeClosure=function(e,t){var n=this;return function(){n.changeProductPlanAndScheduleType(e,t)}},t.prototype.renderPlanItems=function(){var e=this,t=this.state,n=t.type,a=t.allSubStatuses,i=t.subStatus,r=[E.ProductPlanType.STANDARD,E.ProductPlanType.PLUS,E.ProductPlanType.PROFESSIONAL];if(a&&i)return a.filter(function(t){return!!(t.finalSubState.plan&&i.subState.plan&&i.finalSubState.plan&&i.subState.planSku&&i.finalSubState.planSku&&i.subState.billingSchedule&&t.finalSubState.billingSchedule)&&(!e.isBillingScheduleToChange()||t.subState.billingSchedule.id===i.subState.billingSchedule.id)}).sort(function(e,t){return e.finalSubState.plan&&t.finalSubState.plan?r.indexOf(e.finalSubState.plan.productType)-r.indexOf(t.finalSubState.plan.productType):0}).map(function(t){var a=t.finalSubState.plan,r=t.finalSubState.billingSchedule;if(a&&r&&!(i&&i.subState&&i.subState.plan&&i.subState.plan.isLegacyPlan&&a.isAdvancePlan)&&i.scheduledSubState&&i.scheduledSubState.billingSchedule&&t&&t.subState.billingSchedule&&t.finalSubState.plan&&t.finalSubState.billingSchedule&&i.subState.billingSchedule&&i.subState.plan){var o,s=void 0,u=i.isOnTrial?i.finalSubState.plan:i.subState.plan;u&&a.productType===u.productType&&(o=N._("(current plan)"));var p=l.createElement("span",null,l.createElement("br",null),l.createElement("a",{href:"/plans",target:"_blank",rel:"noreferrer noopener"},N._("See plan details"))),m=N._("Dropbox %(plan_name)s").format({plan_name:a.displayName()}),_=void 0;e.state.expUjRebillUpsellVariant&&"V1"===e.state.expUjRebillUpsellVariant&&e.props.mode===R.CONFIRM&&a.productType===E.ProductPlanType.PROFESSIONAL&&(_={variant:c.BadgeVariant.NEW,color:c.BadgeColor.NEON_GREEN});var h=u&&a.productType===u.productType?e.getPlanDescription(u):e.getPlanDescription(a);return l.createElement(d.AdminPricedListItem,{key:a.code,isSelected:n===a.productType,title:m,titleWarningText:s,titleSecondaryText:o,description:h,detailsLink:p,price:a.displayCost,unit:a.billingSchedule.id===E.ScheduleId.MONTHLY?N._("per month"):N._("per year"),onClick:e.changeProductPlanAndScheduleTypeClosure(a.productType,r.id),disableItem:e.isPlanScheduledToChange(),badge:_})}})},t.prototype.getProfessionalPlanSkuForModalExperiments=function(){var e=this,t=this.state,n=t.allSubStatuses,a=t.subStatus;if(!n||!a)return null;for(var i,r=n.filter(function(t){return!!(t.finalSubState.plan&&a.subState.plan&&a.finalSubState.plan&&a.subState.planSku&&a.finalSubState.planSku&&a.subState.billingSchedule&&t.finalSubState.billingSchedule)&&(!e.isBillingScheduleToChange()||t.subState.billingSchedule.id===a.subState.billingSchedule.id)}),l=0,o=r;l<o.length;l++){var s=o[l];s.finalSubState.plan.productType===E.ProductPlanType.PROFESSIONAL&&(i=s)}return i&&i.finalSubState.plan?i.finalSubState.plan:null},t.prototype.renderSubgrowthProPlansModalSimplificationExperiment=function(){var e=this.state,t=e.expProPlansModal,n=e.expProPlansModalV2,a=this.getProfessionalPlanSkuForModalExperiments();return t&&a?l.createElement(k.ProUpsellModalContent,{expProPlansModalVariant:t,expProPlansModalV2Variant:n,price:a.displayCost,unit:a.billingSchedule.id===E.ScheduleId.MONTHLY?N._("per month"):N._("per year"),quota:a.content&&a.content.spaceLongFormRounded()}):null},t.prototype.renderBillingSection=function(){var e=this.props.mode||R.DEFAULT;return l.createElement("div",null,this.state.expProPlansModal&&e===R.DEFAULT&&["V1","V2","V3"].indexOf(this.state.expProPlansModal)>-1?this.renderSubgrowthProPlansModalSimplificationExperiment():l.createElement(u.AdminPricedList,null,this.renderPlanItems()),this.renderVat())},t.prototype.vatValidator=function(e,t){return!t||h.validateVat(e,t)},t.prototype.isScheduledToChange=function(){return this.isPlanScheduledToChange()||this.isBillingScheduleToChange()||this.isEvhScheduledToChange()},t.prototype.isEvhScheduledToChange=function(){var e=this.state.subStatus;return!(!e||!e.scheduledSubState)&&e.subState.quantityForEvhAddOn()!==e.scheduledSubState.quantityForEvhAddOn()},t.prototype.isPlanScheduledToChange=function(){var e=this.state.subStatus;return!!(e&&e.subState.plan&&e.finalSubState.plan)&&e.subState.plan.productType!==e.finalSubState.plan.productType},t.prototype.isBillingScheduleToChange=function(){var e=this.state.subStatus;return!!(e&&e.subState.billingSchedule&&e.finalSubState.billingSchedule)&&e.subState.billingSchedule.id!==e.finalSubState.billingSchedule.id},t.prototype.getPlanNameWithEvhText=function(e){var t=this.state.subStatus;return t&&t.scheduledSubState&&t.scheduledSubState.quantityForEvhAddOn()>0?e+" "+N._("+ extended version history"):e},t.prototype.renderScheduleTransitionText=function(){var e=this.state.subStatus,t=this.getSubChangePlan();if(e&&e.subState.plan){var n=l.createElement("a",{href:"#",onClick:this.handleCancelScheduleAction},N._("Cancel change"));if(this.isPlanScheduledToChange())return l.createElement("span",{className:"plan-transition"},N._("You’ve already requested a change to your plan. If you want           to choose a different plan or billing period, first cancel your pending change.")," ",n);if((!t||e.subState.planSku.productType===t.finalSubState.planSku.productType)&&e.subState.billingSchedule&&e.currentBillingSummary){if(!this.isScheduledToChange())return l.createElement("span",{className:"plan-transition"},N._("Your Dropbox %(plan)s plan will renew on %(date)s.                 Your current %(schedule)s total is %(recurring_total)s.").format({plan:this.getPlanNameWithEvhText(e.subState.plan.displayName()),schedule:e.subState.billingSchedule.scheduleDescriptionAdjective,recurring_total:b.Cash.formatWithTaxLabels(e.currentBillingSummary.total,e.currentBillingSummary),date:e.subState.formattedNextBillingDate}));if(e.scheduledSubState&&e.scheduledSubState.plan)return l.createElement("div",null,l.createElement("span",{className:"change-summary"},N._("Change summary")),l.createElement("p",{className:"plan-transition"},L.reactFormat(N._("Starting on %(date)s, we’ll bill you once a %(schedule_noun)s for your Dropbox                     %(plan)s. Your new %(schedule)s total will be %(scheduled_total)s.").format({plan:this.getPlanNameWithEvhText(e.scheduledSubState.plan.displayName()),date:e.subState.formattedNextBillingDate,schedule:e.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,schedule_noun:e.scheduledSubState.billingSchedule.scheduleDescriptionNoun,scheduled_total:b.Cash.formatWithTaxLabels(e.nextBillingSummary.total,e.nextBillingSummary)}),{strong:l.createElement("strong",null)})))}if(t&&t.finalSubState.plan){var a=void 0!==t.tvm;return t&&t.tvm&&a?l.createElement("div",null,l.createElement("span",{className:"change-summary"},N._("Change summary")),l.createElement("p",{className:"plan-transition"},L.reactFormat(N._("You’re upgrading your plan to Dropbox %(plan)s.                 <strong>We’ll charge you %(prorated_price)s now</strong>, which is prorated for the current                 billing period. Starting on %(date)s and until you <cancelLink>cancel</cancelLink>, we’ll bill you once a %(schedule_noun)s and your new                 %(schedule)s total will be %(scheduled_total)s. If you cancel, previous charges won’t be refunded                 <legalLink>unless it’s legally required</legalLink>.").format({plan:this.getPlanNameWithEvhText(t.finalSubState.plan.displayName()),prorated_price:b.Cash.formatWithTaxLabels(t.tvm.getTotalPrice(),t.nextBillingSummary),date:t.subState.formattedNextBillingDate,schedule_noun:t.finalSubState.billingSchedule.scheduleDescriptionNoun,schedule:t.finalSubState.billingSchedule.scheduleDescriptionAdjective,scheduled_total:b.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary)}),{strong:l.createElement("strong",null),cancelLink:l.createElement("a",{href:"/help/billing/cancel-dropbox-plus"}),legalLink:l.createElement("a",{href:"/help/billing/plus-refund"})}))):a?void 0:l.createElement("div",null,l.createElement("span",{className:"change-summary"},N._("Change summary")),l.createElement("p",{className:"plan-transition"},L.reactFormat(N._("Starting on %(date)s, your plan will be downgraded to Dropbox %(plan)s                 and your new %(schedule)s total will be %(scheduled_total)s. Charges will                 continue until you <cancelLink>cancel</cancelLink>, and previous charges won’t be refunded                 <legalLink>unless it’s legally required</legalLink>.").format({plan:this.getPlanNameWithEvhText(t.finalSubState.plan.displayName()),date:e.subState.formattedNextBillingDate,schedule:t.finalSubState.billingSchedule.scheduleDescriptionAdjective,scheduled_total:b.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary)}),{strong:l.createElement("strong",null),cancelLink:l.createElement("a",{href:"/help/billing/cancel-dropbox-plus"}),legalLink:l.createElement("a",{href:"/help/billing/plus-refund"})})))}}},t.prototype.renderChangeFooter=function(){var e;return this.state.loadingChangeSummary?l.createElement("div",{className:"loading-indicator"},l.createElement("img",{src:I.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:N._("Loading")})):(this.isPlanScheduledToChange()||(e=this.renderPaymentMethod()),l.createElement("div",{className:"plan-footer u-font-meta"},this.renderScheduleTransitionText(),e))},Object.defineProperty(t.prototype,"acceptButtonDisabled",{get:function(){var e=this.state.paymentMethod,t=this.state,n=t.loadingContent,a=t.loadingChangeSummary,i=t.submitting;return!(!(n||a||i)&&e)||!this.hasUserSelectedDifferentPlan()},enumerable:!0,configurable:!0}),t.prototype.isValidVatCountry=function(){var e=this.state.paymentMethod;return e&&e.country_code&&h.hasVat(e.country_code)},t.prototype.isUserOnPlus=function(){var e=this.state.subStatus;return e&&e.subState&&e.subState.plan&&e.subState.plan.productType===E.ProductPlanType.PLUS},t.prototype.hasUserSelectedDifferentPlan=function(){return!this.isPlanScheduledToChange()&&this.hasTypeChanged},Object.defineProperty(t.prototype,"vatDisplayEnabled",{get:function(){var e=this.state,t=e.loadingContent,n=e.submitting;return m.INDIVIDUAL_INVOICE_MODAL&&!t&&!n&&this.isValidVatCountry()&&this.isUserOnPlus()&&this.hasUserSelectedDifferentPlan()},enumerable:!0,configurable:!0}),t.prototype.getPlanStrings=function(){var e=this.getProfessionalPlanSkuForModalExperiments();if(e){var t=void 0,n=void 0;e.displayCost&&(t=e.displayCost.toString(),n=e.billingSchedule.id===E.ScheduleId.MONTHLY?N._("Monthly cost"):N._("Yearly cost"));return{priceString:t,scheduleString:n,quotaString:e.content&&e.content.spaceLongFormRounded()}}return null},t.prototype.getBillingSummaryStrings=function(){var e=this.getSubChangePlan();if(e&&e.finalSubState.plan&&e.tvm){return{scheduledPriceString:e.nextBillingSummary.total.toString(),proratedPriceString:e.tvm.getTotalPrice().toString(),changeSummaryString:L.reactFormat(N._("You’re upgrading to Dropbox %(plan)s.           <strong>We’ll charge you %(prorated_price)s now</strong>,           which has been prorated for the current billing period.           Your plan will renew on %(date)s. Your new %(schedule)s total           will be %(scheduled_total)s.").format({plan:this.getPlanNameWithEvhText(e.finalSubState.plan.displayName()),prorated_price:b.Cash.formatWithTaxLabels(e.tvm.getTotalPrice(),e.nextBillingSummary),date:e.subState.formattedNextBillingDate,schedule:e.finalSubState.billingSchedule.scheduleDescriptionAdjective,scheduled_total:b.Cash.formatWithTaxLabels(e.nextBillingSummary.total,e.nextBillingSummary)}),{strong:l.createElement("strong",null)})}}return null},t.prototype.render=function(){var e,a=this,r=this.props,o=r.transitionPerformed,s=r.paymentInfo,c=r.mode,u=this.state,d=u.subStatus,m=u.displayUpgradedToProfessionalContent,_=u.loadingContent,h=u.submitting,b=u.type,S=u.expProPlansModal,P=u.expProPlansModalV2,E=N._("Change plan"),C=N._("Cancel"),w=N._("Confirm change");if(d&&m)w="",C="",e=l.createElement("div",{className:"upgrade-to-professional"},l.createElement(i.Image,{className:"upgrade-to-professional__img",src:I.static_url("/static/images/account_page/successful-upgrade-conf-vfljF71a-.png"),srcHiRes:I.static_url("/static/images/account_page/successful-upgrade-conf@2x-vflKbwL4c.png"),alt:N._("")}),l.createElement("h3",{className:"upgrade-to-professional__title"},N._("Congrats! You’ve upgraded to Dropbox Professional")),l.createElement("p",{className:"upgrade-to-professional__desc"},N._("Get ready to take advantage of advanced features like Smart Sync, Showcase, and more support options.")),l.createElement("button",{className:"button-primary upgrade-to-professional_cta_btn",onClick:this.getStartedClick},N._("Got it")));else if(_)E=N._("Loading account details..."),e=l.createElement("div",{className:"loading-indicator"},l.createElement("img",{src:I.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:N._("Loading")}));else{var T=void 0;if(d&&o){y.DBModalStack.clear(),y.DBModalStack.register(p.CHANGE_IND_PLAN_MODAL_UPDATED,function(){t.showInstance(n.__assign({},a.props,{transitionPerformed:a.transitionPerformedClosure}))}),T=l.createElement(g.CancellableNotificationsView,{subStatus:d,transitionPerformed:this.transitionPerformedClosure,displaySingleChangeCancellationItem:f.CancellationType.ALL,reOpenModalDialogAfterCancellation:!0,paymentInfo:s,displayNewTotal:!1})}if(e=l.createElement("div",null,T,this.renderBillingSection(),this.renderChangeFooter()),c===R.CONFIRM&&d&&this.state.expUjRebillUpsellVariant&&["V1","V2"].indexOf(this.state.expUjRebillUpsellVariant)>=0)E=N._("Confirm plan"),d.finalSubState.plan.productType===b?(w=null,C=N._("Confirm")):(w=N._("Upgrade plan"),C=null);else{if(P&&"V1"===P){var x=n.__assign({},this.getPlanStrings(),this.getBillingSummaryStrings());return l.createElement(A.ExpChangePlanRedesignModal,{onAccept:this.onAccept,onDismiss:this.onDismiss,open:this.state.open,planAndPricingContent:x,scheduledNotifications:T,submitting:this.state.submitting,loadingChangeSummary:this.state.loadingChangeSummary,renderVat:this.renderVat,renderPaymentMethod:this.renderPaymentMethod})}S&&["V1","V2","V3"].includes(S)&&(E=N._("Upgrade account"),w=N._("Upgrade now"))}}return l.createElement(v.Modal,{acceptButtonDisabled:this.acceptButtonDisabled,acceptButtonText:w,className:"change-plan-modal",dismissButtonText:C,autoClose:!1,onAccept:this.onAccept,onDismiss:this.onDismiss,submitting:h,title:E},e)},t.ChangePlanModal=s(t,["/static/css/teams/admin/widgets/change_plan_modal/change_plan_modal-vflEOD55p.css"]),t})(l.Component);t.ChangePlanModalView=V}),define("modules/clean/account_page/widgets/plan/views/change_schedule_modal",["require","exports","tslib","modules/core/notify","external/react","modules/clean/ajax","modules/clean/react/css","modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list","modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list_item","modules/clean/payments/billing_info_modal","modules/clean/react/payments/error/browser_update_required_modal","modules/clean/account_page/widgets/plan/constants","modules/clean/account_page/widgets/plan/views/cancel_changes_modal","modules/clean/account_page/widgets/plan/views/cancellable_notifications_view","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/payments/cash","modules/clean/dbmodal_stack","modules/clean/account_page/widgets/billing/payment_methods_util","modules/clean/account_page/widgets/plan/views/individual_inline_payment_method","modules/clean/react/payments/update_billing_individual/individual_update_billing_modal_loader","modules/clean/react/modal","modules/clean/account_page/widgets/plan/views/change_plan_modal","modules/clean/analytics","modules/clean/payments/skus/constants","modules/clean/payments/skus/subscription_change_plan","modules/clean/payments/skus/subscription_status","modules/core/i18n","modules/clean/account_page/util","modules/clean/react_format","modules/clean/static_urls"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m,_,h,g,f,b,y,S,v,P,E,C,w,T,N,x,L){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var I=(function(e){function t(n){var i=e.call(this,n)||this;return i.onAccept=function(){var e,t,n=i.getSubChangePlan();n&&(n.finalSubState.billingSchedule.id===E.ScheduleId.MONTHLY&&(t=v.PerformPlanTransition.YEARLY,e=v.PerformPlanTransition.MONTHLY),n.finalSubState.billingSchedule.id===E.ScheduleId.YEARLY&&(t=v.PerformPlanTransition.MONTHLY,e=v.PerformPlanTransition.YEARLY),e&&t?(i.setState(function(e){return e.submitting=!0,e}),r.WebRequest({url:"/account/perform_personal_transition",data:{
transition_change_type:e},subject_user:N.getCurrentUser().id,success:function(e){a.Notify.success(T._("You’ve changed your billing period!")),i.logChangeSchedule(),i.props.transitionPerformed&&i.props.transitionPerformed(),S.Modal.close()},error:function(){a.Notify.error(T._("There was an error changing the billing period!")),i.setState(function(e){return e.submitting=!1,e})}})):a.Notify.error(T._("There was an error changing the billing period!")))},i.updateBillingInfo=function(e){S.Modal.close(),g.DBModalStack.register(c.BILLING_INFO_UPDATED,function(){t.showInstance(i.props)}),i.props.browserUpdateRequired?u.BrowserUpdateModalLoader.showInstance():y.IndividualUpdateBillingModalLoader.showInstance()},i.handleCancelScheduleAction=function(){return i.handleCancelActions(_.CancellationType.SCHEDULE),!1},i.handleCancelActions=function(e){var t=i.state.subStatus;return t&&p.CancelChangesModalConfirmationView.showInstance({subStatus:t,transitionPerformed:i.props.transitionPerformed,cancellationType:e,reOpenModalDialogAfterCancellation:!0}),!1},i.transitionPerformedClosure=function(e){if(i.props.transitionPerformed)return i.props.transitionPerformed()},i.onDismissModal=function(){P.ProEventsLogger.log("de_cancel_billing_change_modal")},i.state={loadingContent:!0,schedule:E.ScheduleId.MONTHLY,subChangePlans:[],submitting:!1,type:E.ProductPlanType.STANDARD,hasLicenseKey:!1},i}return n.__extends(t,e),Object.defineProperty(t.prototype,"isProfessionalTrialPlan",{get:function(){var e=this.state.subStatus;return!(!e||!e.subState.plan)&&e.subState.plan.productType===E.ProductPlanType.PROFESSIONAL_TRIAL},enumerable:!0,configurable:!0}),t.showInstance=function(e){S.Modal.showInstance(i.createElement(t.ChangeScheduleModal,n.__assign({},e)))},t.prototype.componentDidMount=function(){this.loadPlanTransitions()},t.prototype.loadPlanTransitions=function(){var e=this;r.WebRequest({url:"/account/ajax_change_plan_schedule",subject_user:N.getCurrentUser().id,success:function(t){var n=JSON.parse(t);e.setState(function(e){e.loadingContent=!1,e.subStatus=w.SubscriptionStatus.deserialize(n.serializedSubStatus),e.paymentMethod=n.paymentMethod,e.hasLicenseKey=n.hasLicenseKey;var t=e.subStatus.finalSubState;if(!t.billingSchedule||!t.plan)throw"A base plan is required, in order to change it.";return e.hasLicenseKey?e.schedule=e.subStatus.scheduledSubState.billingSchedule.id:e.schedule=e.subStatus.subState.billingSchedule.id,e.subChangePlans=n.serializedSubChangePlans.map(function(e){return C.SubscriptionChangePlan.deserialize(e)}),e.allSubStatuses=e.subChangePlans.map(function(e){return e}),e.allSubStatuses.push(e.subStatus),e.type=e.subStatus.subState.plan.productType,e})},error:function(){a.Notify.error(T._("Failed to load modal.")),S.Modal.close()}})},t.prototype.getSubChangePlan=function(e,t){return void 0===e&&(e=this.state.type),void 0===t&&(t=this.state.schedule),this.state.subChangePlans.filter(function(n){var a=n.finalSubState;return!(!a.plan||!a.billingSchedule)&&(a.plan.productType===e&&a.billingSchedule.id===t)}).pop()},Object.defineProperty(t.prototype,"hasTypeChanged",{get:function(){var e=this.state.subStatus;return e&&e.finalSubState.plan&&e.finalSubState.plan.productType!==this.state.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasScheduleChanged",{get:function(){var e=this.state.subStatus;return e&&e.finalSubState.billingSchedule&&e.finalSubState.billingSchedule.id!==this.state.schedule},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasCurrentPlanChanged",{get:function(){return this.hasTypeChanged||this.hasScheduleChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subStatusScheduleId",{get:function(){var e=this.state.subStatus;return e&&e.finalSubState.billingSchedule?e.finalSubState.billingSchedule.id:E.ScheduleId.MONTHLY},enumerable:!0,configurable:!0}),t.prototype.logChangeSchedule=function(){var e=this.state.subStatus;e&&e.subState.billingSchedule&&P.ProEventsLogger.log("de_change_billing_change_schedule",{from:e.subState.billingSchedule.id===E.ScheduleId.MONTHLY?"yearly":"monthly",to:e.subState.billingSchedule.id===E.ScheduleId.MONTHLY?"monthly":"yearly"})},t.prototype.changeProductPlanAndScheduleType=function(e,t){this.setState(function(n){return n.type=e,n.schedule=t,n})},t.prototype.changeProductPlanAndScheduleTypeClosure=function(e,t){var n=this;return function(){n.changeProductPlanAndScheduleType(e,t)}},t.prototype.getScheduleDescription=function(e,t,n){var a=this.state.subStatus;if(!(e.finalSubState.billingSchedule&&e.finalSubState.plan&&a&&a.scheduledSubState&&a.scheduledSubState.plan&&a.subState.plan))return"";var i=this.getOriginalStatusForCurrentStatus(a.subState.plan.productType,E.ScheduleId.MONTHLY);if(this.isPlanScheduledToChange()&&this.isBillingScheduleToChange()&&(i=this.getSubStatusFromSubChangePlans(a.subState.plan.productType,E.ScheduleId.MONTHLY)),!i||!i.subState.planSku||!i.finalSubState.planSku)return"";var r;r=this.isPlanScheduledToChange()?i.finalSubState.planSku.displayCost.multiply(12):a.subState.billingSchedule.id===E.ScheduleId.MONTHLY?i.subState.planSku.displayCost.multiply(12):i.finalSubState.planSku.displayCost.multiply(12);var l="";switch(l=this.isPlanScheduledToChange()&&this.isBillingScheduleToChange()?a.subState.plan.displayName():a.scheduledSubState.plan.displayName(),e.finalSubState.billingSchedule.id){case E.ScheduleId.YEARLY:var o=n.amount,s=r.amount,c=T.format_percent(Math.round(100*(1-o/s)));return T._("Dropbox %(plan_name)s is %(price_per_year)s per year.           You’ll save %(save_percentage)s over monthly billing.").format({plan_name:l,price_per_year:n,save_percentage:c});case E.ScheduleId.MONTHLY:return T._("Dropbox %(plan_name)s is %(price_per_month)s per month.           You’ll spend %(price_per_year)s per year.").format({plan_name:l,price_per_month:t,price_per_year:n})}return""},t.prototype.getBillingItemTitle=function(e){switch(e){case E.ScheduleId.YEARLY:return T._("Billed yearly");case E.ScheduleId.MONTHLY:return T._("Billed monthly")}return""},t.prototype.getOriginalStatusForCurrentStatus=function(e,t){var n=this,a=this.state,i=a.allSubStatuses,r=a.subStatus;if(i&&r)return i.filter(function(a){return!!(a.finalSubState.plan&&r.finalSubState.plan&&a.finalSubState.billingSchedule)&&((a.subState.plan.productType===e||n.isProfessionalTrialPlan)&&a.finalSubState.billingSchedule.id===t)}).pop()},t.prototype.getSubStatusFromSubChangePlans=function(e,t){var n=this.state,a=n.subChangePlans,i=n.subStatus;if(a&&i)return a.filter(function(n){return!!(n.finalSubState.plan&&i.finalSubState.plan&&n.finalSubState.billingSchedule)&&(n.finalSubState.plan.productType===e&&n.finalSubState.billingSchedule.id===t)}).pop()},t.prototype.renderBillingScheduleItems=function(){var e=this,t=this.state,n=t.allSubStatuses,a=t.subStatus,r=t.schedule,l=t.hasLicenseKey;if(n&&a)return n.filter(function(t){return!!(t.finalSubState.plan&&a.subState.plan&&a.finalSubState.plan)&&(!e.isPlanScheduledToChange()||!e.isBillingScheduleToChange()||t.finalSubState.plan.productType===a.subState.plan.productType)}).sort(function(e,t){return e.finalSubState.billingSchedule&&t.finalSubState.billingSchedule?e.finalSubState.billingSchedule.id-t.finalSubState.billingSchedule.id:0}).map(function(t){var n=t.finalSubState.plan,o=t.finalSubState.billingSchedule;if(n&&o&&a.subState.billingSchedule&&a.subState.plan&&t.finalSubState.billingSchedule){var c=e.getOriginalStatusForCurrentStatus(a.subState.plan.productType,t.finalSubState.billingSchedule.id);if(c&&c.finalSubState.billingSchedule&&t.subState.billingSchedule){var u,d=n.displayCost,p=n.displayCost,m=n.displayCost,_=t.finalSubState.billingSchedule.id,h=a.subState.billingSchedule.id;switch(l&&a.scheduledSubState&&a.scheduledSubState.billingSchedule&&(h=a.scheduledSubState.billingSchedule.id),h){case E.ScheduleId.MONTHLY:u=T._("per month"),_===E.ScheduleId.YEARLY&&(p=d.divide(12),d=p),_===E.ScheduleId.MONTHLY&&(m=p.multiply(12));break;case E.ScheduleId.YEARLY:u=T._("per year"),_===E.ScheduleId.YEARLY&&(p=d.divide(12)),_===E.ScheduleId.MONTHLY&&(m=d.multiply(12),d=m)}var g,f,b=void 0,y=o.id===r;e.isPlanScheduledToChange()&&!e.isProfessionalTrialPlan&&(f=i.createElement("span",null,i.createElement("br",null),i.createElement("a",{href:"/plans",target:"_blank",rel:"noreferrer noopener"},T._("See other plans"))));return a.subState.billingSchedule.id===o.id&&(g=T._("(current billing period)")),i.createElement(s.AdminPricedListItem,{key:n.code,isSelected:y,title:e.getBillingItemTitle(o.id),titleWarningText:b,titleSecondaryText:g,description:e.getScheduleDescription(c,p,m),price:d,detailsLink:f,unit:u,onClick:e.changeProductPlanAndScheduleTypeClosure(n.productType,o.id),disableItem:e.isBillingScheduleToChange()})}}})},t.prototype.renderBillingSection=function(){return i.createElement("div",null,i.createElement(o.AdminPricedList,null,this.renderBillingScheduleItems()))},t.prototype.renderPaymentMethod=function(){var e=this.state.paymentMethod;if(e&&!this.isBillingScheduleToChange())return i.createElement("div",{className:"upgrade-payment-method-link"},i.createElement(b.IndividualInlinePaymentMethodView,{paymentMethod:e,updateBillingCTA:this.updateBillingInfo}))},t.prototype.isPlanScheduledToChange=function(){var e=this.state.subStatus;return!!(e&&e.subState.plan&&e.finalSubState.plan)&&e.subState.plan.productType!==e.finalSubState.plan.productType},t.prototype.isScheduledToChange=function(){return this.isPlanScheduledToChange()||this.isBillingScheduleToChange()||this.isEvhScheduledToChange()},t.prototype.isEvhScheduledToChange=function(){var e=this.state.subStatus;return!(!e||!e.scheduledSubState)&&e.subState.quantityForEvhAddOn()!==e.scheduledSubState.quantityForEvhAddOn()},t.prototype.isBillingScheduleToChange=function(){var e=this.state,t=e.subStatus;return!e.hasLicenseKey&&!!(t&&t.subState.billingSchedule&&t.finalSubState.billingSchedule)&&t.subState.billingSchedule.id!==t.finalSubState.billingSchedule.id},t.prototype.getPlanNameWithEvhText=function(e){var t=this.state.subStatus;return t&&t.scheduledSubState&&t.scheduledSubState.quantityForEvhAddOn()>0?e+" "+T._("+ extended version history"):e},t.prototype.renderScheduleTransitionText=function(){var e=this.state.subStatus,t=this.getSubChangePlan();if(e&&e.subState.plan){var n=i.createElement("a",{href:"#",onClick:this.handleCancelScheduleAction},T._("Cancel change"));if(this.isBillingScheduleToChange())return i.createElement("span",{className:"plan-transition"},T._("You’ve already requested a change to your billing period. If you want             to choose a different billing period, first cancel your pending change.")," ",n);if(this.isProfessionalTrialPlan&&!this.hasScheduleChanged)return i.createElement("div",null,i.createElement("span",{className:"change-summary"},T._("Change summary")),i.createElement("p",{className:"plan-transition"},f.getProfessionalTrialScheduleDescription(e)));if((!t||this.isBillingScheduleToChange())&&e.currentBillingSummary)return this.isScheduledToChange()&&e.scheduledSubState&&e.scheduledSubState.plan?i.createElement("div",null,i.createElement("span",{className:"change-summary"},T._("Change summary")),i.createElement("p",{className:"plan-transition"},x.reactFormat(T._("Starting on %(date)s, we’ll bill you once a %(schedule_noun)s for your                   Dropbox %(plan_name)s plan. Your new %(schedule)s total will be %(scheduled_total)s.").format({plan_name:this.getPlanNameWithEvhText(e.scheduledSubState.plan.displayName()),date:e.subState.formattedNextBillingDate,schedule:e.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,schedule_noun:e.scheduledSubState.billingSchedule.scheduleDescriptionNoun,scheduled_total:h.Cash.formatWithTaxLabels(e.nextBillingSummary.total,e.nextBillingSummary)}),{strong:i.createElement("strong",null)}))):i.createElement("div",null,i.createElement("p",{className:"plan-transition"},T._("Your Dropbox %(plan)s plan will renew on %(date)s.                 Your current %(schedule)s total is %(recurring_total)s.").format({plan:this.getPlanNameWithEvhText(e.subState.plan.displayName()),schedule:e.subState.billingSchedule.scheduleDescriptionAdjective,recurring_total:h.Cash.formatWithTaxLabels(e.currentBillingSummary.total,e.currentBillingSummary),date:e.subState.formattedNextBillingDate})));if(e.scheduledSubState&&e.scheduledSubState.plan)return t&&t.finalSubState.plan?i.createElement("div",null,i.createElement("span",{className:"change-summary"},T._("Change summary")),i.createElement("p",{className:"plan-transition"},x.reactFormat(T._("Starting on %(date)s, we’ll bill you once a %(schedule_noun)s for your               Dropbox %(plan_name)s plan. Your new %(schedule)s total will be %(scheduled_total)s.               Charges will continue until you <cancelLink>cancel</cancelLink>, and previous charges won’t be refunded               <legalLink>unless it’s legally required</legalLink>.").format({plan_name:this.getPlanNameWithEvhText(e.scheduledSubState.plan.displayName()),date:e.subState.formattedNextBillingDate,schedule:t.finalSubState.billingSchedule.scheduleDescriptionAdjective,schedule_noun:t.finalSubState.billingSchedule.scheduleDescriptionNoun,scheduled_total:h.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary)}),{strong:i.createElement("strong",null),cancelLink:i.createElement("a",{href:"/help/billing/cancel-dropbox-plus"}),legalLink:i.createElement("a",{href:"/help/billing/plus-refund"})}))):i.createElement("div",null,i.createElement("span",{className:"change-summary"},T._("Change summary")),i.createElement("p",{className:"plan-transition"},x.reactFormat(T._("Starting on %(date)s, we’ll bill you once a %(schedule_noun)s for your                 Dropbox %(plan_name)s plan. Your new %(schedule)s total will be %(scheduled_total)s.                 Charges will continue until you <cancelLink>cancel</cancelLink>, and previous charges won’t be refunded                 <legalLink>unless it’s legally required</legalLink>.").format({plan_name:this.getPlanNameWithEvhText(e.scheduledSubState.plan.displayName()),date:e.subState.formattedNextBillingDate,schedule:e.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,schedule_noun:e.scheduledSubState.billingSchedule.scheduleDescriptionNoun,scheduled_total:h.Cash.formatWithTaxLabels(e.nextBillingSummary.total,e.nextBillingSummary)}),{strong:i.createElement("strong",null),cancelLink:i.createElement("a",{href:"/help/billing/cancel-dropbox-plus"}),legalLink:i.createElement("a",{href:"/help/billing/plus-refund"})})))}},t.prototype.renderFooter=function(){return this.renderScheduleChangeFooter()},t.prototype.renderScheduleChangeFooter=function(){var e;return this.isBillingScheduleToChange()||(e=this.renderPaymentMethod()),i.createElement("div",{className:"plan-footer u-font-meta"},this.renderScheduleTransitionText(),e)},Object.defineProperty(t.prototype,"acceptButtonDisabled",{get:function(){var e=this.state.paymentMethod,t=this.state,n=t.loadingContent,a=t.submitting;return!(!n&&!a&&e)||(!this.hasScheduleChanged||this.isBillingScheduleToChange())},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e,n=this,a=this.state.subStatus,r=this.props,l=r.transitionPerformed,o=r.paymentInfo,s=this.state,c=s.loadingContent,u=s.submitting,p=s.hasLicenseKey;if(c)e=i.createElement("div",{className:"loading-indicator"},i.createElement("img",{src:L.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:T._("Loading")}));else{var h=void 0;if(a&&l&&!this.isProfessionalTrialPlan){g.DBModalStack.clear(),g.DBModalStack.register(d.CHANGE_IND_PLAN_MODAL_UPDATED,function(){t.showInstance({transitionPerformed:n.transitionPerformedClosure})}),h=i.createElement(m.CancellableNotificationsView,{subStatus:a,transitionPerformed:this.transitionPerformedClosure,displaySingleChangeCancellationItem:_.CancellationType.ALL,reOpenModalDialogAfterCancellation:!0,paymentInfo:o,hasLicenseKey:p,displayNewTotal:!1})}e=i.createElement("div",null,h,this.renderBillingSection(),this.renderFooter())}return i.createElement(S.Modal,{acceptButtonDisabled:this.acceptButtonDisabled,acceptButtonText:T._("Confirm change"),className:"change-plan-modal",dismissButtonText:T._("Cancel"),onDismiss:this.onDismissModal,autoClose:!1,onAccept:this.onAccept,submitting:u,title:T._("Change billing period")},e)},t.ChangeScheduleModal=l(t,["/static/css/teams/admin/widgets/change_plan_modal/change_plan_modal-vflEOD55p.css"]),t})(i.Component);t.ChangeScheduleModalView=I}),define("modules/clean/account_page/widgets/plan/views/exp_change_plans_modal_redesign",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/react/css","modules/clean/static_urls","modules/constants/trademark","spectrum/modal"],function(e,t,n,a,i,r,l,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.submittingIcon=function(){return t.props.submitting?a.createElement("img",{src:l.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:i._("Loading")}):a.createElement("span",null)},t}return n.__extends(t,e),t.prototype.renderProChangePlansRedesignFeaturesSection=function(){var e=this.props.planAndPricingContent.quotaString;return a.createElement("section",null,a.createElement("ul",{role:"list",className:"reasons-list"},a.createElement("li",{className:"reasons-list__item"},a.createElement("p",{className:"reasons-list__item__title"},i._("Everything in your current plan")),a.createElement("p",{className:"reasons-list__item__desc"},i._("All the benefits you’re already enjoying, plus more powerful features"))),e&&a.createElement("li",{className:"reasons-list__item"},a.createElement("p",{className:"reasons-list__item__title"},i._("%(pro_quota)s of space").format({pro_quota:e})),a.createElement("p",{className:"reasons-list__item__desc"},i._("Hold even more stuff, with double the space of your current plan"))),a.createElement("li",{className:"reasons-list__item"},a.createElement("p",{className:"reasons-list__item__title"},i._("Showcase")),a.createElement("p",{className:"reasons-list__item__desc"},i._("Share your work beautifully, get feedback and keep tabs on who’s seen it"))),a.createElement("li",{className:"reasons-list__item"},a.createElement("p",{className:"reasons-list__item__title"},i._("Smart Sync")),a.createElement("p",{className:"reasons-list__item__desc"},i._("Save space on your hard drive while having access to all your files")))))},t.prototype.renderProChangePlansRedesignBillingSection=function(){var e=this.props,t=e.loadingChangeSummary,n=e.planAndPricingContent,r=n.scheduleString,s=n.priceString,c=n.changeSummaryString,u=n.scheduledPriceString,d=n.proratedPriceString;if(r&&s&&c&&d){var p=t?a.createElement("div",{className:"loading-indicator"},a.createElement("img",{src:l.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:i._("Loading")})):a.createElement("div",{className:"billing-section__summary__text"},c,this.props.renderPaymentMethod()),m=t?null:a.createElement("div",{className:"billing-section__pricing"},a.createElement("div",{className:"billing-section__pricing__line"},a.createElement("span",{className:"billing-section__pricing__label"},r),a.createElement("span",{className:"billing-section__pricing__amount billing-section__pricing__amount--emphasis"},u?u:s)),a.createElement("div",{className:"billing-section__pricing__line"},a.createElement("span",{className:"billing-section__pricing__label"},i._("Billed today")),a.createElement("span",{className:"billing-section__pricing__amount"},d)));return a.createElement("section",{className:"plan-footer billing-section"},a.createElement("div",{className:"billing-section__summary"},a.createElement("div",{className:"billing-section__summary__title"},i._("Dropbox %(trademark_professional)s billing summary").format({trademark_professional:o.TRADEMARK_PROFESSIONAL})),this.props.renderVat(),p),m)}return null},t.prototype.render=function(){var e=i._("Upgrade to Dropbox %(trademark_professional)s").format({trademark_professional:o.TRADEMARK_PROFESSIONAL});return a.createElement(s.UtilityModal,{className:"change-plan-modal exp-pro-change-plans-redesign",ariaLabel:i._("Upgrade plan modal"),displayCloseButton:!0,overlayClickClose:!0,title:e,primaryAction:i._("Upgrade plan"),secondaryAction:i._("Cancel"),onPrimaryAction:this.props.onAccept,onSecondaryAction:this.props.onDismiss,onRequestClose:this.props.onDismiss,shouldRequestCloseOnActions:!1,open:this.props.open,link:this.submittingIcon,width:640,height:580},this.props.scheduledNotifications,this.renderProChangePlansRedesignFeaturesSection(),this.renderProChangePlansRedesignBillingSection())},t})(a.Component);t.ExpChangePlanRedesignModal=r(c,["/static/css/account/pagelet/exp_change_plans_modal_redesign-vflFqph8j.css"])}),define("modules/clean/account_page/widgets/plan/views/individual_inline_payment_method",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/account_page/widgets/billing/payment_method_constants"],function(e,t,n,a,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.updateBillingInfo=function(e){var n=t.props.updateBillingCTA;e.stopPropagation(),e.preventDefault(),n(e)},t}return n.__extends(t,e),t.prototype.renderCreditCard=function(){var e=this.props.paymentMethod;if(e){var t=e.account.slice(-4),n=i._("We’ll charge your card ending in %(last4)s.",{comment:"Letting the user know which credit card will be debited by indicating the last 4 digits."}).format({last4:t});return a.createElement("span",null,n," ",this.renderUpdateLink())}return a.createElement("span",null)},t.prototype.renderDirectDebit=function(){var e=this.props.paymentMethod;if(e){var t=e.account.slice(-4),n=i._("We’ll charge your IBAN ending in %(last4)s.",{comment:"Letting the user know which debit account will be debited by indicating the last 4 digits."}).format({last4:t});return a.createElement("span",null,n," ",this.renderUpdateLink())}return a.createElement("span",null)},t.prototype.renderPaypal=function(){return a.createElement("span",null,i._("We’ll charge your PayPal account.")," ",this.renderUpdateLink())},t.prototype.renderUpdateLink=function(){return a.createElement("a",{key:"updateBillingInfo",href:"#",onClick:this.updateBillingInfo},i._("Update billing information"))},t.prototype.render=function(){var e=this.props,t=e.paymentMethod,n=e.paymentErrorMessage;if(!t&&n)return a.createElement("span",null,n," ",this.renderUpdateLink());if(!t)return a.createElement("span",null);switch(t.gateway_id){case r.BRAINTREE:return this.renderCreditCard();case r.ADYEN_SEPA_GATEWAY:return this.renderDirectDebit();case r.PAYPAL:case r.PAYPAL_REFERENCE_TRANSACTION:return this.renderPaypal();default:return a.createElement("span",null)}},t})(a.Component);t.IndividualInlinePaymentMethodView=l}),define("modules/clean/account_page/widgets/plan/views/plan_status",["require","exports","tslib","modules/core/browser","modules/clean/deprecated/dbmodal_loading","external/react","modules/clean/viewer","modules/core/uri","modules/core/i18n","modules/core/exception","modules/clean/react/payments/update_billing_individual/individual_update_billing_modal_loader","modules/clean/account_page/widgets/billing/payment_methods_util","modules/clean/account_page/widgets/billing/payment_method_constants","modules/clean/account_page/util","modules/clean/static_urls","modules/clean/react/payments/error/browser_update_required_modal","modules/clean/payments/cash","modules/clean/account_page/widgets/plan/views/change_plan_modal","modules/clean/account_page/widgets/plan/views/change_schedule_modal","modules/clean/account_page/widgets/plan/views/cancel_subs_warning_modal","modules/clean/dbmodal_stack","modules/clean/payments/skus/constants","modules/clean/analytics","modules/clean/account_page/widgets/plan/plan_spectrum/types","modules/clean/react_format","modules/constants/trademark"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m,_,h,g,f,b,y,S,v,P,E,C,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var T;(function(e){e[e.Cancel=0]="Cancel",e[e.Change=1]="Change",e[e.Manage=2]="Manage",e[e.Upgrade=3]="Upgrade"})(T||(T={}));var N=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isOverQuota=function(){return t.usage>t.quota},t.logSeePlanDetails=function(){P.ProEventsLogger.log("de_plan_tab_details_click")},t.cancelPlanClick=function(){t.props.isPersonalUser?a.redirect("/downgrade"):a.redirect("/team/cancel")},t.onChangeBillingPeriodClick=function(e){e.preventDefault();var n=t.props,a=n.browserUpdateRequired,i=n.scheduledForDowngrade,r=n.paymentInfo;i?y.CancelChangesModalConfirmation.showInstance({transitionPerformed:t.props.onUpdate,subStatus:t.props.subStatus}):(b.ChangeScheduleModalView.showInstance({transitionPerformed:t.props.onUpdate,paymentInfo:r,browserUpdateRequired:a}),P.ProEventsLogger.log("de_plan_tab_change_billing_open_modal"))},t.onUpdateBillingClick=function(e){if(e.preventDefault(),t.props.browserUpdateRequired)return void h.BrowserUpdateModalLoader.showInstance();u.IndividualUpdateBillingModalLoader.showInstance()},t.redirectToUpgrade=function(){P.ProEventsLogger.log("de_plan_tab_upgrade_to_plus_click");var e=t.isOverQuota()?"acc_plan_upgrade_overquota_btn":"acc_plan_upgrade",n=new o.URI({path:"/upgrade",query:{oqa:e}}).toString();if("ON"===t.props.planSpectrumVariant){var i=m.getCurrentUser(),r=new E.PlanSpectrumTracker(i.id);n=new o.URI({path:"/upgrade",query:{oqa:"pspl"}}).toString(),r.track(E.PlanSpectrumActions.BasicUpgradeClick).then(function(){a.redirect(n)})}else a.redirect(n)},t.purchaseNowClick=function(){P.ProEventsLogger.log("de_plan_tab_purchase_now_click"),a.redirect("/pro/convert")},t.cancelTrialClick=function(){P.ProEventsLogger.log("de_plan_tab_cancel_trial_click"),a.redirect("/downgrade")},t.contactSupportClick=function(){P.ProEventsLogger.log("de_plan_tab_contact_support_click"),a.redirect("/support")},t.addPaymentClick=function(){P.ProEventsLogger.log("de_plan_tab_add_payment_method_click"),S.DBModalStack.push(new i({element_id:"add_billing_info",endpoint_url:"/add_billing_info_modal",html_in_error_msg:!0}))},t.openChangePlanModal=function(e){e&&e.preventDefault(),t.props.isLoggedInUser||(t.props.isPersonalUser?a.redirect("/account/plan"):a.redirect("/team/admin/billing/manage"));var n=t.props,i=n.browserUpdateRequired,r=n.scheduledForDowngrade,l=n.paymentInfo,o=n.planSpectrumVariant;if(r)y.CancelChangesModalConfirmation.showInstance({transitionPerformed:t.props.onUpdate,subStatus:t.props.subStatus,userIdOverride:t.getUserForModal()});else if(f.ChangePlanModalView.showInstance({browserUpdateRequired:i,transitionPerformed:t.props.onUpdate,paymentInfo:l,userIdOverride:t.getUserForModal()}),P.ProEventsLogger.log("de_plan_tab_change_plan_open_modal"),"ON"===o&&t.isPlusPlan()){var s=m.getCurrentUser(),c=new E.PlanSpectrumTracker(s.id);c.track(E.PlanSpectrumActions.PlusChangePlanClick)}},t.renderContactSupportLink=function(){return r.createElement("div",{className:"plan-status-section__contact_support_link"},r.createElement("a",{href:"#",onClick:t.contactSupportClick},s._("Contact support to change plan")))},t.renderBillingPeriod=function(){var e=t.props,n=e.paymentInfo,a=e.scheduledForDowngrade,i=e.hasUnusedLicenseKey;if(n&&t.props.showChangeBillingPeriod&&!i){var l=n.gateway_id,o=n.is_reseller_billing,c=n.end_date,u=n.deactivated,p=n.is_on_trial,m=n.reseller_name,_=n.reseller_link;if(!n.schedule_switchable&&!a&&!t.isProfessionalTrial()||d.shouldHideBillingChange(l,o)){var h=d.getBillingDisabledMessage({gatewayId:l,isResellerBilling:o,resellerName:m,resellerLink:_,dropboxPlan:w.TRADEMARK_PLUS,endDate:c,deactivated:u,isOnTrial:p});return r.createElement("span",{className:"plan-status-section__message"},h)}if(!t.isPlusTrial())return n.is_in_grace_period?r.createElement("a",{href:"#",className:"plan-status-section__link",onClick:t.onUpdateBillingClick},s._("Please update your billing information")):r.createElement("a",{href:"#",className:"plan-status-section__link",onClick:t.onChangeBillingPeriodClick},s._("Change billing period"))}},t.changePlanClick=function(){t.props.subStatus.subState.plan.isEnterprise?a.redirect("/team/admin/help?role=work"):a.redirect("/team/admin/billing/manage?show_switch_plan")},t.managePlanClick=function(){a.redirect("/team/admin/billing/manage")},t.createTrialCtaButtons=function(e,n){return void 0===e&&(e=!0),void 0===n&&(n=!1),n?r.createElement("div",{className:"plan-status-section__upgrade_btn trial-cta"},r.createElement("button",{className:"mc-button mc-button-secondary cancel-button",onClick:t.cancelTrialClick},s._("Cancel trial"))):e?r.createElement("div",{className:"plan-status-section__upgrade_btn trial-cta"},r.createElement("button",{className:"button-primary purchase-button",onClick:t.purchaseNowClick},s._("Purchase Now")),r.createElement("button",{className:"mc-button mc-button-secondary cancel-button",onClick:t.cancelTrialClick},s._("Cancel trial"))):r.createElement("div",{className:"plan-status-section__upgrade_btn trial-cta"},r.createElement("button",{className:"button-primary purchase-button",onClick:t.purchaseNowClick},s._("Purchase Now")))},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=a.get_href().match(/modal=([a-zA-Z_]*)/);if(e&&e.length>1){"plan"===e[1]&&this.isChangePlanSupported()&&this.openChangePlanModal()}},t.prototype.isChangePlanSupported=function(){var e=this.props,t=e.subStatus,n=e.eligibleFor1tb,a=e.isExternallyBilled,i=e.paymentInfo;return!!this.isInStandardSchedule()&&(!n&&(!!(i&&t&&t.subState.plan)&&(!d.shouldHideBillingChange(i.gateway_id,a)&&(this.isPlusPlan()||t.subState.plan.productType===v.ProductPlanType.PROFESSIONAL))))},Object.defineProperty(t.prototype,"usage",{get:function(){return this.props.usageBreakdown.usage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quota",{get:function(){return this.props.usageBreakdown.quota||.01},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"plansURL",{get:function(){var e=this.props,t=e.isLoggedInUser,n=e.isTransactionInformationPage,a={oqa:"acc_plan_upgrade"};return n&&!t&&(a.trigger="nr"),new o.URI({path:"/plans",query:a}).toString()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"evhDisplayName",{get:function(){var e=this.props.evhInfo;return e.purchased?e.is_unlimited_evh?s._("unlimited version history"):s._("extended version history"):""},enumerable:!0,configurable:!0}),t.prototype.renderCancelPlanButton=function(){return this.props.isLoggedInUser&&!this.props.isLoggedInAsTransactionOwner?this.renderLoginInstructions(T.Cancel):r.createElement("div",{className:"plan-status-section__upgrade_btn"},r.createElement("button",{className:"mc-button-secondary",onClick:this.cancelPlanClick},s._("Cancel plan")))},t.prototype.isPlusPlan=function(){var e=this.props.subStatus;return!(!e||!e.subState.plan)&&(e.subState.plan.productType===v.ProductPlanType.STANDARD||e.subState.plan.productType===v.ProductPlanType.PLUS)},t.prototype.isProfessionalPlan=function(){var e=this.props.subStatus;return!(!e||!e.subState.plan)&&(e.subState.plan.productType===v.ProductPlanType.PROFESSIONAL||e.subState.plan.productType===v.ProductPlanType.PROFESSIONAL_TRIAL)},t.prototype.isFreePlusPlan=function(){var e=this.props.subStatus;return!(!e||!e.subState.plan)&&e.subState.plan.productType===v.ProductPlanType.FREE},t.prototype.isInStandardSchedule=function(){var e=this.props.subStatus;if(e&&e.subState&&e.subState.billingSchedule){var t=e.subState.billingSchedule.id;return t===v.ScheduleId.MONTHLY||t===v.ScheduleId.YEARLY}return!1},t.prototype.pendingScheduledChange=function(){return this.isPlanScheduledToChange()||this.isBillingScheduleToChange()||this.isEvhScheduledToChange()},t.prototype.isTaurusPlan=function(){var e=this.props.subStatus;if(e&&e.subState.plan){
var t=e.subState.plan.productType;return t===v.ProductPlanType.PLUS||t===v.ProductPlanType.PLUS_TRIAL||t===v.ProductPlanType.PROFESSIONAL||t===v.ProductPlanType.PROFESSIONAL_TRIAL||t===v.ProductPlanType.PLUS_WITH_SS||t===v.ProductPlanType.PLUS_WITH_SS_TRIAL}return!1},t.prototype.isPlanScheduledToChange=function(){var e=this.props,t=e.subStatus;return!!e.scheduledForDowngrade||!!(t&&t.subState.plan&&t.finalSubState.plan)&&t.subState.plan.productType!==t.finalSubState.plan.productType},t.prototype.isEvhScheduledToChange=function(){var e=this.props.subStatus;return!(!e||!e.scheduledSubState)&&e.subState.quantityForEvhAddOn()!==e.scheduledSubState.quantityForEvhAddOn()},t.prototype.isBillingScheduleToChange=function(){var e=this.props.subStatus;return!!(e&&e.subState.billingSchedule&&e.finalSubState.billingSchedule)&&e.subState.billingSchedule.id!==e.finalSubState.billingSchedule.id},t.prototype.shouldDisplayChangePlan=function(){var e=this.getGatewayId();return e!==p.NOT_APPLICABLE&&!d.shouldHidePaymentMethod(e)&&!this.props.hasUnusedLicenseKey},t.prototype.getGatewayId=function(){var e=this.props.paymentInfo;return e?e.gateway_id:p.NOT_APPLICABLE},t.prototype.isTrialPlan=function(){return this.isPlusTrial()||this.isProfessionalTrial()},t.prototype.isPlusTrial=function(){var e=this.props.subStatus;return!(!e||!e.subState.plan)&&(e.subState.plan.productType===v.ProductPlanType.TRIAL||e.subState.plan.productType===v.ProductPlanType.PLUS_TRIAL)},t.prototype.isProfessionalTrial=function(){var e=this.props.subStatus;return!(!e||!e.subState.plan)&&e.subState.plan.productType===v.ProductPlanType.PROFESSIONAL_TRIAL},t.prototype.isLicensePlan=function(){var e=this.props,t=e.hasLicenseKey,n=e.paymentInfo;return!!n&&(t||d.isLicenseKey(n.gateway_id))},t.prototype.renderLoginInstructions=function(e){var t,n;return n=this.props.userEmail?this.props.userEmail:s._("the account user"),t=e===T.Cancel?C.reactFormat(s._("Please login as %(email)s<br />to cancel your plan."),{br:r.createElement("br",null),email:n}):e===T.Change?C.reactFormat(s._("Please login as %(email)s<br />to change your plan."),{br:r.createElement("br",null),email:n}):e===T.Manage?C.reactFormat(s._("Please login as %(email)s<br />to manage your plan."),{br:r.createElement("br",null),email:n}):e===T.Upgrade?C.reactFormat(s._("Please login as %(email)s<br />to upgrade your plan."),{br:r.createElement("br",null),email:n}):C.reactFormat(s._("Please login as %(email)s."),{email:n}),r.createElement("div",{className:"plan-status-section__login-msg"},t)},t.prototype.getUserForModal=function(){var e=this.props,t=e.isPersonalUser,n=e.useSpecifiedRole,a=e.isLoggedInAsTransactionOwner,i=null;if(n&&a){var r=l.Viewer.get_viewer();i=t?r.personal_user?r.personal_user.id:null:r.work_user?r.work_user.id:null,c.assert(null!=i,"Could not find user for specified role; modal will fail")}return i},t.prototype.renderDropboxLogo=function(){return r.createElement("div",{className:"plan-status-section__icon u-mar-right-s"},r.createElement("img",{src:_.static_url("/static/images/logo_catalog/dropbox-business-icon_m1-vflczuza3.svg"),alt:""}))},t.prototype.getTeamName=function(){return this.props.isLoggedInAsTransactionOwner&&l.Viewer.get_viewer().team_name?l.Viewer.get_viewer().team_name:this.props.teamName?this.props.teamName:null},t.prototype.renderChangePlanButton=function(e){var t=this.props.paymentInfo;return this.props.isLoggedInUser&&!this.props.isLoggedInAsTransactionOwner?this.renderLoginInstructions(T.Change):r.createElement("div",{className:"plan-status-section__upgrade_btn"},r.createElement("button",{className:"button-primary",onClick:e,disabled:t&&t.is_in_grace_period},s._("Change plan")))},t.prototype.renderManagePlanButton=function(){return this.props.isLoggedInUser&&!this.props.isLoggedInAsTransactionOwner?this.renderLoginInstructions(T.Manage):r.createElement("div",{className:"plan-status-section__upgrade_btn"},r.createElement("button",{className:"button-tertiary",onClick:this.managePlanClick},s._("Manage plan")))},t.prototype.renderBusinessPlanSection=function(){var e=this.props,t=e.subStatus,n=e.isTeamAdmin,a=e.teamScheduledForDowngrade,i=e.showCancelButton;if(t&&t.subState.isDeactivatedTeam)return this.renderBasicPlanSection();if(t&&t.subState.plan){var o=t.subState.plan.productType===v.ProductPlanType.STANDARD,c=t.subState.plan.displayName(!1,o);o||(c=s._("%(trade_mark)s %(plan_title)s").format({trade_mark:w.TRADEMARK_BUSINESS,plan_title:c}));var u="",d=this.getTeamName();d&&(n?(u=s._("You’re an admin of the %(team_name)s Dropbox account.").format({team_name:d}),this.props.isLoggedInAsTransactionOwner||(u=s._("This account is an admin of the %(team_name)s Dropbox account.").format({team_name:d}))):(u=s._("You’re a member of the %(team_name)s Dropbox account.").format({team_name:d}),this.props.isLoggedInAsTransactionOwner||(u=s._("This account is a member of the %(team_name)s Dropbox account.").format({team_name:d}))));var p,m,_=l.Viewer.get_viewer();if(this.props.isLoggedInUser&&!this.props.isLoggedInAsTransactionOwner)p=this.renderLoginInstructions(),m=null;else if(n||!this.props.isLoggedInUser){var h=t.subState.plan.productType;if(h===v.ProductPlanType.STANDARD||h===v.ProductPlanType.NEW_STANDARD||h===v.ProductPlanType.STANDARD_TRIAL?p=this.renderChangePlanButton(this.changePlanClick):h!==v.ProductPlanType.ADVANCED&&h!==v.ProductPlanType.ADVANCED_TRIAL||(p=this.renderManagePlanButton()),i&&(p=a?this.renderManagePlanButton():this.renderCancelPlanButton()),!t.subState.plan.isEnterprise){var g=s._("Manage your team in the Admin Console");this.props.isLoggedInAsTransactionOwner||(g=s._("Manage this team in the Admin Console")),m=r.createElement("p",null,r.createElement("a",{className:"plan-status-section__link",href:"/team/admin/billing/manage"},g))}}else!n&&_.is_paired&&(m=r.createElement("p",null,s._("Looking for details on another plan?")," ",r.createElement("a",{className:"plan-status-section__link plan-status-section__link--inline",href:"/account/plan?role=personal"},s._("Visit your personal account page."))));var f="";return this.props.showTeamScheduledForDowngrade&&a&&(f=s._("Any active members of your %(plan)s team will be downgraded to Dropbox Basic accounts         on %(date)s.").format({plan:c,date:t.formattedNextBillingDate}),this.props.isLoggedInAsTransactionOwner||(f=s._("Any active members of the %(plan)s team will be downgraded to Dropbox Basic accounts         on %(date)s.").format({plan:c,date:t.formattedNextBillingDate}))),r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},c),r.createElement("span",null,u),r.createElement("br",null),r.createElement("span",null,f),m),p)}},t.prototype.renderUpgradePlanButton=function(e){return this.props.isLoggedInUser&&!this.props.isLoggedInAsTransactionOwner?this.renderLoginInstructions(T.Upgrade):r.createElement("div",{className:"plan-status-section__upgrade_btn"},r.createElement("button",{className:"button-primary",onClick:this.redirectToUpgrade},e))},t.prototype.renderBasicPlanSection=function(){var e=this.props,t=e.subStatus,n=e.isLimitedTeam,a=s._("Dropbox Basic");if(t){t.subState.plan&&(a=t.subState.plan.displayName());var i=void 0;if(n||t.subState.isDeactivatedTeam){var l=this.getTeamName(),o=s._("You’re a member of the %(team_name)s Dropbox account.").format({team_name:l});this.props.isLoggedInAsTransactionOwner||(o=s._("This account is a member of the %(team_name)s Dropbox account.").format({team_name:l})),i=r.createElement("p",{className:"plan-status-section__team_desc"},o)}var c=this.isOverQuota()?s._("Upgrade now"):s._("Upgrade");return r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},a),i,r.createElement("a",{className:"plan-status-section__link",href:this.plansURL,target:"_blank",rel:"noopener noreferrer"},s._("See other plans"))),this.renderUpgradePlanButton(c))}},t.prototype.renderResellerPlan=function(){var e=s._("Dropbox %(plus)s 1TB").format({plus:w.TRADEMARK_PLUS});return r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},e),r.createElement("p",{className:"plan-status-section__title_description"},this.renderBillingPeriod())))},t.prototype.renderPaidPlanSection=function(){var e=this.props,t=e.subStatus,n=e.evhInfo,a=e.expWebAccountAndroidTrials,i=e.isLimitedTeam,l=e.hasUnusedLicenseKey,o=e.paymentInfo,c=e.scheduledForDowngrade;if(t&&t.scheduledSubState&&t.subState.plan){var u,p=t.subState.plan;if(1024===p.specQuotaGb){var m=this.getGatewayId(),_=t.subState.plan.displayName(!1,!1,m,a);u=n.purchased?s._("Dropbox %(plus)s + %(evh)s").format({plus:_,evh:this.evhDisplayName,comment:"evh = Extended Version History"}):s._("Dropbox %(plus)s").format({plus:_})}else u=t.subState.plan.displayName(!0),n.purchased&&(u=s._("%(plus)s + %(evh)s").format({plus:u,evh:this.evhDisplayName,comment:"evh = Extended Version History"}));var h,f=void 0,b=void 0;if(o&&d.shouldHideBillingSummary(o.gateway_id,t.subState.plan.productType)?h="":t.currentBillingSummary&&t.subState.billingSchedule&&(h=s._("%(total)s per %(period)s.").format({total:g.Cash.formatWithTaxLabels(t.currentBillingSummary.total,t.currentBillingSummary),period:t.subState.billingSchedule.scheduleDescriptionNoun})),l&&(h=s._("Your license key will be activated and no         charge made to your payment method on file."),this.props.isLoggedInAsTransactionOwner||(h=s._("This account’s license key will be activated and no         charge made to the payment method on file."))),o&&!d.shouldHideBillingChange(o.gateway_id,o.is_reseller_billing)){var y="";if(this.pendingScheduledChange()&&t.scheduledSubState&&t.scheduledSubState.plan&&t.scheduledSubState.billingSchedule){var S=t.scheduledSubState.plan,v=void 0;if(1024===S.specQuotaGb){var _=t.scheduledSubState.plan.displayName(!1);v=n.purchased&&!n.scheduled_to_remove?s._("Dropbox %(plus)s + %(evh)s").format({plus:_,evh:this.evhDisplayName,comment:"evh = Extended Version History"}):s._("Dropbox %(plus)s").format({plus:_})}else v=t.scheduledSubState.plan.displayName(!0),n.purchased&&!n.scheduled_to_remove&&(v=s._("%(plus)s + %(evh)s").format({plus:v,evh:this.evhDisplayName,comment:"evh = Extended Version History"}));y=s._("Starting on %(date)s, we’ll bill you once a %(new_period_noun)s for your           %(plan)s plan. Your new %(new_period_adj)s total will be %(new_amount)s.").format({date:t.formattedNextBillingDate,new_period_noun:t.scheduledSubState.billingSchedule.scheduleDescriptionNoun,plan:v,new_period_adj:t.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,new_amount:g.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary)}),this.props.isLoggedInAsTransactionOwner||(y=s._("Starting on %(date)s, we’ll bill this account once a %(new_period_noun)s for           the %(plan)s plan. This account’s new %(new_period_adj)s total will be           %(new_amount)s.").format({date:t.formattedNextBillingDate,new_period_noun:t.scheduledSubState.billingSchedule.scheduleDescriptionNoun,plan:v,new_period_adj:t.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,new_amount:g.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary)}))}else y=s._("Your %(plan)s plan will renew on %(date)s. %(billing_summary)s").format({plan:u,date:t.formattedNextBillingDate,billing_summary:h}),this.props.isLoggedInAsTransactionOwner||(y=s._("This account’s %(plan)s plan will renew on %(date)s. %(billing_summary)s").format({plan:u,date:t.formattedNextBillingDate,billing_summary:h}));f=r.createElement("span",null,y," ")}if(c){var P=s._("Your %(plan)s will downgrade to Dropbox Basic on         %(date)s.").format({plan:u,date:t.formattedNextBillingDate});this.props.isLoggedInAsTransactionOwner||(P=s._("This account’s %(plan)s will downgrade to Dropbox         Basic on %(date)s.").format({plan:u,date:t.formattedNextBillingDate})),f=r.createElement("span",null,P," ")}if(i){var E=this.getTeamName(),C=s._("You’re a member of the %(team_name)s Dropbox account.").format({team_name:E});this.props.isLoggedInAsTransactionOwner||(C=s._("This account is a member of the %(team_name)s Dropbox account.").format({team_name:E})),b=r.createElement("p",{className:"plan-status-section__team_desc"},C)}var w;return!o||d.shouldHideBillingChange(o.gateway_id,o.is_reseller_billing)||this.isInStandardSchedule()||(w=this.renderContactSupportLink()),this.shouldDisplayChangePlan()&&this.isInStandardSchedule()&&(this.isPlusPlan()&&!this.isTrialPlan()&&(w=this.renderChangePlanButton(this.openChangePlanModal)),this.isProfessionalPlan()&&!this.isTrialPlan()&&(w=this.renderChangePlanButton(this.openChangePlanModal))),this.props.showCancelButton&&!c&&(w=this.renderCancelPlanButton()),(this.isFreePlusPlan()||l)&&(w=this.renderContactSupportLink()),r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},u),b,r.createElement("p",{className:"plan-status-section__title_description"},f,!l&&this.renderPlanDetails(),r.createElement("br",null),this.renderBillingPeriod())),w)}},t.prototype.renderPlanDetails=function(){return r.createElement("a",{className:"plan-status-section__link",onClick:this.logSeePlanDetails,href:this.plansURL,target:"_blank",rel:"noopener noreferrer"},this.isTaurusPlan()?s._("See plan details"):s._("See available plans"))},t.prototype.renderTrialSection=function(){var e=this.props,t=e.expWebAccountAndroidTrials,n=e.subStatus,a=e.paymentInfo;if(n&&n.subState&&n.subState.plan&&a){var i=a.gateway_id,l=a.trial_info;if(l){var o=r.createElement("noscript",null);d.isIOS(i)||"V1"===t&&d.isAndroid(i)||(o=this.createTrialCtaButtons(!l.is_trial_overdue,this.isProfessionalTrial()));var c=s._("Dropbox %(plus)s").format({plus:n.subState.plan.displayName(!1,!1,i,t)});l.is_trial_overdue&&(c+=" "+s._("(Expired)"));var u;return u=this.isProfessionalTrial()?d.getProfessionalTrialPlanDescription(n):d.getTrialDescription(i,l,n.formattedNextBillingDate,t),r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},c),r.createElement("p",{className:"plan-status-section__title_description"},u," ",this.isProfessionalTrial()&&r.createElement("span",null,this.renderPlanDetails(),r.createElement("br",null),this.renderBillingPeriod()))),o)}}},Object.defineProperty(t.prototype,"hasSelfServablePaymentAfterLicensekey",{get:function(){var e=this.props.paymentInfo;return e&&!d.isLicenseKey(e.gateway_id)&&!d.shouldHidePaymentMethod(e.gateway_id)},enumerable:!0,configurable:!0}),t.prototype.renderLicensePlanSection=function(){var e=this.props.subStatus;if(!e||!e.subState||!e.subState.plan)return r.createElement("noscript",null);var t=s._("Dropbox %(plus)s").format({plus:e.subState.plan.displayName()}),n=r.createElement("noscript",null);if(this.props.hasUnusedLicenseKey){var a=s._("Your Dropbox %(plus)s plan was activated with a license key.         Your next license key will be activated on %(date)s.").format({plus:w.TRADEMARK_PLUS,date:e.formattedNextBillingDate});this.props.isLoggedInAsTransactionOwner||(a=s._("This Dropbox %(plus)s plan was activated with a license key.           The next license key will be activated on %(date)s.").format({plus:w.TRADEMARK_PLUS,date:e.formattedNextBillingDate}));var i=r.createElement("noscript",null);if(this.hasSelfServablePaymentAfterLicensekey)i=r.createElement("div",null,s._("No charge made to your payment method on file.")),this.props.isLoggedInAsTransactionOwner||(i=r.createElement("div",null,s._("No charge made to the payment method on file.")));else{var l=s._("You can add your payment information now to have            your subscription automatically renew when your keys expire.");this.props.isLoggedInAsTransactionOwner||(l=s._("The account owner can add payment information now to have               this subscription automatically renew when the keys expire.")),i=r.createElement("div",null,l,r.createElement("br",null),r.createElement("a",{href:"#",onClick:this.addPaymentClick},s._("Add payment method.")))}n=r.createElement("div",null,a,r.createElement("br",null),i)}else if(this.hasSelfServablePaymentAfterLicensekey){var o=e.scheduledSubState.billingSchedule.scheduleDescriptionNoun,c=s._("Your Dropbox %(plus)s plan was activated with a               license key. The plan will renew on %(date)s.").format({plus:w.TRADEMARK_PLUS,date:e.formattedNextBillingDate}),u=s._("%(new_total)s per %(new_period)s will be charged to your payment method on file.").format({new_total:g.Cash.formatWithTaxLabels(e.nextBillingSummary.total,e.nextBillingSummary),new_period:o});this.props.isLoggedInAsTransactionOwner||(c=s._("This Dropbox %(plus)s plan was activated with a             license key. The plan will renew on %(date)s.").format({plus:w.TRADEMARK_PLUS,date:e.formattedNextBillingDate}),u=s._("%(new_total)s per %(new_period)s will be charged to the payment method on file.").format({new_total:g.Cash.formatWithTaxLabels(e.nextBillingSummary.total,e.nextBillingSummary),new_period:o})),n=r.createElement("div",null,c,r.createElement("br",null),u,r.createElement("br",null),this.renderBillingPeriod())}else{var c=s._("Your Dropbox %(plus)s plan was activated with a license key.                 The plan is active until %(date)s.").format({plus:w.TRADEMARK_PLUS,date:e.formattedNextBillingDate}),d=s._("You can add your payment information now to have               your subscription automatically renew when it expires.");this.props.isLoggedInAsTransactionOwner||(c=s._("This account’s Dropbox %(plus)s plan was activated with a license key.               The plan is active until %(date)s.").format({plus:w.TRADEMARK_PLUS,date:e.formattedNextBillingDate}),d=s._("The account owner can add payment information now to have               this subscription automatically renew when it expires.")),n=r.createElement("div",null,c,r.createElement("br",null),d,r.createElement("br",null),r.createElement("a",{href:"#",onClick:this.addPaymentClick},s._("Add payment method.")))}return r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},t),r.createElement("p",{className:"plan-status-section__title_description"},n)),this.renderContactSupportLink())},t.prototype.render1TBChangeablePlan=function(){var e=this.props,t=e.subStatus,n=e.paymentInfo,a=e.scheduledForDowngrade;if(!t||!t.subState||!t.subState.plan)return r.createElement("noscript",null);var i=t.subState.plan.displayName(!0),l="";t.subState.billingSchedule&&t.subState.billingSchedule.scheduleDescriptionNoun&&t.currentBillingSummary&&t.currentBillingSummary.total&&(l=s._("%(total)s per %(period)s.").format({total:g.Cash.formatWithTaxLabels(t.currentBillingSummary.total,t.currentBillingSummary),period:t.subState.billingSchedule.scheduleDescriptionNoun}));var o=r.createElement("noscript",null);if(n&&!d.shouldHideBillingChange(n.gateway_id,n.is_reseller_billing)){var c=s._("Your %(plan)s plan will renew on %(date)s. %(billing_summary)s").format({plan:i,date:t.formattedNextBillingDate,billing_summary:l});this.props.isLoggedInAsTransactionOwner||(c=s._("This account’s %(plan)s plan will renew on %(date)s.             %(billing_summary)s").format({plan:i,date:t.formattedNextBillingDate,billing_summary:l})),o=r.createElement("span",null,c)}if(a){var u=s._("Your %(plan)s will downgrade to Dropbox Basic on %(date)s. %(billing_summary)s").format({plan:i,date:t.formattedNextBillingDate,billing_summary:l});this.props.isLoggedInAsTransactionOwner||(u=s._("This account’s %(plan)s will downgrade to Dropbox Basic on %(date)s.           %(billing_summary)s").format({plan:i,date:t.formattedNextBillingDate,billing_summary:l})),o=r.createElement("span",null,u)}var p=this.renderContactSupportLink();return r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},i),r.createElement("p",{className:"plan-status-section__title_description"},o,r.createElement("br",null),this.renderBillingPeriod())),p)},t.prototype.renderPlanSection=function(){var e=this.props,t=e.subStatus,n=e.isExternallyBilled,a=e.paymentInfo,i=e.isLimitedTeam;return e.eligibleFor1tb?this.render1TBChangeablePlan():n&&void 0!==a&&null!==a.reseller_name?this.renderResellerPlan():n&&i&&void 0!==a&&a.gateway_id===p.NOT_APPLICABLE?void 0:t&&t.subState.plan&&t.subState.plan.productFamily===v.ProductFamily.PRO?this.isTrialPlan()?this.renderTrialSection():this.isLicensePlan()?this.renderLicensePlanSection():this.renderPaidPlanSection():this.renderBasicPlanSection()},t.prototype.render=function(){var e=this.props,t=e.isPersonalUser,n=e.isLimitedTeam,a=t||n?this.renderPlanSection():this.renderBusinessPlanSection(),i=null;return"ON"===this.props.planSpectrumVariant&&(i=r.createElement("div",{className:"plan-status__header"},s._("Your plan"))),r.createElement("div",{className:"plan-status"},i,a)},t})(r.Component);t.PlanStatus=N}),define("modules/clean/account_page/widgets/plan/views/pro_upsell_modal_content",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/react/css","modules/clean/static_urls","modules/constants/trademark","modules/clean/react/image"],function(e,t,n,a,i,r,l,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){switch(this.props.expProPlansModalVariant){case"V1":return this.renderV1();case"V2":return this.renderV2();case"V3":return this.renderV3();default:return null}},t.prototype.renderV1=function(){var e=this.props,t=e.price,n=e.unit,r=e.quota,l=e.expProPlansModalV2Variant,s=t?t.toString():"-",c=t?n:"",u="V2"===l?i._("%(quota)s, Smart Sync, Showcase, and more.").format({quota:r}):i._("Showcase, Smart Sync, shared link controls, and more.");return a.createElement("section",null,a.createElement("div",{className:"pro-upsell"},a.createElement("h1",{className:"pro-upsell__headline"},i._("Do more with Dropbox %(trademark_pro)s").format({trademark_pro:o.TRADEMARK_PROFESSIONAL})),a.createElement("div",null,a.createElement("div",{className:"pro-upsell__price"},s),a.createElement("div",{className:"pro-upsell__price-schedule"},c))),a.createElement("ul",{role:"list",className:"reasons-list"},a.createElement("li",{className:"reasons-list__item reasons-list__item--professional"},i._("Everything in %(trademark_plus)s").format({trademark_plus:o.TRADEMARK_PLUS})),a.createElement("li",{className:"reasons-list__item"},u)))},t.prototype.renderV2=function(){var e=this.props,t=e.price,n=e.unit,r=t?t.toString():"-",l=t?n:"";return a.createElement("section",null,a.createElement("div",{className:"pro-upsell"},a.createElement("h1",{className:"pro-upsell__headline"},i._("Do more with Dropbox %(trademark_pro)s").format({trademark_pro:o.TRADEMARK_PROFESSIONAL})),a.createElement("div",null,a.createElement("div",{className:"pro-upsell__price"},r),a.createElement("div",{className:"pro-upsell__price-schedule"},l))),a.createElement("div",{className:"grid__container"},a.createElement("ul",{role:"list",className:"reasons-list reasons-list--margin-right"},a.createElement("li",{className:"reasons-list__item reasons-list__item--professional"},i._("Everything in %(trademark_plus)s").format({trademark_plus:o.TRADEMARK_PLUS})),a.createElement("li",{className:"reasons-list__item"},i._("Showcase")),a.createElement("li",{className:"reasons-list__item"},i._("Smart Sync"))),a.createElement("ul",{className:"reasons-list"},a.createElement("li",{className:"reasons-list__item"},i._("Advanced sharing controls")),a.createElement("li",{className:"reasons-list__item"},i._("Priority chat support")),a.createElement("li",{className:"reasons-list__item"},i._("Full text search")))))},t.prototype.renderV3=function(){var e=this.props,t=e.price,n=e.unit,r=t?t.toString():"-",c=t?n:"";return a.createElement("section",null,a.createElement("div",{className:"pro-upsell__image-wrapper"},a.createElement(s.Image,{className:"pro-upsell__image",alt:"",src:l.static_url("/static/images/growth/sell-more-faster-illo@2x-vflHz-UKV.png"),srcHiRes:l.static_url("/static/images/growth/sell-more-faster-illo@2x-vflHz-UKV.png")})),a.createElement("div",{className:"pro-upsell"},a.createElement("h1",{className:"pro-upsell__headline"},i._("What’s included in Dropbox %(trademark_pro)s?").format({trademark_pro:o.TRADEMARK_PROFESSIONAL})),a.createElement("div",null,a.createElement("div",{className:"pro-upsell__price"},r),a.createElement("div",{className:"pro-upsell__price-schedule"},c))),a.createElement("div",{className:"grid__container"},a.createElement("ul",{role:"list",className:"reasons-list reasons-list--margin-right"},a.createElement("li",{className:"reasons-list__item reasons-list__item--professional"},i._("Everything in %(trademark_plus)s").format({trademark_plus:o.TRADEMARK_PLUS})),a.createElement("li",{className:"reasons-list__item"},i._("Showcase"))),a.createElement("ul",{className:"reasons-list"},a.createElement("li",{className:"reasons-list__item"},i._("Advanced sharing controls")),a.createElement("li",{className:"reasons-list__item"},i._("Smart Sync")))))},t})(a.Component);t.ProUpsellModalContent=r(c,["/static/css/teams/admin/widgets/change_plan_modal/pro_upsell_modal_content-vflLlKDtE.css"])}),define("modules/clean/deprecated/dbmodal_loading",["require","exports","tslib","modules/clean/dbmodal","modules/clean/deprecated/uirequest"],function(e,t,n,a,i){"use strict";var r=(function(e){function t(t){return e.call(this,t)||this}return n.__extends(t,e),t.initClass=function(){this.prototype.on_confirm_button_click=null,this.prototype.on_cancel_button_click=null},t.prototype.on_show=function(){return this.fetch()},t.prototype.fetch=function(){var e=this;return new i(this.$modal_window,this.options.endpoint_url,{data:this.options.parameters||{},subject_user:this.options.subject_user,html_in_error_msg:this.options.html_in_error_msg,error:function(t,n,a){return e.hide()}})},t})(a.DBModal);return r.initClass(),r}),define("modules/clean/growth/rebill_upsell/rebill_upsell_top_notification",["require","exports","tslib","external/react","modules/core/i18n","modules/core/browser","modules/clean/viewer","modules/clean/react/top_notification_bar","modules/constants/trademark","modules/clean/growth/user_action/tracker","modules/clean/growth/rebill_upsell/rebill_upsell_tracker"],function(e,t,n,a,i,r,l,o,s,c,u){"use strict";function d(){o.TopNotificationBar.show(a.createElement(m,{user:l.Viewer.get_viewer().get_users()[0]}))}Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClickCTA=function(e){e.preventDefault(),t.props.track(u.RebillUpsellActions.REBILL_UPSELL_BANNER_CLICK_CTA),r.redirect("/pro?_tk=uj_rebill_upsell")},t.onDismiss=function(){t.props.track(u.RebillUpsellActions.REBILL_UPSELL_BANNER_DISMISS)},t}return n.__extends(t,e),t.prototype.render=function(){return a.createElement(o.TopNotificationBar,{type:"info",onDismiss:this.onDismiss},a.createElement("span",{className:"top-notification-bar__text"},i._("Explore Dropbox %(trademark_pro)s, a new plan with powerful features like Smart Sync and %(trademark_showcase)s.").format({trademark_pro:s.TRADEMARK_PROFESSIONAL,trademark_showcase:s.PROFESSIONAL_SHARING})),a.createElement("a",{href:"/pro?_tk=uj_rebill_upsell",className:"top-notification-link-button freshbutton-blue enabled",onClick:this.onClickCTA},i._("Learn more")))},t})(a.Component),m=c.withGrowthTracking("uj_rebill_upsell",{mount:u.RebillUpsellActions.REBILL_UPSELL_BANNER_VIEW})(p);t.showRebillUpsellTopNotification=d}),define("modules/clean/growth/rebill_upsell/rebill_upsell_tracker",["require","exports","tslib","modules/clean/growth/user_action/tracker"],function(e,t,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.REBILL_UPSELL_BANNER_VIEW="uj_rebill_upsell-banner-view",e.REBILL_UPSELL_BANNER_DISMISS="uj_rebill_upsell-banner-dismiss",e.REBILL_UPSELL_BANNER_CLICK_CTA="uj_rebill_upsell-banner-click_cta"})(t.RebillUpsellActions||(t.RebillUpsellActions={}));var i=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.project="uj_rebill_upsell",t}return n.__extends(t,e),t})(a.GrowthUserActionTracker);t.RebillUpsellTracker=i}),define("modules/clean/growth/user_action/tracker",["require","exports","tslib","react","external/hoist-non-react-statics","modules/clean/api_v2/client"],function(e,t,n,a,i,r){"use strict";function l(e,t){return function(r){return i((function(i){function l(t){var n=i.call(this,t)||this;return n.tracker=new o(n.props.user.id,{project:e}),n.track=n.tracker.track.bind(n.tracker),n}return n.__extends(l,i),l.prototype.componentDidMount=function(){t&&t.mount&&this.tracker.track(t.mount)},l.prototype.componentWillUnmount=function(){t&&t.unmount&&this.tracker.track(t.unmount)},l.prototype.render=function(){return a.createElement(r,n.__assign({track:this.track},this.props))},l.displayName="WithGrowthTracking("+(r.displayName||"Component"),l})(a.Component),r)}}Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(e,t){this.userId=e,this.timers={},t&&t.project&&(this.project=t.project),this.client=(new r.ApiV2Client).ns("growth")}return e.prototype.startTimer=function(e){this.timers[e]={start:Date.now(),end:0}},e.prototype.stopTimer=function(e){this.timers[e]&&!this.timers[e].end&&(this.timers[e].end=Date.now())},e.prototype.clearTimer=function(e){delete this.timers[e]},e.prototype.getDuration=function(e){return this.timers[e]?this.timers[e].end?this.timers[e].end-this.timers[e].start:Date.now()-this.timers[e].start:0},e.prototype.track=function(e,t){return void 0===t&&(t={}),this.client.rpc("track_user_action",{project:this.project,action:e,duration:this.getDuration(e),extra:JSON.stringify(t.extra||{}),endpoint:t.endpoint||void 0},{subjectUserId:this.userId})},e})();t.GrowthUserActionTracker=o,t.withGrowthTracking=l}),define("modules/clean/payments/billing_info_base",["require","exports","jquery","modules/clean/payments/cash","modules/clean/payments/payment_form_events","modules/clean/payments/pro_util","modules/core/controller_helpers"],function(e,t,n,a,i,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(e,t,n,a){this.listen_tax=this.listen_tax.bind(this),this._getCurrency=this._getCurrency.bind(this),this.getCurrentTransitionViewModel=this.getCurrentTransitionViewModel.bind(this),this.updateForm=this.updateForm.bind(this),this._display_tax=this._display_tax.bind(this),this._recompute_costs=this._recompute_costs.bind(this),this._recompute_costs_from_tvm=this._recompute_costs_from_tvm.bind(this),this.$container=e,this.country_to_currency_map=t,this.transition_view_models=n,this.countryToTaxNameMap=a,this.transition_info_fetcher=new r.TransitionInfoFetcher(this.transition_view_models),this.payment_form=l.get_controller(this.$container.find(".payment-form-component")),this.hasTax=null!=this.countryToTaxNameMap,this.transition_view_models&&(this.transition_view_model=this.transition_view_models[0]),this.listen_tax()}return e.prototype.listen_tax=function(){var e=this;if(this.hasTax)return this.$container.on(i.LOCATION_CHANGE_EVENT,function(t,n){
if(t.stopPropagation(),r.TaxHelper.require_recompute(e.get_country_code(),e.get_zip_code()))return e.updateForm()})},e.prototype.get_zip_code=function(){return this.$container.find('input:visible[name="zip"]').val()},e.prototype.get_country_code=function(){return this.$container.find('[name="country_code"]').val()},e.prototype._getCountryTaxName=function(e){return this.countryToTaxNameMap[e]||this.countryToTaxNameMap.Other},e.prototype._getCurrency=function(){var e=this.payment_form.get_country_code();return null!=this.country_to_currency_map?this.country_to_currency_map[e]:void 0},e.prototype.getCurrentTransitionViewModel=function(){return this.transition_view_model},e.prototype.updateForm=function(){return this._recompute_costs()},e.prototype._display_tax=function(){return r.TaxHelper.display_tax(this.get_country_code())?(n(".tax-row").removeClass("hidden_elem"),n(".tax-name-wrapper").text(this._getCountryTaxName(this.get_country_code())),!0):(n(".tax-row").addClass("hidden_elem"),!1)},e.prototype._recompute_costs=function(){var e={zip:this.get_zip_code(),country_code:this.get_country_code()};return this.transition_info_fetcher.get(this._recompute_costs_from_tvm,e,!0)},e.prototype._recompute_costs_from_tvm=function(e){var t;if(e){this.transition_view_model=e;var i=this._getCurrency();this.$container.find(".currency-wrapper").text(i);var l=Array.from(r.TaxHelper.compute_tax(e.read_only_invoice,i)),o=l[0],s=l[1],c=l[2],u=a.CashUtil.formatCurrency(o.amount,o.currency);if(this.$container.find(".price-amount-wrapper").text(u),e.rebill){t=a.Cash.fromObject(e.rebill.total);var d=a.CashUtil.formatCurrency(t.amount,t.currency);this.$container.find(".rebill-amount-wrapper").text(d)}if(e.state.total_recurring_price){var p=a.Cash.fromObject(e.state.total_recurring_price),m=a.CashUtil.formatCurrency(p.amount,p.currency);this.$container.find(".rebill-price-wrapper").text(m)}var _=this._getTotalAmount(e),h=a.CashUtil.formatCurrency(_.amount,_.currency);this.$container.find(".total-amount-wrapper").text(h),n(".tax-row").toggleClass("hidden_elem",this._display_tax());var g=a.CashUtil.formatCurrency(c.amount,c.currency);return n(".tax-amount-wrapper").text(g),[o,s,c,t,i]}},e})();t.BillingInfoModalBase=o}),define("modules/clean/payments/billing_info_modal",["require","exports","tslib","jquery","modules/clean/analytics","modules/clean/dbmodal_stack","modules/clean/deprecated/uirequest","modules/clean/payments/billing_info_base","modules/clean/payments/cash","modules/clean/payments/payment_form_events","modules/core/browser","modules/core/cookies","modules/core/notify","modules/core/uri","modules/clean/payments/pro_util"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m){"use strict";var _=(function(e){function t(n,o,s,d,_){var h=e.call(this,n,d,s,_)||this;return h.payment_link_map=o,h._postRequest=h._postRequest.bind(h),h._update_disclaimer=h._update_disclaimer.bind(h),h.$container.on("click",".cancel-button",function(){return i.TeamsWebActionsLogger.log("update_billing_open_cancel"),r.DBModalStack.pop()}),h.$container.on("click",".confirm-button",function(){if(i.TeamsWebActionsLogger.log("update_billing_open_save_changes_click"),h.payment_form.validate())return h.$container.find(".confirm-button").prop("disabled",!0),h.payment_form.get_form_inputs(function(e){h.$container.find(".confirm-button").prop("disabled",!1);var n=["resubscribe"];h.$container.find("input, select").each(function(t,i){var r=a(i),l=r.attr("name");if(Array.from(n).includes(l))return e[l]=r.val()});var o=h.payment_form.get_selected_payment_method_id(),s=h.payment_link_map[o];if("extra_params"in s){var c=s.extra_params;a.extend(e,c)}return s.use_form_post?h._postRequest(new m.URI({path:s.endpoint}),e):new l(h.$container,s.endpoint,{data:e,success:function(e){if(e.data&&e.data.success){i.TeamsWebActionsLogger.log("update_billing_open_save_changes_success");var n=e.data,a=n.message,l=n.redirect_url;return l&&p.Notify.success(a,5,function(){return u.redirect(l)}),r.DBModalStack.trigger(t.BILLING_INFO_UPDATED),r.DBModalStack.pop()}}})})}),h.payment_form.$container.on(c.PAYMENT_METHOD_TYPE_CHANGE_EVENT,h._update_disclaimer),null!=h.transition_view_models&&h.updateForm(),h}return n.__extends(t,e),t.initClass=function(){this.BILLING_INFO_UPDATED="billing_info_modal:updated"},t.prototype._postRequest=function(e,t){t.t=d.Cookies.read("__Host-js_csrf");var n=document.createElement("form");n.action=e,n.method="POST",document.body.appendChild(n);for(var a=0,i=Object.keys(t||{});a<i.length;a++){var r=i[a],l=document.createElement("input");l.type="hidden",l.name=r,l.value=t[r],n.appendChild(l)}return n.submit()},t.prototype._update_disclaimer=function(e,t){return t=parseInt(t,10),this.$container.find(".payment-method-disclaimer").each(function(e,n){var i=a(n).data("payment-method-id");return a(n).toggleClass("hidden",i!==t)})},t.prototype._getTotalAmount=function(e){return s.Cash.fromObject(e.read_only_invoice.total)},t})(o.BillingInfoModalBase);return _.initClass(),_}),define("modules/clean/payments/payment_form_events",["require","exports"],function(e,t){"use strict";var n=(function(){function e(){}return e.initClass=function(){this.LOCATION_CHANGE_EVENT="db:paymentform:countrycodechanged",this.ZIP_CHANGE_EVENT="db:paymentform:zipchanged",this.PAYMENT_METHOD_TYPE_CHANGE_EVENT="db:paymentform:paymentmethodtypechanged",this.VAT_CHANGE_EVENT="db:paymentform:vatchanged",this.CPF_CHANGE_EVENT="db:paymentform:cpfchanged",this.UNVALIDATED="db:paymentform:unvalidated",this.VALIDATE_ERROR="db:paymentform:validateerror",this.VALIDATE_SUCCESS="db:paymentform:validatesuccess",this.LOADED_EVENT="db:paymentform:loaded",this.IFRAME_LOADED_EVENT="db:paymentform:iframeloaded",this.IFRAME_FIELDS_STATUS_EVENT="db:paymentform:iframefieldsstatusevent",this.EDIT_SIMPLE_COUNTRY_CLICK_EVENT="db:paymentform:editsimplecountry"},e})();return n.initClass(),n}),define("modules/clean/payments/pro_util",["require","exports","external/lodash","modules/clean/ajax","modules/clean/payments/cash","modules/clean/payments/validation","modules/core/exception"],function(e,t,n,a,i){"use strict";function r(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0});var l=(function(){function e(){}return e.compute_tax=function(e,t){for(var n=null,a=null,r=new i.Cash(0,t),l=0,o=Array.from(e.line_items);l<o.length;l++){var s=o[l];1===s.line_item_type?n=s:2===s.line_item_type&&(a=s),s.country_tax_amount&&(r=r.add(i.Cash.fromObject(s.country_tax_amount))),s.state_tax_amount&&(r=r.add(i.Cash.fromObject(s.state_tax_amount)))}return[null!=n?i.Cash.fromObject(n.line_item_price):new i.Cash(0,t),null!=a?i.Cash.fromObject(a.line_item_price):new i.Cash(0,t),r]},e.require_recompute=function(e,t){return"US"===e&&/(^\d{5}$)|(^\d{5}-\d{4}$)/.test(t)},e.display_tax=function(e){return"US"===e},e})();t.TaxHelper=l;var o=(function(){function e(e){if(this._cache_key_from_transition=this._cache_key_from_transition.bind(this),this._get_state_json=this._get_state_json.bind(this),this.get=this.get.bind(this),this._has_inflight_request=this._has_inflight_request.bind(this),this._add_to_cache=this._add_to_cache.bind(this),this._get_transition_info_for=this._get_transition_info_for.bind(this),this.default_transition_view_models=e,this._requests={},this.transition_info_cache={},this.default_transition_view_models)for(var t=0,n=Array.from(this.default_transition_view_models);t<n.length;t++){var a=n[t];this._add_to_cache(a)}}return e.prototype._cache_key=function(e){return n.values(e).join(":")},e.prototype._cache_key_from_transition=function(e){var t={country_code:null!=e.read_only_invoice?e.read_only_invoice.tax_country_code:void 0,zip_code:null!=e.read_only_invoice?e.read_only_invoice.tax_zip_code:void 0};return this._cache_key(t)},e.prototype._get_state_json=function(){var e=r(null!=this.default_transition_view_models?this.default_transition_view_models[0]:void 0,function(e){return e.state});return JSON.stringify(e)},e.prototype.get=function(e,t,i){var r=this,l=this._cache_key(t),o=this._get_transition_info_for(l);if(o)return void e(o);if(!this._requests[l]){if(this._has_inflight_request()&&i)for(var s in this._requests)delete this._requests[s];else if(this._has_inflight_request())return;return this._requests[l]=!0,a.SilentBackgroundRequest({url:"/pro/ajax_transition_view_model",dataType:"json",data:n.assignIn({json_state:this._get_state_json()},t),success:function(t){if(r._add_to_cache(t),null!=r._requests[l])return delete r._requests[l],e(t)},error:function(e){if(null!=r._requests[l])return delete r._requests[l]}})}},e.prototype._has_inflight_request=function(){return Object.keys(this._requests).length},e.prototype._add_to_cache=function(e){var t=this._cache_key_from_transition(e);return this.transition_info_cache[t]=e},e.prototype._get_transition_info_for=function(e){return null!=this.transition_info_cache[e]},e})();t.TransitionInfoFetcher=o}),define("modules/clean/react/payments/edit_invoice_address_modal/edit_invoice_address_modal_loader",["require","exports","tslib","modules/core/notify","external/react","modules/clean/react/css","modules/clean/react/sprite","modules/core/uri","modules/core/i18n","modules/clean/react/arbor/aspen/elements/arbor_inputs","modules/clean/payments/validation","modules/clean/react/modal","modules/clean/static_urls","modules/clean/react/tooltip","modules/clean/analytics","modules/clean/ajax_as_promised"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m,_,h){"use strict";function g(e){return function(t){return null==t||t.length<=e}}function f(e,t){return i.createElement(m.Tooltip,{position:m.TooltipPosition.RIGHT,tooltip_contents:t},e,i.createElement(l.Sprite,{group:"web",name:"info",className:"info-sprite",alt:""}))}Object.defineProperty(t,"__esModule",{value:!0});var b=s._("Country and postal code must match your account’s payment information."),y=s._("Your tax rate on this invoice cannot be updated."),S={addressName:s._("Billing name"),address:s._("Billing address"),city:s._("City"),state:s._("State"),zip:f(s._("Postal code"),b),country:f(s._("Country"),b),exclusionId:s._("VAT number (optional)"),exclusionIdWithTooltip:f(s._("VAT number (optional)"),y)},v=(function(e){function r(t){var n=e.call(this,t)||this;return n.disableds={addressName:!1,address:!1,city:!1,state:!1,zip:!0,country:!0,exclusionId:!1,exclusionIdWithTooltip:!1},n.addressNameLength=100,n.addressLength=250,n.cityLength=50,n.stateLength=50,n.vatLength=25,n.undefinedLength=void 0,n.validateHandlers={addressName:g(n.addressNameLength),address:g(n.addressLength),city:g(n.cityLength),state:g(n.stateLength),zip:function(){return!0},country:function(){return!0},exclusionId:function(){return!0},exclusionIdWithTooltip:function(){return!0}},n.maxLengths={addressName:n.addressNameLength,address:n.addressLength,city:n.cityLength,state:n.stateLength,zip:n.undefinedLength,country:n.undefinedLength,exclusionId:n.vatLength,exclusionIdWithTooltip:n.vatLength},n.errorTexts={addressName:s._("Too long"),address:s._("Too long"),city:s._("Too long"),state:s._("Too long"),zip:"",country:"",exclusionId:"",exclusionIdWithTooltip:""},n.onSave=function(){var e=n.state.formState,t=n.props.invoice;if(e)if(n.logActions("edit_billing_address_started"),n.setState({submitting:!0}),n.isInputValid()){var a={address_name:e.addressName,address:e.address,city:e.city,state:e.state,exclusion_id:e.exclusionId};t&&(a.invoice_id=o.URI.parse(t.link).getQuery().id.toString()),n.makeEditBillingAddressRequest(a)}else n.setState({submitting:!1,showErrors:!0})},n.onCancel=function(){n.logActions("edit_billing_address_cancelled"),d.Modal.close()},n.state={submitting:!1,showErrors:!1},t.isTeam?(n.editUrl="/edit_billing_address",n.viewModelUrl="/edit_billing_address_view_model",n.vatClass="grid__item--1-1",n.modalClass="edit-invoice-modal"):(n.editUrl="/edit_billing_address_individual",n.viewModelUrl="/edit_billing_address_individual_view_model",n.vatClass="grid__item--1-2",n.modalClass="edit-invoice-modal professional-modal"),n}return n.__extends(r,e),r.showInstance=function(e,n){var a=i.createElement(t.EditInvoiceAddressModalLoader,{invoice:e,isTeam:n});d.Modal.showInstance(a)},r.showUpdateTaxProfileModal=function(e,n){var a=i.createElement(t.EditInvoiceAddressModalLoader,{isTeam:e,onUpdated:n});d.Modal.showInstance(a)},r.prototype.componentDidMount=function(){var e=void 0;this.props.invoice&&(e=o.URI.parse(this.props.invoice.link).getQuery().id.toString(),this.disableds.exclusionIdWithTooltip=!0),this.makeRequest(e)},r.prototype.makeRequest=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,a,i;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t={invoice_id:e},[4,h.WebRequest({url:this.viewModelUrl,data:t,dataType:"json"})];case 1:return a=n.sent(),u.hasVat(a.countryCode)&&(this.errorTexts.exclusionId=s._("Please enter a valid VAT number, e.g. %(examples)s.").format({examples:u.getVatExamples(a.countryCode).join(", ")}),this.validateHandlers.exclusionId=function(e){return!e||u.validateVat(a.countryCode,e)}),this.setState({formState:a}),[3,3];case 2:return i=n.sent(),d.Modal.close(),[3,3];case 3:return[2]}})})},r.prototype.render=function(){var e,t=this.state,n=t.formState,a=t.showErrors,r=t.submitting;if(n){var l=null;if(u.hasVat(n.countryCode)){var o=u.getVatPrefix(n.countryCode);l=this.props.invoice?this.renderInput("exclusionIdWithTooltip",this.vatClass):this.renderInput("exclusionId",this.vatClass,o)}e=this.props.isTeam?i.createElement("div",{className:".type--arbor grid__container grid__container--p-large  grid--x-bookend"},this.renderInstructions(n.countryCode),this.renderInput("addressName","grid__item--1-1"),this.renderInput("address","grid__item--1-1"),this.renderInput("city","grid__item--1-2"),this.renderInput("state","grid__item--11-24"),this.renderInput("zip","grid__item--7-24"),this.renderInput("country","grid__item--2-3"),l):i.createElement("div",{className:".type--arbor grid__container grid__container--p-large  grid--x-bookend"},this.renderInput("addressName","grid__item--1-1"),this.renderInput("address","grid__item--1-2"),this.renderInput("city","grid__item--1-4"),this.renderInput("state","grid__item--1-4"),this.renderInput("zip","grid__item--1-2"),this.renderInput("country","grid__item--1-2"),l,this.renderInstructions(n.countryCode))}else e=i.createElement("div",{className:"loading-spinner"},i.createElement("img",{src:p.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:s._("Loading")}));var c=i.createElement(d.ModalButtons,{className:"oq-modal__buttons"},i.createElement(d.ModalButton,{className:"cancel-button",importance:"tertiary",onClick:this.onCancel},s._("Cancel")),i.createElement(d.ModalButton,{disabled:!n||r||a&&!this.isInputValid(),importance:"primary",onClick:this.onSave},s._("Save changes")));return i.createElement(d.Modal,{className:this.modalClass,autoClose:!1,buttonComponent:c,title:s._("Edit invoice details")},i.createElement("div",{className:"dynamic-content"},e))},r.prototype.logActions=function(e){this.props.isTeam?_.TeamsWebActionsLogger.log(e):_.UserActivityLogger.log("web",e)},r.prototype.makeEditBillingAddressRequest=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,i,r;return n.__generator(this,function(n){switch(n.label){case 0:t=this.props.onUpdated,n.label=1;case 1:return n.trys.push([1,3,4,5]),i=this.editUrl,[4,h.WebRequest({url:i,data:e})];case 2:return n.sent(),this.logActions("edit_billing_address_success"),a.Notify.success(s._("Invoice details updated.")),[3,5];case 3:return r=n.sent(),this.logActions("edit_billing_address_edit_failure"),[3,5];case 4:return t&&t(),d.Modal.close(),[7];case 5:return[2]}})})},r.prototype.renderInstructions=function(e){var t,n=this.props.invoice;if(t=n?s._("You are editing details for the %(date)s invoice.").format({date:n.date}):s._("You are editing details for all future invoices. To edit past         invoices, click “Edit” on the invoice item instead."),u.hasVat(e)){var a=s._("Please note that changing your VAT number could impact your           applicable tax rate.");n&&(a=s._("To add or change a VAT number or request a tax refund, contact           support.")),t=t.concat(" ",a)}return i.createElement("div",{className:"grid__item--1-1 instructions"},t)},r.prototype.renderInput=function(e,t,n){var a=this.state,r=a.formState,l=a.showErrors,o="";return r&&(o=r[e]),i.createElement(c.ArborTextInput,{name:e,containerClassName:t,isValid:l?!!this.validateHandlers[e](o)&&"":"",labelText:S[e],errorText:this.errorTexts[e],value:o,onChange:this.onChangeFactory(e),disabled:this.disableds[e],placeholderText:n,maxLength:this.maxLengths[e]})},r.prototype.onChangeFactory=function(e){var t=this;return function(n,a,i){var r=t.state.formState;r&&t.setState(function(t){return r[e]=i,t})}},r.prototype.isInputValid=function(){var e=this.state.formState;return!!e&&(this.validateHandlers.addressName(e.addressName)&&this.validateHandlers.address(e.address)&&this.validateHandlers.city(e.city)&&this.validateHandlers.state(e.state)&&this.validateHandlers.exclusionId(e.exclusionId))},r})(i.Component);t.EditInvoiceAddressModalLoader=r(v,["/static/css/payments/edit_invoice_address_modal/edit_invoice_address_modal-vfl4mD1Gs.css"])}),define("modules/clean/react/payments/pro/components/payments/ideal_form",["require","exports","tslib","external/react","modules/clean/react/payments/common/form_value_helpers","modules/clean/react/payments/pro/components/inputs/inputs","modules/core/i18n"],function(e,t,n,a,i,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onIdealBankChange=function(e){var n=e.value,a=t.props.idealBanks[n];t.props.actions.updateIdealBank({bankId:n,bankName:a})},t}return n.__extends(t,e),t.prototype.idealBankErrorString=function(){var e=this.props.formData.idealBankId;return!i.FormValueHelper.isValid(e)&&e.showError?l._("Please select your bank."):""},t.prototype.render=function(){var e=this.props,t=e.formData,n=e.idealBanks,i=l._("Note: We’ll use your bank information provided by iDEAL     for all future billing cycles. If your bank is not listed, then please select a     different payment method.");return a.createElement("div",null,a.createElement("div",{className:"ideal-fields"},a.createElement(r.LabeledSelectInput,{name:"ideal_bank",labelText:l._("Bank"),value:t.idealBankId.rawValue,onChange:this.onIdealBankChange,errorText:this.idealBankErrorString()},a.createElement("option",{value:"",key:"default","aria-selected":""===t.idealBankId.rawValue},l._("Select your bank...")),Object.keys(n).map(function(e){return a.createElement("option",{value:e,key:e,"aria-selected":t.idealBankId.rawValue===e},n[e])}))),this.props.locationFields,a.createElement("div",{className:"ideal-note"},i))},t})(a.Component);t.IdealForm=o}),define("modules/clean/react/payments/pro/components/payments/payment_info_section",["require","exports","tslib","external/react","modules/clean/analytics","modules/clean/payments/payment_form/payment_form_spec","modules/clean/payments/validation","modules/core/i18n","modules/clean/react/payments/pro/components/inputs/inputs","modules/clean/react/payments/common/form_value_helpers","modules/clean/react/payments/pro/components/payments/ideal_form","modules/clean/react/payments/pro/components/payments/payment_method_selector","modules/clean/react/payments/checkout/components/payment_method_form/credit_card_frame","modules/clean/react/payments/checkout/components/payment_method_form/direct_debit_form"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onCpfChange=function(e){t.props.actions.updateCpf(e.value)},t.onCpfNameChange=function(e){t.props.actions.updateCpfName(e.value)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.props.formData.countryCode.formattedValue;i.ProEventsLogger.log("uj-billing-country",{country:e}),"BR"===e&&this.props.showCpf&&i.ProEventsLogger.log("uj-cpf-viewed-field")},t.prototype.prepareForSubmission=function(){return this.props.formData.paymentMethod.formattedValue===r.PaymentMethod.CreditCard?this.creditCardFrame.tokenize():Promise.resolve(!0)},t.prototype.onCountryCodeChange=function(e){this.props.actions.updateCountryCode(e.value);var t=e.value;i.ProEventsLogger.log("uj-billing-country",{country:t}),"BR"===t&&this.props.showCpf&&i.ProEventsLogger.log("uj-cpf-viewed-field")},t.prototype.onZipCodeChange=function(e){this.props.actions.updateZipCode(e.value)},t.prototype.onVatChange=function(e){this.props.actions.updateVat(e.value)},t.prototype.zipCodeErrorString=function(){var e=this.props.formData.zipCode;return!c.FormValueHelper.isValid(e)&&e.showError?o._("Please enter a valid postal code."):""},t.prototype.vatErrorString=function(){var e=this.props.formData.vat;return!c.FormValueHelper.isValid(e)&&e.showError?o._("Please enter a valid VAT number (ex: %(examples)s).").format({examples:l.getVatExamples(this.props.formData.countryCode.formattedValue).join(", ")}):""},t.prototype.cpfErrorString=function(){var e=this.props.formData.cpf;return!c.FormValueHelper.isValid(e)&&e.showError?o._("Please enter a valid CPF number."):""},t.prototype.renderLocationFields=function(){var e=this.props,t=e.countryList,n=e.paymentSpec,i=e.formData,r=e.isScheduledDowngradeToBasic,c=o._("Postal Code",{comment:"This is the label for the zip code field, and should be kept short."}),u="US"===i.countryCode.formattedValue?o._("Billing ZIP"):c,d=!n.allow_zip_code_for_country(i.countryCode.formattedValue),p=t.map(function(e){var t=e[0],n=e[1];return a.createElement("option",{key:"location-"+t,value:t},n)}),m=null;if(n.should_show_vat_for_country(i.countryCode.formattedValue)){var _=l.getVatPrefix(i.countryCode.formattedValue);m=a.createElement(s.LabeledTextInput,{className:"payment-info__vat",containerClassName:"grid__item--medium--1-2",name:"vat",labelText:o._("VAT number (optional)"),errorText:this.vatErrorString(),placeholder:_,value:i.vat.rawValue,onChange:this.onVatChange.bind(this)})}var h=null;this.props.showCpf&&"BR"===i.countryCode.formattedValue&&(h=a.createElement("div",{className:"grid__item"},a.createElement(s.LabeledTextInput,{className:"payment-info__cpf",containerClassName:"grid__item--1-2",name:"cpf",labelText:o._("CPF/CNPJ"),errorText:this.cpfErrorString(),value:i.cpf.rawValue,onChange:this.onCpfChange}),this.props.showCpfName&&a.createElement(s.LabeledTextInput,{className:"payment-info__cpfName",containerClassName:"grid__item--1-2",name:"cpf_name",labelText:o._("Name"),value:i.cpfName.rawValue,onChange:this.onCpfNameChange})));var g=o._("Please note that changing your billing location      could impact your applicable tax rate.");n.should_show_vat_for_country(i.countryCode.formattedValue)&&(g=o._("Please note that changing your billing location or VAT number      could impact your applicable tax rate."));var f=a.createElement("div",{className:r?"disclaimer-message-full-width":"disclaimer-message"},g,r&&a.createElement("span",null," ",o._("Updating your billing information will cancel your scheduled             plan downgrade. If you still wish to downgrade, you will need to             schedule it again.")));return a.createElement("div",{className:"grid__item"},a.createElement(s.LabeledInputRow,{className:"payment-info__location grid__item grid--x-bookend",errors:[{name:"zip",text:"",className:"grid__item--1-2"}]},a.createElement(s.LabeledTextInput,{className:"payment-info__zip",containerClassName:"grid__item--1-2",name:"zip",labelText:u,value:i.zipCode.rawValue,hasError:!1,disabled:d,onChange:this.onZipCodeChange.bind(this),errorText:this.zipCodeErrorString(),type:"tel"}),a.createElement(s.LabeledSelectInput,{className:"payment-info__country",containerClassName:"grid__item--1-2",labelText:o._("Country"),name:"country_code",onChange:this.onCountryCodeChange.bind(this),value:i.countryCode.rawValue},p)),m,a.createElement(s.LabeledInputRow,{className:"payment-info__location grid__item grid--x-bookend",errors:[{name:"cpf",text:"",className:"grid__item--1-2"}]},h),f)},t.prototype.renderPaymentMethodSelector=function(){var e=this.props,t=e.paymentSpec,n=e.formData,i=e.enableIdealReact;return a.createElement(d.PaymentMethodSelector,{paymentSpec:t,paymentMethod:n.paymentMethod.rawValue,updatePaymentMethod:this.props.actions.updatePaymentMethod,countryCode:n.countryCode.rawValue,zipCode:n.zipCode.rawValue,enableIdealReact:i})},t.prototype.render=function(){var e=this,t=this.props,n=t.actions,i=t.formData,l=t.idealBanks,o=t.enableIdealReact,s=this.renderLocationFields(),c=s;return i.paymentMethod.formattedValue===r.PaymentMethod.DirectDeposit?c=a.createElement(m.DirectDebitForm,{locationFields:s,formData:i,actions:n}):o&&i.paymentMethod.formattedValue===r.PaymentMethod.Ideal&&(c=a.createElement(u.IdealForm,{locationFields:s,formData:i,actions:n,idealBanks:l})),a.createElement("div",{className:"grid__item payment-info"},this.renderPaymentMethodSelector(),a.createElement(p.CreditCardFrame,{getHeightFromIframe:!0,iframeUrl:this.props.iframeUrl,hidden:i.paymentMethod.formattedValue!==r.PaymentMethod.CreditCard,actions:this.props.actions,ref:function(t){return e.creditCardFrame=t},nonce:i.nonce,bin:i.bin}),c)},t})(a.Component);t.PaymentInfoSection=_}),define("modules/clean/react/payments/pro/components/payments/payment_method_input",["require","exports","tslib","external/react","modules/core/i18n","external/classnames","modules/clean/payments/payment_form/payment_form_spec","modules/clean/react/payments/pro/components/inputs/inputs"],function(e,t,n,a,i,r,l,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.onChange=function(e){this.props.onSelected(this.props.paymentMethod)},t.prototype.render=function(){var e=this.props,t=e.icons,n=e.labelText,s=e.paymentMethod,c=e.numberOfPaymentMethods,u=[],d=["payment-info__option"];3===c?d.push("grid__item--medium--1-4"):4===c?d.push("grid__item--medium--5-24"):d.push("grid__item--medium--1-2");var p;if(n&&(p="payment-method-label#debit",u.push(a.createElement("span",{title:"debit",key:p,className:"debit"},this.props.labelText))),t){if(s===l.PaymentMethod.CreditCard){var m=t.join(", ").replace("_","-"),_=i._("Credit card. We accept %(payment_methods)s").format({payment_methods:m});p="payment-method-label#creditcard",u.push(a.createElement("span",{key:p,className:"ax-visually-hidden"},_))}else s===l.PaymentMethod.PayPal?(p="payment-method-label#paypal",u.push(a.createElement("span",{key:p,className:"ax-visually-hidden"},i._("Paypal")))):s===l.PaymentMethod.Ideal&&(p="payment-method-label#ideal",u.push(a.createElement("span",{key:p,className:"ax-visually-hidden"},i._("iDEAL"))));for(var h=0,g=t;h<g.length;h++){var f=g[h];p="payment-method-icon#"+f,u.push(a.createElement("span",{title:f,key:p,className:f}))}}return a.createElement("div",{className:r(d)},a.createElement(o.LabeledRadioInput,{name:"payment_method",className:"payment-info__payment",value:s.toString(),checked:this.props.selected,onClick:this.onChange.bind(this),onChange:function(){}}),a.createElement("label",{htmlFor:"payment_method_"+s,id:"payment_method_"+s,className:"payment-info__method-label",onClick:this.onChange.bind(this)},u))},t})(a.Component);t.PaymentMethodInput=s}),define("modules/clean/react/payments/pro/components/payments/payment_method_selector",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/payments/payment_form/payment_form_spec","modules/clean/react/payments/pro/components/payments/payment_method_input"],function(e,t,n,a,i,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onPaymentMethodSelected=function(e){t.props.updatePaymentMethod(e)},t}return n.__extends(t,e),t.prototype.getLabelForMethodId=function(e){return e===r.PaymentMethod.CreditCard?a.createElement(l.PaymentMethodInput,{key:"payment-method#"+e,paymentMethod:r.PaymentMethod.CreditCard,selected:this.props.paymentMethod===r.PaymentMethod.CreditCard,onSelected:this.onPaymentMethodSelected.bind(this),icons:this.props.paymentSpec.supported_credit_cards_for_country(this.props.countryCode),numberOfPaymentMethods:this.props.paymentSpec.available_payment_methods_for_country(this.props.countryCode).length}):e===r.PaymentMethod.PayPal?a.createElement(l.PaymentMethodInput,{key:"payment-method#"+e,paymentMethod:r.PaymentMethod.PayPal,selected:this.props.paymentMethod===r.PaymentMethod.PayPal,onSelected:this.onPaymentMethodSelected,icons:["paypal"],numberOfPaymentMethods:this.props.paymentSpec.available_payment_methods_for_country(this.props.countryCode).length}):e===r.PaymentMethod.DirectDeposit?a.createElement(l.PaymentMethodInput,{key:"payment-method#"+e,paymentMethod:r.PaymentMethod.DirectDeposit,selected:this.props.paymentMethod===r.PaymentMethod.DirectDeposit,onSelected:this.onPaymentMethodSelected,labelText:i._("Direct Debit"),numberOfPaymentMethods:this.props.paymentSpec.available_payment_methods_for_country(this.props.countryCode).length}):this.props.enableIdealReact&&e===r.PaymentMethod.Ideal?a.createElement(l.PaymentMethodInput,{key:"payment-method#"+e,paymentMethod:r.PaymentMethod.Ideal,selected:this.props.paymentMethod===r.PaymentMethod.Ideal,onSelected:this.onPaymentMethodSelected,icons:["ideal"],numberOfPaymentMethods:this.props.paymentSpec.available_payment_methods_for_country(this.props.countryCode).length}):null},t.prototype.render=function(){var e=this,t=this.props,n=t.countryCode,i=t.paymentSpec,r=i.available_payment_methods_for_country(n),l=r.map(function(t){return e.getLabelForMethodId(t)});return a.createElement("div",{className:"payment-info__selector grid__item grid__container--p-small"},l)},t})(a.Component);t.PaymentMethodSelector=o}),define("modules/clean/react/payments/update_billing_individual/action_creator",["require","exports","external/redux","modules/clean/react/payments/common/form/actions/actions","modules/clean/react/payments/update_billing_individual/actions"],function(e,t,n,a,i){"use strict";function r(e){return n.bindActionCreators(l(),e.dispatch)}function l(){return{submitBillingForm:i.submitBillingForm,updatePaymentMethod:a.updatePaymentMethod,updateCountryCode:i.updateBillingCountryCode,updateZipCode:a.updateZipCode,updateVat:a.updateVat,updateCpf:a.updateCpf,updateCpfName:a.updateCpfName,updateNonce:a.updateNonce,updateBIN:a.updateBIN,updateAccountHolderName:a.updateAccountHolderName,updateIBAN:a.updateIBAN,updateMandateSigned:a.updateMandateSigned,updateIdealBank:a.updateIdealBank}}Object.defineProperty(t,"__esModule",{value:!0}),t.bindBillingActions=r}),define("modules/clean/react/payments/update_billing_individual/actions",["require","exports","modules/core/i18n","modules/core/notify","modules/clean/payments/payment_form/payment_form_spec","modules/clean/react/payments/common/form/actions/actions"],function(e,t,n,a,i,r){"use strict";function l(e,t){return void 0===t&&(t={}),function(n,a){var l=a(),o=l.formData,s=o.countryCode.formattedValue,c=l.pageState.paymentFormSpec,u={},d=["countryCode"];c.allow_zip_code_for_country(s)&&d.push("zipCode"),c.should_show_vat_for_country(s)&&d.push("vat"),t.showCpf&&"BR"===s&&(d.push("cpf"),t.showCpfName&&d.push("cpfName")),t.expRenewalsProMobilePaymentPage&&(u.expRenewalsProMobilePaymentPage=!0),t.expUjRebillUpsellVariant&&(u.expUjRebillUpsellVariant=t.expUjRebillUpsellVariant);var p;l.formData.paymentMethod.formattedValue===i.PaymentMethod.CreditCard?(d.push("nonce"),d.push("bin"),p="/update_credit_card_billing_info_ajax"):l.formData.paymentMethod.formattedValue===i.PaymentMethod.DirectDeposit?(d.push("accountHolderName","iban","mandateSigned"),
p="/update_direct_debit_billing_info_ajax"):l.formData.paymentMethod.formattedValue===i.PaymentMethod.Ideal?(d.push("idealBankId","idealBankName"),p="/update_ideal_billing_info_ajax"):p="/paypal_billing_info",n(r.submitForm(p,d,e,u))}}function o(e){return function(t,i){var l=i(),o=l.pageState.countryToCurrencyMap;!(e in o)&&l.formData.countryCode.formattedValue in o?a.Notify.error(n._("You can’t change to a country with a different currency. For help, contact support."),3):t(r.updateCountryCode(e))}}Object.defineProperty(t,"__esModule",{value:!0}),t.submitBillingForm=l,t.updateBillingCountryCode=o}),define("modules/clean/react/payments/update_billing_individual/individual_update_billing_modal",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/react/payments/update_billing_individual/store_creator","modules/clean/react/payments/update_billing_individual/action_creator","modules/clean/react/payments/update_billing_individual/reducers","modules/clean/react/payments/pro/components/payments/payment_info_section","modules/clean/payments/payment_form/payment_form_spec","modules/clean/analytics"],function(e,t,n,a,i,r,l,o,s,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(t){var n=e.call(this,t)||this;return n.prepareForSubmission=function(){return n.paymentInfoSection.prepareForSubmission()},n.savePaymentInfoSection=function(e){n.paymentInfoSection=e},n.store=r.createBillingStore(t,o.BillingReducer),n.state=n.store.getState(),n.store.subscribe(function(){var e=n.store.getState();e.pageState.submitSuccess||n.setState(function(t){return n.props.setSubmittingStatus(e.pageState.submitting),e})}),n}return n.__extends(t,e),Object.defineProperty(t.prototype,"actions",{get:function(){return l.bindBillingActions(this.store)},enumerable:!0,configurable:!0}),t.prototype.logVatChange=function(e,t){null===e&&(e=""),null===t&&(t=""),""===e&&""!==t?u.ProEventsLogger.log("update_billing_added_vat"):""!==e&&""===t?u.ProEventsLogger.log("update_billing_removed_vat"):e!==t&&u.ProEventsLogger.log("update_billing_updated_vat")},t.prototype.onAccept=function(){u.ProEventsLogger.log("update_billing_open_save_changes_click"),this.logVatChange(this.props.vat,this.state.formData.vat.formattedValue),this.actions.submitBillingForm(this.prepareForSubmission,{showCpf:this.props.showCpf,showCpfName:this.props.showCpfName,expRenewalsProMobilePaymentPage:this.props.expRenewalsProMobilePaymentPage,expUjRebillUpsellVariant:this.props.expUjRebillUpsellVariant})},t.prototype.onDismiss=function(){u.ProEventsLogger.log("update_billing_open_cancel")},t.prototype.render=function(){var e,t=this.props,n=t.iframeUrl,r=t.countryList,l=t.idealBanks,o=t.enableIdealReact,u=t.userInfo,d=t.isScheduledDowngradeToBasic,p=this.state,m=p.formData,_=p.pageState;if(m.paymentMethod.rawValue===c.PaymentMethod.PayPal)e=a.createElement("div",{className:"payment-method-disclaimer","data-payment-method-id":"{payment_method.ID}"},i._("You’ll be redirected to PayPal to finish updating your billing information."));else if(m.paymentMethod.rawValue===c.PaymentMethod.Ideal){var h=void 0;h=this.props.idealChargeAmount,e=a.createElement("div",{className:"payment-method-disclaimer","data-payment-method-id":"{payment_method.ID}"},i._("We’ll be charging you %(ideal_charge_amt)s to validate the account when                       you update your bank account information.").format({ideal_charge_amt:h}))}else e=null;return a.createElement("div",{className:"payment-info-section"},a.createElement("div",{className:"payment-method-section grid__container"},a.createElement(s.PaymentInfoSection,{paymentSpec:_.paymentFormSpec,iframeUrl:n,countryList:r,formData:m,actions:this.actions,ref:this.savePaymentInfoSection,idealBanks:l,enableIdealReact:o,userInfo:u,isScheduledDowngradeToBasic:d,showCpf:this.props.showCpf,showCpfName:this.props.showCpfName}),e))},t})(a.Component);t.IndividualUpdateBillingModal=d}),define("modules/clean/react/payments/update_billing_individual/individual_update_billing_modal_loader",["require","exports","tslib","external/classnames","external/react","modules/core/browser","spectrum/button","modules/core/notify","modules/core/i18n","modules/clean/analytics","modules/clean/ajax","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/payments/update_billing_individual/individual_update_billing_modal","modules/clean/static_urls","modules/clean/react/image"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m,_,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=(function(e){function d(){var t=e.call(this)||this;return t.onAccept=function(){t.updateBillingModal&&t.updateBillingModal.onAccept(),c.UserActivityLogger.log("web","update_billing_modal_started")},t.onDismiss=function(){t.updateBillingModal&&t.updateBillingModal.onDismiss(),c.UserActivityLogger.log("web","update_billing_modal_cancelled"),p.Modal.close()},t.saveUpdateBillingModal=function(e){t.updateBillingModal=e},t.setSubmittingStatus=function(e){t.setState(function(t){return t.submitting=e,t})},t.state={loadingContent:!0,submitting:!1},t}return n.__extends(d,e),d.showInstance=function(){p.Modal.showInstance(i.createElement(t.IndividualUpdateBillingModalLoader,null))},d.prototype.componentDidMount=function(){var e=this;u.WebRequest({url:"/account/profile/billing_info",success:function(t){var n=JSON.parse(t);e.setState(function(e){return e.loadedProps={countryList:n.countryList,iframeUrl:n.iframeUrl,countryToCurrencyMap:n.countryToCurrencyMap,userInfo:n.userInfo,idealBanks:n.idealBanks,enableIdealReact:n.enableIdealReact,countryCode:n.countryCode,serializedPaymentFormSpec:n.serializedPaymentFormSpec,idealChargeAmount:n.idealChargeAmount,isScheduledDowngradeToBasic:n.isScheduledDowngradeToBasic,vat:n.vat,showCpf:n.showCpf,showCpfName:n.showCpfName,expUjRebillUpsellVariant:n.expUjRebillUpsell?n.expUjRebillUpsell.variant:"OFF"},e.loadingContent=!1,e}),c.UserActivityLogger.log("web","update_billing_modal_success")},error:function(){o.Notify.error(s._("Failed to load modal.")),c.UserActivityLogger.log("web","update_billing_modal_failure"),p.Modal.close()}})},Object.defineProperty(d.prototype,"expRenewalsProMobilePaymentPage",{get:function(){return r.is_supported_mobile_browser()&&"V2"===r.get_uri().getQuery().exp_renewals_pro_mobile_payment_page},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"modalTitle",{get:function(){var e=s._("Update billing information");return this.expRenewalsProMobilePaymentPage&&(e=i.createElement("div",{className:"exp-renewals-pro-mobile-payment-page-modal-title"},i.createElement(h.Image,{alt:s._("Dropbox logo"),className:"exp-renewals-pro-mobile-payment-page-modal-title__logo",src:_.static_url("/static/images/logo_catalog/dropbox-business-icon_m1-vflczuza3.svg")}),i.createElement("p",{className:"exp-renewals-pro-mobile-payment-page-modal-title__title"},e))),e},enumerable:!0,configurable:!0}),d.prototype.renderButtons=function(){var e=this.state,t=e.loadingContent,n=e.submitting;return i.createElement(p.ModalButtons,{className:"oq-modal__buttons"},i.createElement(l.Button,{className:"cancel-button",variant:"secondary",onClick:this.onDismiss},s._("Cancel")),i.createElement(l.Button,{disabled:t||n,variant:"primary",onClick:this.onAccept},s._("Save changes")))},d.prototype.renderContent=function(){var e=this.state,t=e.loadingContent,n=e.loadedProps;if(t)return i.createElement("div",{className:"loading-spinner"},i.createElement("img",{src:_.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:s._("Loading")}));var a=n,r=a.countryList,l=a.iframeUrl,o=a.countryToCurrencyMap,c=a.countryCode,u=a.serializedPaymentFormSpec,d=a.userInfo,p=a.idealBanks,h=a.enableIdealReact,g=a.idealChargeAmount,f=a.isScheduledDowngradeToBasic,b=a.vat,y=a.showCpf,S=a.showCpfName,v=a.expUjRebillUpsellVariant;return i.createElement(m.IndividualUpdateBillingModal,{iframeUrl:l,countryList:r,countryToCurrencyMap:o,countryCode:c,serializedPaymentFormSpec:u,userInfo:d,idealBanks:p,enableIdealReact:h,expRenewalsProMobilePaymentPage:this.expRenewalsProMobilePaymentPage,setSubmittingStatus:this.setSubmittingStatus,ref:this.saveUpdateBillingModal,idealChargeAmount:g,isScheduledDowngradeToBasic:f,vat:b,showCpf:y,showCpfName:S,expUjRebillUpsellVariant:v})},d.prototype.render=function(){var e=a("update-billing-modal",{"update-billing-modal--mobile":this.expRenewalsProMobilePaymentPage,"update-billing-modal--mobile-safari":this.expRenewalsProMobilePaymentPage&&r.iOS});return i.createElement(p.Modal,{autoClose:!1,buttonComponent:this.renderButtons(),className:e,title:this.modalTitle},i.createElement("div",{className:"dynamic-content"},this.renderContent()))},d})(i.Component);t.UpdateBillingModalLoaderView=g,t.IndividualUpdateBillingModalLoader=d(g,["/static/css/pro/components/update_billing_modal_individual-vflnCtasy.css"])}),define("modules/clean/react/payments/update_billing_individual/reducers",["require","exports","tslib","modules/clean/react/payments/common/form/reducers/reducers","modules/clean/react/payments/common/payments/reducers/reducers","modules/clean/react/payments/common/pricing/reducers/reducers"],function(e,t,n,a,i,r){"use strict";function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.reduce(function(e,t){return function(n,a){return t(e(n,a),a)}})}function o(e,t){return"SubmitFormSuccess"!==t.type?e:n.__assign({},e,{pageState:n.__assign({},e.pageState,{submitSuccess:!0})})}Object.defineProperty(t,"__esModule",{value:!0}),t.BillingReducer=l.apply(void 0,[o,a.FormReducer].concat(i.PaymentMethodReducers,r.TransitionManagementReducers))}),define("modules/clean/react/payments/update_billing_individual/store_creator",["require","exports","external/redux","external/redux-thunk","modules/clean/analytics","modules/clean/dbmodal_stack","modules/clean/react/modal","modules/clean/react/payments/common/form/middleware/middleware","modules/clean/react/payments/common/payments/state/store_creator","modules/clean/react/payments/common/form_value_factory","modules/clean/react/snackbar","modules/clean/top_notif","modules/core/i18n","modules/core/notify","modules/clean/payments/billing_info_modal","modules/core/browser"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m,_,h){"use strict";function g(){return function(e){return function(e){return function(t){if("SubmitFormSuccess"!==t.type)return e(t);var n=e(t),a=void 0!==t.additionalData?t.additionalData.expUjRebillUpsellVariant:"OFF",o=t.additionalData&&t.additionalData.expRenewalsProMobilePaymentPage;if(i.ProEventsLogger.log("update_billing_open_save_changes_success"),d.TopNotificationBar.hideById("rebill-bar"),["V1","V2"].indexOf(a)>=0)m.Notify.clear(),u.Snackbar.complete(p._("Payment method successfully updated.")),r.DBModalStack.trigger(_.BILLING_INFO_UPDATED,{showChangePlanConfirm:!0});else if("V3"===a)document.querySelector("#rebill-bar")&&d.TopNotificationBar.hide(),l.Modal.close(),m.Notify.clear(),u.Snackbar.complete(p._("We’ve successfully updated your account’s billing information.")),r.DBModalStack.trigger(_.BILLING_INFO_UPDATED,{showProUpsell:!0});else if(o){var s=p._("We’ve successfully updated your account’s billing information. You’ll be redirected shortly.");m.Notify.success(p._(s),10,function(){return h.redirect(t.data.data.redirect_url)})}else m.Notify.success(p._("We’ve successfully updated your account’s billing information.")),l.Modal.close(),r.DBModalStack.trigger(_.BILLING_INFO_UPDATED,null);return n}}}}function f(e,t){var i=b(e),r=n.applyMiddleware(a,o.submitFormErrorMiddleware(),g());return n.createStore(t,i,r)}function b(e){var t=S(e),n=y(e);return{pricingState:n,pageState:t,formData:v(e,t,n)}}function y(e){var t=s.createPaymentPricingState(e);return{countryCode:t.countryCode,countryCodeLoading:t.countryCodeLoading,hasCurrencyChanged:t.hasCurrencyChanged,hasTaxChangedWithinCountry:t.hasTaxChangedWithinCountry,loadingPrices:t.loadingPrices,requestToken:t.requestToken,recentLoadEvent:t.recentLoadEvent}}function S(e){var t=s.createPaymentPageState(e).paymentFormSpec;return{countryToCurrencyMap:e.countryToCurrencyMap,submitSuccess:!1,submitState:null,submitting:!1,paymentFormSpec:t}}function v(e,t,n){var a=e.vat,i=e.cpf,r=e.countryCode,l=e.userInfo,o=s.createPaymentFormData(e,t,n),u=o.paymentMethod,d=o.countryCode,p=o.zipCode,m=o.vat,_=o.cpf,h=o.nonce,g=o.bin,f=o.accountHolderName,b=o.iban,y=o.mandateSigned,S=o.termsAndService,v=o.idealBankId,P=o.idealBankName;return{paymentMethod:u,countryCode:d,zipCode:p,vat:a?c.FormValueFactory.createVat(a,r):m,cpf:i?c.FormValueFactory.createCpf(i):_,cpfName:c.FormValueFactory.createCpfNamePrefill("","",l.displayName),nonce:h,bin:g,accountHolderName:f,iban:b,mandateSigned:y,termsAndService:S,idealBankId:v,idealBankName:P}}Object.defineProperty(t,"__esModule",{value:!0}),t.submitFormSuccessMiddleware=g,t.createBillingStore=f,t.createFormData=v}),define("modules/clean/react/top_notification_bar",["require","exports","tslib","external/react","external/react-dom","modules/core/i18n","modules/clean/react/sprite","modules/clean/top_notif"],function(e,t,n,a,i,r,l,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s="top-notification-bar-container",c=(function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.handleDismiss=function(e){e.preventDefault(),t.hide(),n.props.onDismiss&&n.props.onDismiss()},n}return n.__extends(t,e),t.show=function(e,n){void 0===n&&(n=!1),document.getElementById(s)&&!n||(t.hide(),i.render(e,t.getOrCreateSilo()),o.TopNotificationBar.show())},t.hide=function(){o.TopNotificationBar.hide()},t.getRoot=function(){var e=document.getElementById("maestro-prompt");if(!e)throw new Error("No #maestro-prompt element found to render TopNotificationBar into.");return e},t.getOrCreateSilo=function(){var e=t.getRoot(),n=document.querySelector(".top-notification-bar-silo");return n||(n=document.createElement("div"),n.className="top-notification-bar-silo",e.appendChild(n)),n},t.prototype.getColorClass=function(){var e=this.props.type;return"warning"===e?"lightyellow":"info"===e?"lightblue":"lightred"},t.prototype.render=function(){return a.createElement("div",{id:s,className:s+" "+this.getColorClass()},a.createElement("div",{className:"top-notification-bar"},this.props.children,a.createElement("a",{href:"#",className:"top-notification-bar-dismiss dismiss-button enabled",onClick:this.handleDismiss},a.createElement(l.Sprite,{group:"web",name:"banner_x",alt:r._("Close")}))))},t})(a.Component);t.TopNotificationBar=c}),define("modules/clean/teams/admin/lib/billing_history",["require","exports","modules/clean/teams/admin/types/billing_history"],function(e,t,n){"use strict";function a(e){for(var t=[],a=0;a<e.length;a++){var i=e[a];if(a<e.length-1){var l=e[a+1],o=r(l)||r(i);if(i.type===n.BillingRowType.Payment&&l.type===n.BillingRowType.Invoice&&(l.billed===i.paid||l.billed==="("+i.paid+")"||o)&&l.date===i.date){var s={id:a,invoice:l,payment:i,isMobile:o};t.push(s),a++;continue}}i.type===n.BillingRowType.Payment?t.push({id:a,payment:i}):t.push({id:a,invoice:i})}return t}function i(e,n){void 0===n&&(n=t.SelectedYearTypes.ALL_TIME);var i=a(e),r=(new Date).getFullYear().toString();return n===t.SelectedYearTypes.ALL_TIME||(i=n===t.SelectedYearTypes.YEAR_TO_DATE?i.filter(function(e){return e.payment?e.payment.date.indexOf(r)!==-1:!!e.invoice&&e.invoice.date.indexOf(r)!==-1}):i.filter(function(e){return e.payment?e.payment.date.indexOf(n)!==-1:!!e.invoice&&e.invoice.date.indexOf(n)!==-1})),i=i.filter(function(e){return e.invoice&&null!==e.invoice.description||e.payment&&null!==e.payment.description})}function r(e){var t=e.description;return!!t&&(t.indexOf("Google")!==-1||t.indexOf("Apple")!==-1)}Object.defineProperty(t,"__esModule",{value:!0}),t.SelectedYearTypes={ALL_TIME:"all-time",YEAR_TO_DATE:"year-to-date"},t.getHistoryData=i}),define("modules/clean/teams/admin/types/billing_history",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.Invoice=0]="Invoice",e[e.Payment=1]="Payment",e[e.Legacy=2]="Legacy"})(t.BillingRowType||(t.BillingRowType={}))}),define("modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list",["require","exports","tslib","external/react","modules/clean/react/css"],function(e,t,n,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return a.createElement("div",{className:"admin-priced-list"},a.createElement("div",null,this.props.children))},t})(a.Component);t.AdminPricedList=i(r,["/static/css/teams/admin/widgets/admin_priced_list/admin_priced_list-vflMAA6ZU.css"])}),define("modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list_item",["require","exports","tslib","external/react","external/classnames","modules/clean/react/badge"],function(e,t,n,a,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChange=function(){},t}return n.__extends(t,e),t.prototype.renderTitleWarningText=function(){var e=this.props.titleWarningText;if(e)return a.createElement("span",{className:"admin-priced-list-item__content_title_warning"}," ",e)},t.prototype.renderTitleSecondaryText=function(){var e=this.props.titleSecondaryText;if(e)return a.createElement("span",{className:"admin-priced-list-item__content_title_secondary"}," ",e)},t.prototype.getClickHandler=function(){if(!this.props.disableItem)return this.props.onClick},t.prototype.render=function(){var e=this.props,t=e.description,l=e.price,o=e.title,s=e.unit,c=e.detailsLink,u=e.disableItem,d=this.props.className?this.props.className:"",p=l?l.toString():"-",m=l?s:"",_=i((h={"admin-priced-list-item":!0,active:this.props.isSelected===!0},h[d]=!0,h.disabled=u,h));return a.createElement("div",{className:_,onClick:this.getClickHandler()},a.createElement("div",{className:"admin-priced-list-item__content"},a.createElement("div",{className:"admin-priced-list-item__content_title"},a.createElement("input",{type:"radio",checked:this.props.isSelected,onChange:this.onChange,disabled:this.props.disableItem}),a.createElement("h1",{className:"f1"},o,this.props.badge&&a.createElement(r.Badge,n.__assign({},this.props.badge)),this.renderTitleWarningText(),this.renderTitleSecondaryText())),a.createElement("div",{className:"admin-priced-list-item__content_description u-font-meta"},t,c)),a.createElement("div",{className:"admin-priced-list-item__pricing"},a.createElement("div",{className:"admin-priced-list-item__pricing_price"},p),a.createElement("div",{className:"admin-priced-list-item__pricing_unit"},m)));var h},t})(a.Component);t.AdminPricedListItem=l}),define("modules/clean/teams/admin/widgets/billing_history/billing_history_row",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/react/payments/edit_invoice_address_modal/edit_invoice_address_modal_loader","modules/clean/analytics","modules/clean/react/tooltip","modules/clean/react/sprite"],function(e,t,n,a,i,r,l,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onEdit=function(){var e=t.props,n=e.row,a=e.isTeam;n.invoice&&r.EditInvoiceAddressModalLoader.showInstance(n.invoice,a)},t.logReceiptLinkClick=function(){t.props.logAccountBillingTabEvents&&l.ProEventsLogger.log("de_billing_tab_receipt_link_click")},t.logInvoiceLinkClick=function(){t.props.logAccountBillingTabEvents&&l.ProEventsLogger.log("de_billing_tab_invoice_link_click")},t}return n.__extends(t,e),t.prototype.renderDate=function(){var e=this.props.row,t=e.invoice,n=e.payment;return t&&t.date?t.date:n&&n.date?n.date:null},t.prototype.renderDescription=function(){var e=this.props.row,t=e.invoice,n=e.payment,r=e.isMobile,l=null,o=null;return t&&t.description?l=t.description:n&&n.description&&(l=n.description),r&&t&&t.description&&n&&n.description&&(l=n.description+" | "+t.description),(t&&t.isVoided||n&&n.isVoided)&&(o=a.createElement("span",null," (",i._("Voided"),")")),a.createElement("div",null,a.createElement("p",{className:"description-line"},a.createElement("span",null,l),o))},t.prototype.renderLinks=function(){if(this.props.renderLinks!==!1){var e=this.props,t=e.row,n=e.showEditInvoiceModal,r=e.canEditBilling,l=t.invoice,o=t.payment,s=[];return l&&l.link&&s.push(a.createElement("a",{key:"invoice-link",href:l.link,target:"_blank",rel:"noopener noreferrer",onClick:this.logInvoiceLinkClick},i._("Invoice"))),!t.isMobile&&o&&o.link&&s.push(a.createElement("a",{key:"payment-link",href:o.link,target:"_blank",rel:"noopener noreferrer",onClick:this.logReceiptLinkClick},i._("Receipt"))),n&&l&&!l.isOpen&&l.isEditable&&r&&s.push(a.createElement("button",{key:"edit-link",className:"button-as-link",onClick:this.onEdit},i._("Edit"))),s.length||(l&&l.infoTooltip?s.push(this.renderInfoTooltip(l)):o&&o.infoTooltip&&s.push(this.renderInfoTooltip(o))),s.length?a.createElement("span",null,s):null}},t.prototype.renderInfoTooltip=function(e){return a.createElement(o.Tooltip,{position:o.TooltipPosition.TOP,tooltip_contents:e.infoTooltip},a.createElement(s.Sprite,{group:"teams",name:"info_active",alt:"",className:"info-sprite"}))},t.prototype.renderPrice=function(){var e=this.props.row,t=e.invoice,n=e.payment;if(e.isMobile)return null;var i=null;return t&&n?i=t.isVoided||n.isVoided?a.createElement("span",{className:"row-content__price--line-through"},t.billed):t.billed:n?i=n.paid:t&&(i=t.billed),i},t.prototype.render=function(){var e=this.props.row;return e.invoice||e.payment?a.createElement("tr",{className:"row-content","data-variant":!0},a.createElement("td",{className:"row-content__date"},this.renderDate()),a.createElement("td",{className:"row-content__description"},this.renderDescription()),a.createElement("td",{className:"row-content__links"},this.renderLinks()),a.createElement("td",{className:"row-content__price"},this.renderPrice())):null},t.defaultProps={canEditBilling:!0},t})(a.Component);t.BillingHistoryTableRow=c}),define("modules/clean/teams/admin/widgets/billing_history/billing_history_table",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/teams/admin/widgets/billing_history/billing_history_row","modules/clean/account_page/widgets/billing/billing_history/types","spectrum/icon_form","spectrum/popover"],function(e,t,n,a,i,r,l,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.buildFooterIfNecessary=function(){if(null!==this.props.footer)return a.createElement("tfoot",{className:"row-footer"},this.props.footer)},t.prototype.buildHeaderDate=function(){return a.createElement("th",{className:"row-header date-row"},a.createElement(s.Popover,{onSelection:this.props.onSelection},a.createElement(s.PopoverTrigger,null,a.createElement("span",{className:"date-header-cell"},i._("Date")),a.createElement("span",{className:"caret"},a.createElement(o.IconForm,{name:"caret-down"}))),a.createElement(s.PopoverContent,null,a.createElement(s.PopoverItemGroup,{key:"order-item-group"},a.createElement(s.PopoverItemGroupTitle,{key:"order-title"},i._("Order")),a.createElement(s.PopoverSelectableItem,{value:l.BillingHistoryOrder.ASCENDING,selected:l.BillingHistoryOrder.ASCENDING===this.props.order},i._("Ascending")),a.createElement(s.PopoverSelectableItem,{value:l.BillingHistoryOrder.DESCENDING,selected:l.BillingHistoryOrder.DESCENDING===this.props.order},i._("Descending"))),a.createElement(s.PopoverItemGroupSeparator,{key:"show-separator"}),a.createElement(s.PopoverItemGroup,{key:"show-item-group"},a.createElement(s.PopoverItemGroupTitle,{key:"show-title"},i._("Show")),a.createElement(s.PopoverSelectableItem,{value:"all_time",selected:"all_time"===this.props.filter},i._("All time")),a.createElement(s.PopoverSelectableItem,{value:"year_to_date",selected:"year_to_date"===this.props.filter},i._("Year-to-date")),this.renderMenuItems()))))},t.prototype.renderMenuItems=function(){var e=[],t=this.props,n=t.filters,i=t.filter;return n&&n.forEach(function(t){e.push(a.createElement(s.PopoverSelectableItem,{key:t,value:t,selected:t===i},t))}),e},t.prototype.render=function(){var e,t=this.props,n=t.amountLabel,l=t.canEditBilling,o=t.displayNoTransactionsOnEmptyRecords,s=t.showEditInvoiceModal,c=t.logAccountBillingTabEvents,u=t.isTeam,d=t.renderLinks,p=this.props.billingHistoryRecords,m=n?n:i._("Price");if(o&&0===p.length){var _=this.props.noTransactionLabel?this.props.noTransactionLabel:i._("No transactions");e=a.createElement("tr",{className:"row-content"},a.createElement("td",{className:"row-content__date"}),a.createElement("td",{className:"row-content__description"},_),a.createElement("td",{className:"row-content__links"}),a.createElement("td",{className:"row-content__price"}))}return a.createElement("div",null,a.createElement("table",{className:"billing-history-table",cellSpacing:"0"},a.createElement("thead",null,a.createElement("tr",null,this.buildHeaderDate(),a.createElement("th",{className:"row-header desc-row u-font-meta",colSpan:2},i._("Description")),a.createElement("th",{className:"row-header price-row u-font-meta"},m))),this.buildFooterIfNecessary(),a.createElement("tbody",null,e,p.map(function(e,t){return a.createElement(r.BillingHistoryTableRow,{canEditBilling:l,isTeam:u,key:e.id,logAccountBillingTabEvents:c,renderLinks:d,row:e,showEditInvoiceModal:s})}))))},t.defaultProps={onSelection:function(){}},t})(a.Component);t.BillingHistoryTable=c}),define("modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal",["require","exports","tslib","modules/core/i18n","modules/clean/react/modal","modules/clean/payments/skus/subscription_change_plan","modules/clean/payments/skus/subscription_diff","modules/clean/payments/skus/subscription_service","modules/constants/trademark","modules/clean/ajax","modules/clean/dbmodal_stack","modules/core/notify","external/react","modules/clean/teams/admin/widgets/change_plan_modal/change_plan_constants"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _;(function(e){e[e.ALL=1]="ALL",e[e.PLAN=2]="PLAN",e[e.SCHEDULE=3]="SCHEDULE",e[e.LICENSES=4]="LICENSES",e[e.EVH_ADDON=5]="EVH_ADDON",e[e.IND_SUBSCRIPTION=6]="IND_SUBSCRIPTION"})(_=t.CancellationType||(t.CancellationType={}));var h=(function(e){function t(t){var n=e.call(this,t)||this;return n.onAccept=function(){switch(n.props.cancellationType){case _.PLAN:n.cancelPlanOrBillingScheduledChange(_.PLAN);break;case _.SCHEDULE:n.cancelPlanOrBillingScheduledChange(_.SCHEDULE);break;case _.LICENSES:n.cancelLicensesScheduledChanges();break;case _.ALL:n.cancelAll()}},n.subService=new o.SubscriptionService,n.state={submitting:!1},n}return n.__extends(t,e),t.showInstance=function(e){i.Modal.showInstance(p.createElement(t,n.__assign({},e)))},t.prototype.submittingRequest=function(){this.setState(function(e){return e.submitting=!0,e})},t.prototype.doneSubmittingRequest=function(){this.setState(function(e){return e.submitting=!1,e})},t.prototype.cancelAll=function(){var e=this,t=this.props,n=t.transitionPerformed,r=t.subStatus;this.submittingRequest();var o=l.SubscriptionDiff.fromSubscriptionState(r.subState);this.subService.validateAndPerformTransition(o).then(function(t){d.Notify.success(a._("Your scheduled changes have been cancelled!")),n&&n(t),i.Modal.close(),e.props.reOpenModalDialogAfterCancellation&&u.DBModalStack.trigger(m.CHANGE_PLAN_DUAL_MODAL_UPDATED,null)}).finally(function(){e.doneSubmittingRequest()})},t.prototype.cancelLicensesScheduledChanges=function(){var e=this,t=this.props.subStatus,n=l.SubscriptionDiff.fromSubscriptionStatus(t);this.submittingRequest(),n.setTotalLicenses(t.subState.totalLicenses),this.subService.price(n).then(function(t){e.subService.performTransition(t).then(function(t){e.props.transitionPerformed&&e.props.transitionPerformed(t),d.Notify.success(a._("You’ve cancelled your change!")),e.doneSubmittingRequest(),i.Modal.close(),e.props.reOpenModalDialogAfterCancellation&&u.DBModalStack.trigger(m.CHANGE_PLAN_DUAL_MODAL_UPDATED,null)}).catch(function(){e.errorUpdatingChanges()})}).catch(function(){e.errorUpdatingChanges()})},t.prototype.errorUpdatingChanges=function(){d.Notify.error(a._("Failed to revert changes.")),this.doneSubmittingRequest(),i.Modal.close()},t.prototype.cancelPlanOrBillingScheduledChange=function(e){var t,n,l=this,o=this.props,s=o.transitionPerformed,p=o.subStatus;this.submittingRequest(),c.WebRequest({url:"/account/team/change_plan_modal_view_model",success:function(o){if(t=JSON.parse(o).serializedSubChangePlans.map(function(e){return r.SubscriptionChangePlan.deserialize(e)}),n=t.filter(function(t){return!!(t.finalSubState&&t.finalSubState.plan&&t.finalSubState.billingSchedule&&p.subState&&p.subState.plan&&p.finalSubState&&p.finalSubState.billingSchedule&&p.finalSubState.plan&&p.subState.billingSchedule)&&(e===_.PLAN?p.subState.plan.productType===t.finalSubState.plan.productType&&p.finalSubState.billingSchedule.id===t.finalSubState.billingSchedule.id:e===_.SCHEDULE&&p.finalSubState.plan.productType===t.finalSubState.plan.productType&&p.subState.billingSchedule.id===t.finalSubState.billingSchedule.id)}),n.length>0){var c=n[0];l.subService.performTransition(c).then(function(e){d.Notify.success(a._("You’ve cancelled your change!")),s&&s(e),l.doneSubmittingRequest(),i.Modal.close(),l.props.reOpenModalDialogAfterCancellation&&u.DBModalStack.trigger(m.CHANGE_PLAN_DUAL_MODAL_UPDATED,null)})}else d.Notify.error(a._("Failed to revert changes."))},error:function(){d.Notify.error(a._("Failed to load modal.")),l.doneSubmittingRequest(),i.Modal.close(),l.props.reOpenModalDialogAfterCancellation&&u.DBModalStack.trigger(m.CHANGE_PLAN_DUAL_MODAL_UPDATED,null)}})},t.prototype.render=function(){var e=this.props,t=e.cancellationType,n=e.subStatus;if(!n.subState.plan||!n.subState.billingSchedule)return p.createElement("noscript",null);var r,l=a._("Confirm cancelled change");switch(t){case _.PLAN:r=a._("You’re cancelling your scheduled changes. Your %(trademark_business)s %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({trademark_business:s.TRADEMARK_BUSINESS,plan:n.subState.plan.displayName(),date:n.subState.formattedNextBillingDate,schedule:n.subState.billingSchedule.scheduleDescriptionAdjective});break;case _.SCHEDULE:r=a._("You’re cancelling your scheduled changes. Your %(trademark_business)s %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({trademark_business:s.TRADEMARK_BUSINESS,plan:n.subState.plan.displayName(),date:n.subState.formattedNextBillingDate,schedule:n.subState.billingSchedule.scheduleDescriptionAdjective});break;case _.LICENSES:r=a._("You’re cancelling your scheduled changes. Your %(trademark_business)s %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({trademark_business:s.TRADEMARK_BUSINESS,plan:n.subState.plan.displayName(),date:n.subState.formattedNextBillingDate,schedule:n.subState.billingSchedule.scheduleDescriptionAdjective});break;case _.ALL:l=a._("Confirmation"),r=a._("By confirming, all existing scheduled changes will be cancelled.");break;default:l=a._("Confirmation"),r=a._("By confirming, all existing scheduled changes will be cancelled.")}return p.createElement(i.Modal,{acceptButtonDisabled:this.state.submitting,acceptButtonText:a._("Confirm"),autoClose:!1,dismissButtonText:a._("Don’t cancel"),onAccept:this.onAccept,title:l,submitting:this.state.submitting},p.createElement("p",null,r))},t})(p.Component);t.CancelBillingChangesConfirmationView=h}),
define("modules/clean/teams/admin/widgets/billing_notifications/cancellable_item",["require","exports","tslib","external/react","modules/core/i18n","external/classnames"],function(e,t,n,a,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e,t=this.props,n=t.title,i=t.description,l=t.handleAction,o=t.useCTA,s=t.CTAText,c=this.props.className?this.props.className:"",u=r((d={"cancellable-item__button":!0,"link-button":!0},d[c]=!0,d));return o&&(e=a.createElement("button",{className:u,onClick:l},s)),a.createElement("div",{className:"cancellable-item"},a.createElement("span",{className:"cancellable-item__title"},n)," ",a.createElement("span",{className:"cancellable-item__desc"},i),e);var d},t.defaultProps={CTAText:i._("Cancel change"),useCTA:!1},t})(a.Component);t.CancellableItemView=l}),define("modules/clean/teams/admin/widgets/change_plan_modal/change_plan_constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CHANGE_PLAN_DUAL_MODAL_UPDATED="change_plan_dual_modal:updated";(function(e){e[e.PLAN_CHANGE=1]="PLAN_CHANGE",e[e.SCHEDULE_CHANGE=2]="SCHEDULE_CHANGE"})(t.DualPlanModalMode||(t.DualPlanModalMode={}))});
//# sourceMappingURL=pkg-account_subscription_core.min.js-vflLGosqD.map