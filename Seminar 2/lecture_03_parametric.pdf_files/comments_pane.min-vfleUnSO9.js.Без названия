define(["require","exports","tslib","external/react","external/react-redux","modules/clean/react/css","spectrum_comments/comment_stream","modules/clean/react/comments2/actions_adapter","modules/clean/react/comments2/util","modules/clean/react/comments2/util","modules/clean/react/comments2/transforms","modules/clean/react/comments2/data/selectors","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/mentions_api","modules/clean/react/file_viewer/coach_mark","modules/clean/react/file_viewer/more_dropdown/more_option_registry","modules/clean/react/file_action_button","modules/clean/react/file_viewer/more_dropdown/models","modules/clean/previews/constants","spectrum_comments/comment/time_coded_comment","spectrum_comments/comment_editor/comment_editor","spectrum_comments/comment_editor/time_coded_comment_editor","modules/clean/react/comments2/video_annotations/constants","modules/clean/react/comments2/video_annotations/video_preview_event_emitter","modules/core/i18n"],function(e,t,o,n,r,i,s,a,m,c,d,p,l,u,h,v,_,w,g,C,O,b,f,y,E){"use strict";function M(e){var t=e.playerCurrentTime,r=e.previewType,i=e.showOnboarding,s=e.onCoachmarkClose;if(void 0!==t){var a=void 0;if(r===g.PreviewType.Audio?a=b.AudioCommentEditor:r===g.PreviewType.Video&&(a=b.VideoCommentEditor),a)return n.createElement(a,o.__assign({},e,{currentTime:t,showCoachmark:i,createCoachmark:function(){return n.createElement(h.CoachMark,{title:E._("Target your feedback"),arrowPosition:"top-right",showClose:!0,onCloseButtonClick:s},E._("Adding time codes to comments keeps feedback simple, organized, and all in one place."))}}))}return n.createElement(O.CommentEditor,o.__assign({},e))}Object.defineProperty(t,"__esModule",{value:!0});var T=(function(e){function t(t){var r=e.call(this,t)||this;return r.updateMentionsMatches=function(e){r.setState({mentionsMatches:e})},r.onMentionsQueryUpdated=function(e){r.mentionsApi.query(e,r.updateMentionsMatches)},r.videoPreviewOnboardingDismissed=function(){r.props.dispatch(l.Actions.suppressOnboardingForSession("video_first_paused"))},r.toggleShowResolved=function(){var e=r.props,t=e.dispatch,o=e.showResolved,n=o?"hide_resolved_threads":"show_resolved_threads";t(l.Actions.toggleShowResolved()),t(l.Actions.logEvent(n))},r.createEditor=function(e){var t=r.props,i=t.playerCurrentTime,s=t.showOnboarding,a=t.stream.previewType;return n.createElement(M,o.__assign({},e,{playerCurrentTime:i,previewType:a,showOnboarding:s,onCoachmarkClose:r.onCoachmarkClose}))},r.onCoachmarkClose=function(){r.props.dispatch(l.Actions.suppressOnboardingForSession("initial_video_land")),c.markBrowserHasDismissedOnboardingPopup()},r.mentionsApi=u.mentionsApi(t.viewer),r.state={mentionsMatches:r.mentionsApi.cache},r}return o.__extends(t,e),t.prototype.updateCommentsMoreOptionGroup=function(){var e=this.props.showResolved?_.FileActionButtonType.HIDE_RESOLVED_COMMENTS:_.FileActionButtonType.SHOW_RESOLVED_COMMENTS,t=new w.MoreOptionGroup({fileActionButtonGroup:_.FileActionButtonGroup.COMMENTS,options:[new w.MoreOption({className:"comments-options-item__show-resolved",fileActionButtonType:e,component:function(e){return n.createElement("span",null,e.buttonText)},handler:this.toggleShowResolved})]});void 0===this.moreOptionGroup?v.moreOptionRegistry.addOption(t):v.moreOptionRegistry.replaceOption(this.moreOptionGroup,t),this.moreOptionGroup=t},t.prototype.componentDidMount=function(){this.updateCommentsMoreOptionGroup(),y.videoPreviewEventEmitter.addListener(f.EventTypes.ONBOARDING_DISMISSED,this.videoPreviewOnboardingDismissed);var e=this.props,t=e.dispatch,o=e.showOnboarding;t(l.Actions.logEvent("show_comments"));var n=c.hasBrowserDismissedOnboardingPopup()&&Math.random()<.8;t(l.Actions.setSoftHideCommentsPaneOnboarding(n)),o&&!n&&t(l.Actions.logEvent("sidebar_onboarding_shown"))},t.prototype.componentDidUpdate=function(e){var t=this.props,o=t.showOnboarding,n=t.dispatch;this.updateCommentsMoreOptionGroup(),!e.showOnboarding&&o&&n(l.Actions.logEvent("sidebar_onboarding_shown"))},t.prototype.componentWillUnmount=function(){y.videoPreviewEventEmitter.removeListener(f.EventTypes.ONBOARDING_DISMISSED,this.videoPreviewOnboardingDismissed)},Object.defineProperty(t.prototype,"actionsAdapter",{get:function(){var e=this.props,t=e.dispatch,o=e.onboardingKeysNotYetMarked,n=e.stream,r=e.viewer;return a.createActionsAdapter(t,n,o,this.onMentionsQueryUpdated,r)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"commentComponent",{get:function(){return this.props.stream.previewType===g.PreviewType.Audio||this.props.stream.previewType===g.PreviewType.Video?C.TimeCodedComment:void 0},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e,t=this.props,o=t.showResolved,r=t.isMobile,i=t.stream,a=t.viewer,c=t.activeThreadId,p=this.props.threads.filter(function(e){return o||!e.resolved});return a&&(e=d.dbxUserToIUser(a)),n.createElement("div",{className:"comments-pane-wrapper"},n.createElement(s.CommentStream,{id:i.id,actionsAdapter:this.actionsAdapter,commentComponent:this.commentComponent,editorComponent:this.createEditor,enabled:!0,isMobile:!!r,mentionsMatches:this.state.mentionsMatches,settings:{canAnnotate:!0,canComment:!0,canRead:!0},userPermissions:{canAnnotate:!0,canComment:!0,canRead:!0},threads:p,user:e,activeThreadID:c,readonlyEditor:m.isComments2ReadonlyEditor(a)}))},t})(n.Component);t.CommentsPaneComponent=T;var A=r.connect(function(e){var t=p.getContext(e),o=t.stream,n=t.viewer;return{activeThreadId:p.getActivatedThreadId(e),playerCurrentTime:p.getPlayerCurrentTime(e),onboardingKeysNotYetMarked:p.getOnboardingKeysNotYetMarked(e),showOnboarding:p.getShowOnboardingOnCommentsPane(e),showResolved:p.getShowResolved(e),stream:o,threads:p.getThreads(e),viewer:n}})(T);t.CommentsPane=i(A,["/static/js/spectrum_comments/index.web-vflUuS6AI.css","/static/css/comments2-sidebar-vflu2ROdS.css"])});
//# sourceMappingURL=comments_pane.min.js-vflHbyyJR.map